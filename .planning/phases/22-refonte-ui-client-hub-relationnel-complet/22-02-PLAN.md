---
phase: 22-refonte-ui-client-hub-relationnel-complet
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/client/src/pages/ClientDetail.tsx
  - packages/client/src/components/ClientDetailTabs.tsx
autonomous: true

must_haves:
  truths:
    - ClientDetail has 5 horizontal tabs: Informations, Projets, Tracks, Sessions, Finances
    - Notes section always visible at bottom of page
    - Notes visible regardless of active tab
    - Tab navigation preserves state
  artifacts:
    - path: packages/client/src/components/ClientDetailTabs.tsx
      provides: Tab navigation component
      min_lines: 100
      exports: ["ClientDetailTabs"]
    - path: packages/client/src/pages/ClientDetail.tsx
      provides: Updated client detail page with tabs
      contains: "<ClientDetailTabs"
  key_links:
    - from: packages/client/src/pages/ClientDetail.tsx
      to: packages/client/src/components/ClientDetailTabs.tsx
      via: "import and render tabs"
      pattern: "import.*ClientDetailTabs"
---

<objective>
Restructure ClientDetail page with 5 horizontal tabs + persistent Notes section at bottom.

Purpose: Organize client information and relational data into logical sections
Output: Tab-based interface with Informations, Projets, Tracks, Sessions, Finances tabs + Notes always visible
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-refonte-ui-client-hub-relationnel-complet/22-CONTEXT.md

# Current implementation
@packages/client/src/pages/ClientDetail.tsx
</context>

<tasks>

<task type="auto">
  <name>Create ClientDetailTabs component</name>
  <files>packages/client/src/components/ClientDetailTabs.tsx</files>
  <action>
    Create new component for tab navigation:

    **Props:**
    - clientId: number
    - activeTab: string
    - onTabChange: (tab: string) => void

    **Structure:**
    Use shadcn/ui Tabs component with 5 triggers:
    - "informations" - Client info (basic + enriched + music)
    - "projets" - Projects list (placeholder for now: "Onglet Projets - À implémenter")
    - "tracks" - Tracks list (placeholder: "Onglet Tracks - À implémenter")
    - "sessions" - Sessions list (keep existing implementation)
    - "finances" - Invoices + Quotes + Stats (keep existing invoices, add placeholders for quotes/stats)

    **Tab Content:**
    - Informations: Render existing 3 sub-tabs (Informations, Informations Enrichies, Profil Musical)
    - Sessions: Render existing sessions table
    - Finances: Render existing invoices table (quotes/stats placeholders)
    - Projets/Tracks: Placeholder text for Plans 22-03 and 22-04

    Use lucide icons: Info, FolderOpen, Music, Calendar, DollarSign
  </action>
  <verify>
    Component compiles without TypeScript errors
    Tabs render correctly
    `pnpm --filter client check` passes
  </verify>
  <done>
    ClientDetailTabs component exists with 5 tab triggers and content areas
  </done>
</task>

<task type="auto">
  <name>Refactor ClientDetail page with tabs</name>
  <files>packages/client/src/pages/ClientDetail.tsx</files>
  <action>
    Restructure page layout:

    **1. Remove existing Tabs structure:**
    - Current implementation has 3 tabs (Informations, Informations Enrichies, Profil Musical)
    - Move this structure INTO ClientDetailTabs "informations" tab content

    **2. Page Structure:**
    ```tsx
    <div className="container pt-2 pb-4 px-2">
      {/* Breadcrumb */}
      <Link to="/clients">
        <ArrowLeft /> Retour aux clients
      </Link>

      {/* Header with title + Edit/Delete buttons */}
      <div className="flex justify-between items-center">
        <h1>{client.name}</h1>
        <div>
          <Button onClick={() => toggleEditMode(true)}>Edit</Button>
          <Button onClick={handleDelete}>Delete</Button>
        </div>
      </div>

      {/* Tabs */}
      <ClientDetailTabs
        clientId={client.id}
        activeTab={activeTab}
        onTabChange={setActiveTab}
      />

      {/* Notes Section - ALWAYS VISIBLE */}
      <Card className="mt-6">
        <CardHeader>
          <CardTitle>Notes</CardTitle>
        </CardHeader>
        <CardContent>
          <NotesHistory clientId={client.id} />
        </CardContent>
      </Card>
    </div>
    ```

    **3. State Management:**
    - Add activeTab state: `const [activeTab, setActiveTab] = useState("informations")`
    - Preserve existing edit mode, delete dialog, mutations

    **4. Keep Existing:**
    - Edit mode functionality
    - Delete confirmation dialog
    - tRPC queries for client, sessions, invoices
    - All mutations
  </action>
  <verify>
    Page loads without errors
    5 tabs visible and clickable
    Notes section visible at bottom regardless of active tab
    Edit/Delete functionality still works
    `pnpm --filter client dev` runs without errors
  </verify>
  <done>
    ClientDetail page has 5 tabs + persistent Notes section, edit/delete still functional
  </done>
</task>

<task type="auto">
  <name>Build and validate tab structure</name>
  <files>packages/client/</files>
  <action>
    Run build to validate:

    ```bash
    pnpm --filter client check
    pnpm --filter client build
    ```

    Fix any TypeScript errors.
    Ensure Notes section remains visible when switching tabs.
  </action>
  <verify>
    `pnpm --filter client check` exits 0
    `pnpm --filter client build` succeeds
    Tab navigation works smoothly
    Notes always visible at bottom
  </verify>
  <done>
    Client package builds with tab structure, Notes section persistent across tabs
  </done>
</task>

</tasks>

<verification>
Overall checks:
- ClientDetail page shows 5 horizontal tabs
- Tabs: Informations, Projets, Tracks, Sessions, Finances
- Notes section visible at bottom on all tabs
- Clicking tabs switches content correctly
- Edit mode still works
- Delete functionality preserved
- TypeScript compilation passes
</verification>

<success_criteria>
- User sees 5 tabs on ClientDetail page
- Notes section always visible regardless of active tab
- Sessions tab shows existing sessions table
- Finances tab shows existing invoices table
- Projets and Tracks tabs show placeholder content
- Edit and delete buttons still functional
- Zero TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/22-refonte-ui-client-hub-relationnel-complet/22-02-SUMMARY.md`
</output>
