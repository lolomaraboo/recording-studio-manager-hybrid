---
phase: 26.1-reorganisation-accordeons---logique-studio-d'enregistrement
plan: 01
subsystem: ui
tags: [react, accordion, ux, form-design, client-management]

# Dependency graph
requires:
  - phase: 26-formulaire-client-accordeons
    provides: 7-accordion ClientEditForm structure with vCard-enriched fields
provides:
  - 5-accordion ClientEditForm with studio workflow order
  - Consolidated musical profile in 2nd position (core business)
  - Unified contact accordion (phones, emails, websites, addresses)
  - Consistent icon colors (Plus and Trash2 in text-muted-foreground)
  - 3-column grid layout for all array contact fields
  - Auto-generated readonly "Nom complet" from structured name fields
  - Alt key toggle for accordion expand/collapse
affects: [client-form-validation, client-import-export, company-member-management]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - Subsection separation with border-t pt-3 mt-3 within fused accordions
    - 3-column grid (120px | 1fr | 80px) for type-value-actions contact fields
    - Auto-fill useEffect pattern for readonly derived fields
    - Alt key global listener for accordion batch operations

key-files:
  created: []
  modified:
    - packages/client/src/components/ClientEditForm.tsx

key-decisions:
  - "Deleted Relations Professionnelles accordion (company members managed in ClientDetailTabs modal)"
  - "Moved birthday and gender from Personal to Identité accordion"
  - "Kept only customFields in Notes Studio accordion (simplified from personal info)"
  - "Reordered accordions to Identité → Coordonnées → Profil Artistique → Streaming → Notes Studio"
  - "Set default state to only Identité open (reduced visual overwhelm)"
  - "Made Nom complet readonly with auto-fill logic from structured name fields"
  - "Moved Type de client to top of Identité (critical business context first)"
  - "Moved artistName above structured name fields (primary identity for artists)"
  - "Reorganized Coordonnées with Contact and Adresses subsections"
  - "Implemented 3-column grid for phones, emails, websites, addresses"
  - "Added rounded corners to all select elements (visual consistency)"
  - "Standardized all Plus and Trash2 icons to text-muted-foreground"

patterns-established:
  - "3-column grid layout: grid-cols-[120px_1fr_80px] for type-selector, input, action-buttons"
  - "Array field pattern: Default 1 empty item, Plus button adds, Trash2 removes (min 1 item)"
  - "Readonly auto-generated field pattern: bg-muted cursor-not-allowed with useEffect auto-fill"
  - "Accordion keyboard shortcut: Alt key toggles all accordions open/collapse"

# Metrics
duration: 47min
completed: 2026-01-21
---

# Phase 26.1: Reorganize Accordions - Studio Workflow Logic Summary

**ClientEditForm restructured from 7 scattered accordions to 5 studio workflow-aligned sections with 3-column grid contact fields, consistent icon colors, and auto-generated readonly Nom complet**

## Performance

- **Duration:** 47 min
- **Started:** 2026-01-21T20:56:00Z (estimate from first commit)
- **Completed:** 2026-01-21T21:43:14Z
- **Tasks:** 12 (5 planned core tasks + 7 user-requested improvements)
- **Files modified:** 1

## Accomplishments
- Restructured 7 accordions → 5 sections following studio workflow order
- Consolidated musical profile into 2nd accordion (Profil Artistique) - core business focus
- Unified all contact info in single Coordonnées accordion with subsections
- Implemented 3-column grid layout for all array contact fields (phones, emails, websites, addresses)
- Standardized all action icons (Plus and Trash2) to consistent gray color
- Added auto-fill logic for readonly "Nom complet" field from structured name components
- Improved field ordering: Type de client top, artistName above structured name
- Added Alt key shortcut to toggle all accordions open/collapsed
- Enhanced visual consistency: rounded select corners, consistent icon colors

## Task Commits

Each task was committed atomically:

1. **Task 1: Restructure 7 accordions to 5 fused sections** - `d523669` (refactor)
2. **Task 2: Create 6th separate accordion for Streaming Platforms** - `a8dbeae` (refactor)
3. **Task 3: User modifications (delete Relations Pro, move birthday/gender, keep only customFields)** - `ebcc787` (refactor)
4. **Task 4: Reorder accordions, set default state, add Alt key toggle** - `a3774f3` (feat)
5. **Task 5: Auto-fill Nom complet from structured fields** - `0b39e91` (feat)
6. **Task 6: Make Nom complet readonly** - `a3396f3` (fix)
7. **Task 7: Reorder Identité fields (artistName top, structured name below)** - `23ae908` (feat)
8. **Task 8: Move Type de client to top position** - `f1fced9` (feat)
9. **Task 9: Reorganize Coordonnées with cleaner structure** - `3d1d8e9` (feat)
10. **Task 10: Complete 3-column grid redesign for all contact fields** - `6cbc14a` (refactor)
11. **Task 11: Add rounded corners to all select elements** - `f3fa4b1` (style)
12. **Task 12: Standardize Trash2 icon colors** - `5630d73` (fix)
13. **Task 13: Standardize Plus icon colors** - `d60ddf5` (fix) ← Final fix after user reported black icons

**Plan metadata:** _(to be committed with SUMMARY.md and STATE.md)_

## Files Created/Modified
- `packages/client/src/components/ClientEditForm.tsx` - Complete accordion structure overhaul: 7→5 sections, 3-column grid contact fields, consistent icons, auto-fill readonly name field, Alt key toggle

## Decisions Made

**Major structural decisions:**
1. **Deleted Relations Professionnelles accordion** - Company members are managed in ClientDetailTabs CompanyMembersModal, not in edit form. Added info message redirecting users.
2. **Moved birthday and gender to Identité** - More logical grouping with personal identity fields than in separate "Personal" accordion.
3. **Simplified Notes Studio** - Kept only customFields array. Removed birthday/gender (moved to Identité).
4. **Reordered accordions** - Identité → Coordonnées → Profil Artistique → Streaming → Notes Studio (studio workflow priority).
5. **Default accordion state** - Only Identité open by default (reduced visual overwhelm, users can expand as needed).

**Field organization decisions:**
6. **Readonly auto-generated Nom complet** - Prevents manual editing that conflicts with structured name fields. Auto-fills from prefix, firstName, middleName, lastName, suffix.
7. **Type de client at top of Identité** - Critical business context must be visible first (determines if artistName or companyName is primary).
8. **artistName above structured name** - For artists/musicians, stage name is primary identity. Structured name (firstName, lastName) is secondary administrative data.
9. **3-column grid for contact arrays** - Consistent layout: 120px type selector | 1fr input field | 80px action buttons (Plus/Trash2).

**Visual consistency decisions:**
10. **Rounded corners on all selects** - Matches input field styling (rounded-md). Previous sharp corners were inconsistent.
11. **Consistent icon colors** - All Plus and Trash2 icons use text-muted-foreground (gray). Previous mix of black and gray was visually confusing.

**UX enhancement decisions:**
12. **Alt key accordion toggle** - Power user feature: Alt key opens all accordions if any closed, closes all if all open. No Ctrl/Meta/Shift modifiers (avoids conflicts).

## Deviations from Plan

**User requested 7 additional improvements after initial 5-accordion restructure:**

### 1. Delete Relations Professionnelles Accordion
- **Found during:** User review after Task 1
- **Issue:** User requested to delete entire Relations Professionnelles accordion (company members managed in modal, not edit form)
- **Fix:** Removed accordion completely, added info message in Identité about where company members are managed
- **Files modified:** ClientEditForm.tsx
- **Committed in:** `ebcc787` (Task 3)

### 2. Move Birthday and Gender to Identité
- **Found during:** User review after Task 1
- **Issue:** User requested birthday and gender fields moved from Personal/Notes Studio to Identité accordion
- **Fix:** Moved birthday and gender fields to bottom of Identité accordion
- **Files modified:** ClientEditForm.tsx
- **Committed in:** `ebcc787` (Task 3)

### 3. Keep Only customFields in Notes Studio
- **Found during:** User review after Task 1
- **Issue:** User requested Notes Studio contain only customFields array (birthday/gender moved, Relations Pro deleted)
- **Fix:** Simplified Notes Studio accordion to only customFields management
- **Files modified:** ClientEditForm.tsx
- **Committed in:** `ebcc787` (Task 3)

### 4. Reorder Accordions and Set Default State
- **Found during:** User review after Task 3
- **Issue:** User requested accordion order changed and only Identité open by default
- **Fix:** Reordered to Identité, Coordonnées, Profil Artistique, Streaming, Notes Studio. Set defaultValue to ["identite"].
- **Files modified:** ClientEditForm.tsx
- **Committed in:** `a3774f3` (Task 4)

### 5. Add Alt Key Toggle for Accordions
- **Found during:** User review after Task 4
- **Issue:** User requested keyboard shortcut to open/collapse all accordions
- **Fix:** Added Alt key listener with useEffect. If any accordion closed, Alt opens all. If all open, Alt closes all.
- **Files modified:** ClientEditForm.tsx
- **Committed in:** `a3774f3` (Task 4)

### 6. Make Nom Complet Readonly
- **Found during:** User review after Task 5 (auto-fill implemented)
- **Issue:** User requested Nom complet field be readonly (should only auto-generate, not manually editable)
- **Fix:** Added readOnly prop, bg-muted class, cursor-not-allowed class, placeholder "Se génère automatiquement"
- **Files modified:** ClientEditForm.tsx
- **Committed in:** `a3396f3` (Task 6)

### 7. Reorder Identité Fields (artistName Top)
- **Found during:** User review after Task 6
- **Issue:** User requested artistName moved above Nom complet and structured name fields
- **Fix:** Reordered Identité fields: Type de client, artistName, Nom complet, structured name fields (lastName, firstName, prefix, middleName, suffix), birthday, gender
- **Files modified:** ClientEditForm.tsx
- **Committed in:** `23ae908` (Task 7)

### 8. Move Type de Client to Top Position
- **Found during:** User review after Task 7
- **Issue:** User requested Type de client moved to very top of Identité accordion (critical business context)
- **Fix:** Moved Type de client to line 1 of Identité accordion fields
- **Files modified:** ClientEditForm.tsx
- **Committed in:** `f1fced9` (Task 8)

### 9. Reorganize Coordonnées with Subsections
- **Found during:** User review after Task 8
- **Issue:** User requested Coordonnées accordion reorganized with Contact and Adresses subsections
- **Fix:** Added subsection headers with visual separation (border-t). Contact section contains phones, emails, websites. Adresses section contains addresses array.
- **Files modified:** ClientEditForm.tsx
- **Committed in:** `3d1d8e9` (Task 9)

### 10. Implement 3-Column Grid for All Contact Fields
- **Found during:** User review after Task 9
- **Issue:** User requested 3-column grid layout (type | value | actions) for phones, emails, websites, addresses
- **Fix:** Implemented grid-cols-[120px_1fr_80px] layout for all 4 contact array types. Type selector 120px, input field flex-1, action buttons 80px (Plus + Trash2).
- **Files modified:** ClientEditForm.tsx
- **Committed in:** `6cbc14a` (Task 10)

### 11. Add Rounded Corners to All Select Elements
- **Found during:** User review after Task 10
- **Issue:** User requested all select elements have rounded corners for visual consistency
- **Fix:** Added rounded-md class to all select elements (prefix, gender, type selectors in contact arrays)
- **Files modified:** ClientEditForm.tsx
- **Committed in:** `f3fa4b1` (Task 11)

### 12. Standardize Trash2 Icon Colors
- **Found during:** User review after Task 11
- **Issue:** User reported some trash icons were black, some gray (inconsistent)
- **Fix:** Verified all 5 Trash2 icons already had text-muted-foreground class. Issue was actually Plus icons (see next deviation).
- **Files modified:** ClientEditForm.tsx
- **Committed in:** `5630d73` (Task 12)

### 13. Standardize Plus Icon Colors (Root Cause Fix)
- **Found during:** User review after Task 12 (still saw black icons)
- **Issue:** User still reported black icons after Trash2 fix. Investigation revealed Plus icons had no color class (inherited black from button text).
- **Fix:** Added text-muted-foreground class to all 5 Plus icons (phones, emails, websites, addresses, custom fields). Now all action icons consistent gray.
- **Files modified:** ClientEditForm.tsx
- **Committed in:** `d60ddf5` (Task 13)

---

**Total deviations:** 13 user-requested improvements (9 structural/organizational, 4 visual/UX)
**Impact on plan:** All deviations were user-driven improvements to enhance UX and visual consistency. Initial 5-accordion restructure completed as planned. Additional work refined field ordering, visual design, and accordion behavior based on user feedback. No scope creep - all changes improved usability and workflow alignment.

## Issues Encountered

**Icon color confusion:**
- Initial report of "black and gray trash icons" was actually Plus icons (black) vs Trash2 icons (gray)
- Trash2 icons already had text-muted-foreground class from Task 12
- Plus icons had no color class, inherited from button text color
- Resolved by adding text-muted-foreground to all Plus icons in Task 13

**No blocking issues** - Execution was iterative based on user review feedback after each batch of changes.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

**Ready for next phase:**
- ClientEditForm fully reorganized with 5 studio workflow-aligned accordions
- All vCard-enriched fields accessible (phones, emails, websites, addresses arrays)
- Consistent 3-column grid layout for contact fields
- Visual consistency complete (rounded corners, consistent icon colors)
- Auto-fill logic working for readonly Nom complet field
- Alt key shortcut functional for batch accordion operations
- TypeScript compilation clean (no errors)

**Future considerations:**
- Consider adding validation messages for required fields
- Potential to add inline help text for complex fields (e.g., structured name explanation)
- Could add keyboard shortcuts for other operations (e.g., Cmd+S to save)
- May want to add field-level undo/redo functionality
- Consider adding autosave draft functionality for long edit sessions

**No blockers** - Phase complete and ready for next feature development.

---
*Phase: 26.1-reorganisation-accordeons---logique-studio-d'enregistrement*
*Completed: 2026-01-21*
