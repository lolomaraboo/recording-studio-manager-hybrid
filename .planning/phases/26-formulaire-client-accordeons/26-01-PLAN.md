---
phase: 26-formulaire-client-accordeons
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/client/src/components/ClientEditForm.tsx
  - packages/client/src/pages/ClientDetail.tsx
autonomous: true

must_haves:
  truths:
    - "User can edit client information without wizard steps"
    - "Edit form uses same accordion structure as view mode"
    - "All 7 accordion sections display correctly"
    - "Form data saves when user clicks Save button"
    - "Cancel button discards changes and exits edit mode"
  artifacts:
    - path: "packages/client/src/components/ClientEditForm.tsx"
      provides: "Complete accordion-based edit form with 7 sections"
      min_lines: 700
    - path: "packages/client/src/pages/ClientDetail.tsx"
      provides: "Integration of ClientEditForm replacing ClientFormWizard"
      contains: "ClientEditForm"
  key_links:
    - from: "packages/client/src/pages/ClientDetail.tsx"
      to: "packages/client/src/components/ClientEditForm.tsx"
      via: "import and render in edit mode"
      pattern: "import.*ClientEditForm.*from"
    - from: "packages/client/src/components/ClientEditForm.tsx"
      to: "formData state"
      via: "props formData and setFormData"
      pattern: "formData.*setFormData"
---

<objective>
Replace wizard-based edit form with accordion pattern matching the view page design for consistent UX.

Purpose: Eliminate cognitive friction when switching between view and edit modes by using the same visual structure (tabs + accordions) in both contexts.

Output: ClientEditForm component with 7 accordion sections matching ClientDetailTabs structure, integrated into ClientDetail page.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Current implementation files
@packages/client/src/pages/ClientDetail.tsx
@packages/client/src/components/ClientEditForm.tsx
@packages/client/src/components/ClientFormWizard.tsx
@packages/client/src/components/ClientDetailTabs.tsx
</context>

<tasks>

<task type="auto">
  <name>Complete ClientEditForm with 7 accordion sections</name>
  <files>packages/client/src/components/ClientEditForm.tsx</files>
  <action>
    Complete the accordion-based edit form matching ClientDetailTabs structure. Currently only 2 accordions exist (Identity, Contact).

    **Add 5 missing accordion sections:**

    3. **Address** (accordion value="address"):
       - Simple address field (backward compat)
       - Structured address fields: street, city, postalCode, region, country
       - Multiple addresses array with type dropdown (home/work/other)
       - Add/Remove buttons for array management

    4. **Personal Information** (accordion value="personal"):
       - Birthday field (date input)
       - Gender field (select: Male/Female/Other/Prefer not to say)
       - Custom fields array (label, type, value) with Add/Remove
       - Same pattern as emails/phones arrays

    5. **Streaming Platforms** (accordion value="streaming"):
       - 11 streaming URL fields from music profile
       - Spotify, Apple Music, YouTube, SoundCloud, Bandcamp, Deezer, Tidal, Amazon Music, Audiomack, Beatport, Other platforms
       - Each field: Label + URL input
       - Use grid layout (2 columns on md+)

    6. **Professional Information** (accordion value="professional"):
       - Record label (text input)
       - Distributor (text input)
       - Manager contact (text input with link detection)
       - Publisher (text input)
       - Performance rights society (text input, e.g., "SACEM")

    7. **Career & Biography** (accordion value="career"):
       - Years active (text input, e.g., "2015-present")
       - Notable works (textarea, 3 rows)
       - Awards & recognition (textarea, 3 rows)
       - Biography (textarea, 5 rows)
       - Genres array (tags input, multiple selection)
       - Instruments array (tags input, multiple selection)

    **Implementation notes:**
    - Use consistent styling: Card wrapper, AccordionTrigger with padding, AccordionContent with space-y-3
    - All accordions open by default in defaultValue array
    - Keep formData and setFormData prop pattern
    - Use same input classes: "w-full px-3 py-2 border rounded-md mt-1"
    - Add label with "text-sm font-medium" class
    - Required fields marked with `<span className="text-destructive">*</span>`
    - Arrays use Plus/Trash2 icons for add/remove
    - Grid layout for related fields (md:grid-cols-2)

    **Preserve existing:**
    - Identity accordion (type toggle, name, structured name, artistName)
    - Contact accordion (email, phone, emails[], phones[], websites[])
    - Props interface (formData, setFormData, client)
  </action>
  <verify>
    ```bash
    # TypeScript compilation
    cd packages/client
    npx tsc --noEmit

    # Component has 7 accordions
    grep -c "AccordionItem value=" src/components/ClientEditForm.tsx
    # Should output: 7

    # File size increased significantly
    wc -l src/components/ClientEditForm.tsx
    # Should be ~700-800 lines (currently 386)
    ```
  </verify>
  <done>
    - ClientEditForm.tsx has 7 complete accordion sections
    - All music profile fields (22 fields from Phase 18.4) included
    - All vCard fields (structured name, contact arrays) included
    - TypeScript 0 errors
    - Consistent styling with existing accordions
  </done>
</task>

<task type="auto">
  <name>Replace ClientFormWizard with ClientEditForm in ClientDetail.tsx</name>
  <files>packages/client/src/pages/ClientDetail.tsx</files>
  <action>
    Replace wizard-based edit mode with accordion-based ClientEditForm.

    **Changes to ClientDetail.tsx:**

    1. **Update imports:**
       - Remove: `import { ClientFormWizard } from "@/components/ClientFormWizard";`
       - Add: `import { ClientEditForm } from "@/components/ClientEditForm";`

    2. **Remove wizard integration:**
       - Delete lines that reference ClientFormWizard
       - Delete handleUpdate function (currently line 113-127) - no longer needed as ClientEditForm doesn't use onSubmit callback

    3. **Update edit mode rendering:**
       - Edit mode now shows ClientEditForm WITHIN ClientDetailTabs "informations" tab
       - ClientDetailTabs already handles isEditing prop and shows different UI
       - No changes needed to tab structure - just ensure ClientEditForm is imported and available

    4. **Simplify save/cancel buttons:**
       - Sticky action bar (lines 308-321) remains unchanged
       - Save button calls handleUpdateField(formData) - entire form data
       - Cancel button calls toggleEditMode(false) - already correct

    **Key insight:** ClientDetailTabs.tsx (line 818) already handles rendering different UI based on isEditing prop. The wizard is NOT rendered in ClientDetail.tsx anymore (line 19 imports it but it's unused). ClientEditForm should be rendered INSIDE ClientDetailTabs when isEditing=true.

    **Actually check current usage:**
    - Line 19: Import exists
    - Search for actual usage: Is ClientFormWizard rendered anywhere?
    - If not used, just remove import
    - If used, replace with ClientEditForm pattern

    **Pattern verification:**
    Current flow is:
    - Edit button → toggleEditMode(true) → isEditing state
    - ClientDetailTabs receives isEditing prop
    - Tabs component shows edit fields when isEditing=true

    So ClientEditForm should be used INSIDE ClientDetailTabs, not in ClientDetail.tsx.

    **Correct action:**
    Remove unused ClientFormWizard import from ClientDetail.tsx. The actual edit form rendering happens in ClientDetailTabs.tsx (which we'll handle in Task 3).
  </action>
  <verify>
    ```bash
    # Verify no ClientFormWizard references
    grep -n "ClientFormWizard" packages/client/src/pages/ClientDetail.tsx
    # Should output: (empty)

    # Verify ClientEditForm import exists
    grep -n "ClientEditForm" packages/client/src/pages/ClientDetail.tsx
    # Should find import line

    # TypeScript compilation
    cd packages/client
    npx tsc --noEmit
    ```
  </verify>
  <done>
    - ClientFormWizard import removed from ClientDetail.tsx
    - ClientEditForm imported (ready for use in tabs)
    - TypeScript 0 errors
    - No breaking changes to existing functionality
  </done>
</task>

<task type="auto">
  <name>Integrate ClientEditForm into ClientDetailTabs</name>
  <files>packages/client/src/components/ClientDetailTabs.tsx</files>
  <action>
    Update ClientDetailTabs to render ClientEditForm accordion inside "Informations" tab when isEditing=true.

    **Current structure (line 818):**
    ClientDetailTabs has Tabs component with TabsList showing: Informations, Projets, Tracks, Sessions, Finances.

    The "informations" TabsContent likely contains view-only display of client fields organized in sections.

    **Required changes:**

    1. **Import ClientEditForm:**
       ```typescript
       import { ClientEditForm } from "./ClientEditForm";
       ```

    2. **Find "informations" TabsContent** (search for `<TabsContent value="informations">`):
       - Wrap existing view content in conditional: `{!isEditing && (...existing view sections...)}`
       - Add edit mode: `{isEditing && <ClientEditForm formData={formData} setFormData={setFormData} client={client} />}`

    3. **Verify props are passed correctly:**
       - ClientDetailTabs already receives: isEditing, formData, setFormData, client
       - These props are passed from ClientDetail.tsx (line 324-338)
       - Just pass them through to ClientEditForm

    **Pattern:**
    ```typescript
    <TabsContent value="informations">
      {!isEditing && (
        // ...existing view-only sections (Identity, Contact, Address, etc.)...
      )}
      {isEditing && (
        <ClientEditForm
          formData={formData}
          setFormData={setFormData}
          client={client}
        />
      )}
    </TabsContent>
    ```

    **Important:**
    - DO NOT remove existing view-only content
    - DO NOT modify other tabs (Projets, Tracks, Sessions, Finances)
    - Only wrap "informations" content in conditional
    - Preserve all existing functionality
  </action>
  <verify>
    ```bash
    # Verify import added
    grep -n "import.*ClientEditForm" packages/client/src/components/ClientDetailTabs.tsx

    # Verify conditional rendering
    grep -n "isEditing.*ClientEditForm" packages/client/src/components/ClientDetailTabs.tsx

    # TypeScript compilation
    cd packages/client
    npx tsc --noEmit

    # Build production bundle
    npm run build
    ```
  </verify>
  <done>
    - ClientEditForm imported in ClientDetailTabs.tsx
    - "informations" tab shows ClientEditForm when isEditing=true
    - View mode preserved (existing sections visible when isEditing=false)
    - TypeScript 0 errors
    - Production build successful
  </done>
</task>

<task type="auto">
  <name>Manual testing and visual validation</name>
  <files>packages/client/src/components/ClientEditForm.tsx</files>
  <action>
    Test the refactored edit form manually to ensure UX consistency.

    **Test procedure:**

    1. **Start development server:**
       ```bash
       cd /Users/marabook_m1/Documents/APP_HOME/CascadeProjects/windsurf-project/recording-studio-manager-hybrid
       ./start.sh
       ```

    2. **Navigate to client detail:**
       - Open http://localhost:5174/clients
       - Click any client to open detail page

    3. **Test edit mode:**
       - Click "Modifier" button
       - Verify ClientEditForm displays with 7 accordions
       - Verify all accordions open by default
       - Check accordion titles match view mode sections

    4. **Test each accordion:**
       - Identity: Type toggle, name, structured fields, artistName
       - Contact: Simple email/phone, arrays (emails, phones, websites)
       - Address: Simple address, structured address, addresses array
       - Personal: Birthday, gender, custom fields
       - Streaming: 11 streaming platform URLs
       - Professional: Label, distributor, manager, publisher, PRS
       - Career: Years active, notable works, awards, biography, genres, instruments

    5. **Test form functionality:**
       - Modify fields in each accordion
       - Click "Enregistrer les modifications"
       - Verify changes saved to database
       - Verify view mode shows updated data

    6. **Test cancel:**
       - Click "Modifier" again
       - Change some fields
       - Click "Annuler"
       - Verify changes discarded
       - Verify view mode unchanged

    7. **Test visual consistency:**
       - Compare edit mode accordion structure to view mode sections
       - Verify no visual jarring when toggling between view/edit
       - Check responsive behavior (mobile/tablet/desktop)

    **Expected behavior:**
    - ✅ Edit form uses accordion pattern (not wizard steps)
    - ✅ All 7 sections accessible without navigation
    - ✅ Visual structure matches view mode
    - ✅ Save persists changes correctly
    - ✅ Cancel discards changes correctly
    - ✅ No cognitive friction switching modes

    **Document any issues:**
    - Screenshot any visual inconsistencies
    - Note any missing fields or broken functionality
    - Check browser console for errors
  </action>
  <verify>
    Manual verification checklist:
    - [ ] Edit button opens accordion-based form
    - [ ] All 7 accordions render correctly
    - [ ] All fields editable and functional
    - [ ] Save button persists changes
    - [ ] Cancel button discards changes
    - [ ] Visual consistency with view mode
    - [ ] No console errors
    - [ ] Responsive on mobile/tablet
  </verify>
  <done>
    - All manual tests pass
    - Visual consistency confirmed
    - UX friction eliminated
    - Edit mode matches view mode structure
    - Client edit workflow smooth and intuitive
  </done>
</task>

</tasks>

<verification>
**Overall phase verification:**

1. **Code quality:**
   ```bash
   cd packages/client
   npx tsc --noEmit
   npm run build
   ```
   Expected: 0 TypeScript errors, successful production build

2. **Component structure:**
   ```bash
   # Verify 7 accordions
   grep -c 'AccordionItem value=' src/components/ClientEditForm.tsx
   # Expected: 7

   # Verify integration
   grep -n "ClientEditForm" src/pages/ClientDetail.tsx
   grep -n "ClientEditForm" src/components/ClientDetailTabs.tsx
   ```

3. **File size growth:**
   ```bash
   wc -l src/components/ClientEditForm.tsx
   # Expected: ~700-800 lines (from 386)
   ```

4. **No wizard references:**
   ```bash
   grep -r "ClientFormWizard" src/pages/ClientDetail.tsx
   # Expected: (empty)
   ```

5. **Functional testing:**
   - Manual test all 7 accordion sections
   - Verify save/cancel workflows
   - Check visual consistency view ↔ edit
</verification>

<success_criteria>
**Phase 26 complete when:**

- [x] ClientEditForm has 7 complete accordion sections (Identity, Contact, Address, Personal, Streaming, Professional, Career)
- [x] All 22 music profile fields included (from Phase 18.4)
- [x] All vCard enriched fields included (structured name, contact arrays, address arrays)
- [x] ClientFormWizard removed from ClientDetail.tsx
- [x] ClientEditForm integrated into ClientDetailTabs "informations" tab
- [x] Edit mode shows accordions (not wizard steps)
- [x] View mode preserved (no breaking changes)
- [x] Save button persists all changes correctly
- [x] Cancel button discards changes correctly
- [x] TypeScript 0 errors
- [x] Production build successful
- [x] Manual testing confirms visual consistency
- [x] No cognitive friction switching view ↔ edit modes
- [x] User can edit all client fields without wizard navigation

**User experience improvement:**
- Wizard pattern eliminated ✅
- Same visual structure in view and edit modes ✅
- All client information accessible in single scrollable form ✅
- No artificial navigation steps ✅
- Cognitive load reduced ✅
</success_criteria>

<output>
After completion, create `.planning/phases/26-formulaire-client-accordeons/26-01-SUMMARY.md` documenting:

- Component changes (ClientEditForm 7 accordions, ClientDetailTabs integration)
- Files modified (ClientEditForm.tsx, ClientDetail.tsx, ClientDetailTabs.tsx)
- Visual improvements (accordion pattern vs wizard)
- UX benefits (consistency, reduced cognitive load)
- Testing results (manual validation)
- Git commits (atomic commits per task)
</output>
