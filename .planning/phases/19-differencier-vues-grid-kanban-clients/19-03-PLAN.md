---
wave: 3
depends_on: [19-01]
files_modified:
  - packages/client/src/pages/Clients.tsx
autonomous: true
---

# 19-03: Refactor Kanban View for Workflow Management

Transform Kanban view into 2-column workflow layout with expanded context-rich cards showing full contact info, workflow indicators, and notes preview.

## Tasks

<task id="19-03-01">
Update Kanban column headers with better visual grouping and icons

**Current (lines 577-584):** Basic header with count badge

**Target (replace both column headers - Particuliers and Entreprises):**
```tsx
import { Users, Building2 } from "lucide-react"; // Add to imports at top

// Particuliers Column
<div className="space-y-4">
  <div className="flex items-center justify-between p-3 bg-muted rounded-lg">
    <h3 className="font-semibold flex items-center gap-2">
      <Users className="h-5 w-5 text-primary" />
      Particuliers
    </h3>
    <Badge variant="secondary">
      {filteredClients.filter(c => c.type === 'individual').length}
    </Badge>
  </div>
  {/* Cards follow... */}
</div>

// Entreprises Column
<div className="space-y-4">
  <div className="flex items-center justify-between p-3 bg-muted rounded-lg">
    <h3 className="font-semibold flex items-center gap-2">
      <Building2 className="h-5 w-5 text-primary" />
      Entreprises
    </h3>
    <Badge variant="secondary">
      {filteredClients.filter(c => c.type === 'company').length}
    </Badge>
  </div>
  {/* Cards follow... */}
</div>
```

**Rationale:**
- Icon adds visual identity to columns (Users for Particuliers, Building2 for Entreprises)
- text-primary maintains icon consistency with UI guidelines
- Rounded bg-muted background creates visual separation
- Makes columns feel like distinct workflow lanes

**Verification:**
- Icons visible and properly colored
- Count badge updates correctly
- Visual separation clear between columns
</task>

<task id="19-03-02">
Replace Kanban cards with expanded context-rich layout

**Current (lines 589-634, 656-701):** Minimal cards identical to Grid

**Target (replace card structure for both columns):**
```tsx
<Card key={client.id} className="hover:shadow-lg transition-shadow">
  <CardHeader className="pb-2">
    <div className="flex items-start gap-3">
      {/* Compact avatar - secondary to content */}
      <Avatar className="h-8 w-8">
        <AvatarImage src={client.type === 'company' ? client.logoUrl : client.avatarUrl} />
        <AvatarFallback className="text-xs font-semibold">
          {getInitials(client.name)}
        </AvatarFallback>
      </Avatar>

      <div className="flex-1 min-w-0">
        <CardTitle className="text-sm flex items-center gap-2">
          <span className="truncate">{client.name}</span>
          {client.accountsReceivable > 100000 && (
            <Star className="h-3 w-3 text-yellow-500 fill-yellow-500 flex-shrink-0" />
          )}
        </CardTitle>
        {client.artistName && (
          <CardDescription className="text-xs truncate">
            {client.artistName}
          </CardDescription>
        )}
      </div>
    </div>
  </CardHeader>

  <CardContent className="space-y-3">
    {/* Full contact info section */}
    <div className="space-y-1 text-xs">
      {client.phone && (
        <div className="flex items-center gap-2 text-muted-foreground">
          <Phone className="h-3 w-3 flex-shrink-0" />
          <a
            href={`tel:${client.phone}`}
            className="hover:underline"
            onClick={(e) => e.stopPropagation()}
          >
            {client.phone}
          </a>
        </div>
      )}
      {client.email && (
        <div className="flex items-center gap-2 text-muted-foreground">
          <Mail className="h-3 w-3 flex-shrink-0" />
          <a
            href={`mailto:${client.email}`}
            className="hover:underline truncate"
            onClick={(e) => e.stopPropagation()}
          >
            {client.email}
          </a>
        </div>
      )}
      {client.city && (
        <div className="flex items-center gap-2 text-muted-foreground">
          <MapPin className="h-3 w-3 flex-shrink-0" />
          <span className="truncate">{client.city}</span>
        </div>
      )}
    </div>

    {/* Workflow indicators - Extended context */}
    <div className="space-y-2 text-xs border-t pt-2">
      <div className="flex justify-between items-center">
        <span className="text-muted-foreground">Sessions:</span>
        <span className="font-medium">{client.sessionsCount}</span>
      </div>
      <div className="flex justify-between items-center">
        <span className="text-muted-foreground">Dernière session:</span>
        <span className="font-medium">
          {client.lastSessionAt
            ? format(new Date(client.lastSessionAt), "dd MMM yyyy", { locale: fr })
            : "Jamais"
          }
        </span>
      </div>
      {client.accountsReceivable > 0 && (
        <div className="flex justify-between items-center">
          <span className="text-muted-foreground">Comptes débiteurs:</span>
          <span
            className={cn(
              "font-medium",
              client.accountsReceivable > 100000 ? "text-orange-600" : ""
            )}
          >
            {(client.accountsReceivable / 100).toFixed(2)}€
          </span>
        </div>
      )}
    </div>

    {/* Notes preview (if exists) */}
    {client.notes && (
      <div className="text-xs text-muted-foreground border-t pt-2">
        <p className="line-clamp-2">{client.notes}</p>
      </div>
    )}

    {/* Action button - more descriptive */}
    <Button
      variant="outline"
      size="sm"
      className="w-full"
      asChild
    >
      <Link to={`/clients/${client.id}`}>
        <Eye className="h-3 w-3 mr-2" />
        Voir détails complet
      </Link>
    </Button>
  </CardContent>
</Card>
```

**Rationale:**
- Avatar h-8 w-8 (32px) is compact - content is primary focus
- Shows all contact methods (phone, email, city) for full context
- Workflow indicators section with border-t visual separation
- Session history shows last activity (key workflow metric)
- Notes preview (line-clamp-2) provides context without overwhelming
- Button text "Voir détails complet" indicates comprehensive view available
- hover:shadow-lg (vs shadow-md in Grid) emphasizes expanded nature

**Verification:**
- All contact info displays correctly
- Session date formats properly (French locale)
- Notes preview truncates at 2 lines
- Cards stack properly in column
- No horizontal overflow on mobile
</task>

<task id="19-03-03">
Import MapPin icon for city/address display

**Location:** Add to imports at top of Clients.tsx

**Implementation:**
```tsx
import { MapPin } from "lucide-react"; // Add MapPin to existing lucide-react imports
```

**Rationale:**
- Kanban cards display city field, needs MapPin icon
- Maintains icon consistency across the application

**Verification:**
- MapPin icon displays correctly next to city field
- Icon size h-3 w-3 matches other contact icons
</task>

## Verification Criteria

- [ ] Kanban uses 2 fixed columns (Particuliers | Entreprises)
- [ ] Column headers show icons (Users, Building2) + count badges
- [ ] Cards show expanded context (all contacts, workflow indicators, notes preview)
- [ ] Workflow section displays sessions count + last session date + receivables
- [ ] Notes preview uses line-clamp-2 for truncation
- [ ] Button text "Voir détails complet" (vs Grid "Voir")
- [ ] TypeScript compilation passes (pnpm check)
- [ ] No console errors in browser

## must_haves

- Kanban layout: 2 columns desktop (lg:grid-cols-2), 1 column mobile
- Column headers: bg-muted rounded with icons (h-5 w-5 text-primary)
- Cards show: avatar + full contact + workflow metrics + notes preview
- Workflow indicators: sessions count, last session date (French format), accounts receivable
- Button "Voir détails complet" (descriptive, not compact like Grid)
- Notes preview limited to 2 lines with line-clamp-2
