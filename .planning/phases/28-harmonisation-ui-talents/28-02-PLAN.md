---
phase: 28-harmonisation-ui-talents
plan: 02
type: execute
wave: 2
depends_on: [28-01]
files_modified:
  - packages/client/src/pages/Talents.tsx
  - packages/client/src/components/TalentEditForm.tsx (new file)
autonomous: true

must_haves:
  truths:
    - "Users can toggle between Table, Grid, Kanban views with button controls"
    - "View mode preference persists in localStorage across sessions"
    - "Copy-to-clipboard works for email and phone with toast feedback"
    - "Avatars display photos or initials fallback"
    - "Stats cards show 4 KPIs with proper formatting"
  artifacts:
    - path: "packages/client/src/pages/Talents.tsx"
      provides: "ViewMode state, CopyButton, Avatar rendering, Stats cards"
      min_lines: 800
      contains: "type ViewMode = 'table' | 'grid' | 'kanban'"
    - path: "packages/client/src/components/TalentEditForm.tsx"
      provides: "Accordion-based edit form (extracted from Clients pattern)"
      min_lines: 600
  key_links:
    - from: "Talents.tsx ViewMode state"
      to: "localStorage.getItem('talentsViewMode')"
      via: "useState initialization + useEffect persistence"
      pattern: "localStorage\\.(get|set)Item"
---

<objective>
Add core UI components to Talents.tsx: ViewMode toggle, stats cards, CopyButton, avatars, and accordion-based TalentEditForm.

Purpose: Establish foundation components before implementing view-specific layouts
Output: Talents.tsx with all shared components, TalentEditForm.tsx created
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/28-harmonisation-ui-talents/28-CONTEXT.md
@.planning/phases/28-harmonisation-ui-talents/28-01-SUMMARY.md

# Reference implementations
@packages/client/src/pages/Clients.tsx (lines 1-300) - ViewMode, stats, CopyButton patterns
@packages/client/src/components/ClientEditForm.tsx (accordion pattern for TalentEditForm)

# Current implementation
@packages/client/src/pages/Talents.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add ViewMode state and toggle buttons</name>
  <files>packages/client/src/pages/Talents.tsx</files>
  <action>
**Copy exact pattern from Clients.tsx lines 36-38, 120-134:**

1. **Add type definitions at top of file:**
   ```typescript
   type ViewMode = 'table' | 'grid' | 'kanban';
   type SortField = 'name' | 'talentType' | 'sessions' | 'lastSession';
   type SortOrder = 'asc' | 'desc';
   ```

2. **Add state with localStorage initialization:**
   ```typescript
   const [viewMode, setViewMode] = useState<ViewMode>(() => {
     const saved = localStorage.getItem('talentsViewMode');
     return (saved as ViewMode) || 'table';
   });
   const [sortField, setSortField] = useState<SortField>('name');
   const [sortOrder, setSortOrder] = useState<SortOrder>('asc');
   ```

3. **Add persistence effect (after state declarations):**
   ```typescript
   useEffect(() => {
     localStorage.setItem('talentsViewMode', viewMode);
   }, [viewMode]);
   ```

4. **Add toggle buttons in CardHeader (lines ~481-511 pattern from Clients.tsx):**
   ```typescript
   <div className="flex gap-1">
     <Button
       variant={viewMode === 'table' ? 'default' : 'outline'}
       size="sm"
       onClick={() => setViewMode('table')}
     >
       <TableIcon className="h-3 w-3" />
     </Button>
     <Button
       variant={viewMode === 'grid' ? 'default' : 'outline'}
       size="sm"
       onClick={() => setViewMode('grid')}
     >
       <Grid className="h-3 w-3" />
     </Button>
     <Button
       variant={viewMode === 'kanban' ? 'default' : 'outline'}
       size="sm"
       onClick={() => setViewMode('kanban')}
     >
       <Columns className="h-3 w-3" />
     </Button>
   </div>
   ```

5. **Add icons to imports:**
   Add `TableIcon, Grid, Columns` to lucide-react imports (line 33)

**Note:** Keep existing table view rendering intact - just wrap in conditional `{viewMode === 'table' && (...)}`
  </action>
  <verify>
1. Click Table/Grid/Kanban buttons - active button highlighted
2. Refresh page - viewMode persists (check localStorage in DevTools)
3. TypeScript 0 errors
4. Buttons responsive on mobile (gap-1 spacing)
  </verify>
  <done>
- ViewMode state with 3 modes (table/grid/kanban)
- localStorage persistence working
- Toggle buttons styled correctly
- Active button shows default variant
  </done>
</task>

<task type="auto">
  <name>Task 2: Add stats cards with musician-specific KPIs</name>
  <files>packages/client/src/pages/Talents.tsx</files>
  <action>
**Replace existing stats section (lines 123-151) with 4-card layout:**

**Pattern reference:** Clients.tsx doesn't have stats cards in header (removed in refactor), but structure follows Phase 19 Grid/Kanban patterns

1. **Update query to use new getStats endpoint:**
   ```typescript
   const { data: stats } = trpc.musicians.getStats.useQuery();
   ```

2. **Create 4-card grid layout (insert after header, before search card):**
   ```typescript
   {/* Stats Cards */}
   {stats && (
     <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-4">
       <Card>
         <CardHeader className="pb-3">
           <CardDescription className="text-sm">Total talents</CardDescription>
           <CardTitle className="text-3xl">{stats.total}</CardTitle>
         </CardHeader>
       </Card>

       <Card>
         <CardHeader className="pb-3">
           <CardDescription className="text-sm">Performers VIP</CardDescription>
           <CardTitle className="text-3xl flex items-center gap-2">
             {stats.vipPerformers}
             <Star className="h-5 w-5 text-yellow-500 fill-yellow-500" />
           </CardTitle>
         </CardHeader>
       </Card>

       <Card>
         <CardHeader className="pb-3">
           <CardDescription className="text-sm">Total sessions</CardDescription>
           <CardTitle className="text-3xl">{stats.totalSessions}</CardTitle>
         </CardHeader>
       </Card>

       <Card>
         <CardHeader className="pb-3">
           <CardDescription className="text-sm">Dernière session</CardDescription>
           <CardTitle className="text-lg">
             {stats.lastSessionDate ?
               format(new Date(stats.lastSessionDate), "dd MMM yyyy", { locale: fr })
               : "Jamais"
             }
           </CardTitle>
         </CardHeader>
       </Card>
     </div>
   )}
   ```

3. **Add Star icon to imports** (lucide-react)
4. **Import date-fns helpers:** `import { format } from "date-fns"; import { fr } from "date-fns/locale";`

**KPIs explained:**
- Total talents: Total count of musicians
- Performers VIP: Musicians with >10 sessions (high-volume)
- Total sessions: Sum of all sessions with musician assignments
- Dernière session: Most recent session date across all musicians
  </action>
  <verify>
1. Stats cards display with correct data
2. VIP card shows Star icon
3. Date formatting French locale (ex: "22 janv 2026")
4. Cards responsive (2 cols on md, 4 on lg)
  </verify>
  <done>
- 4 stats cards displayed above search section
- Stats match backend data
- Icons and formatting correct
- Responsive grid layout working
  </done>
</task>

<task type="auto">
  <name>Task 3: Add CopyButton component and Avatar rendering</name>
  <files>packages/client/src/pages/Talents.tsx</files>
  <action>
**Copy CopyButton component from Clients.tsx lines 43-62:**

1. **Add CopyButton function component (before main component):**
   ```typescript
   function CopyButton({ text, label }: { text: string; label: string }) {
     const handleCopy = (e: React.MouseEvent) => {
       e.preventDefault();
       e.stopPropagation();
       navigator.clipboard.writeText(text);
       toast.success(`${label} copié!`);
     };

     return (
       <Button
         variant="ghost"
         size="icon"
         className="h-5 w-5 p-0"
         onClick={handleCopy}
         title={`Copier ${label.toLowerCase()}`}
       >
         <Copy className="h-3 w-3" />
       </Button>
     );
   }
   ```

2. **Add Copy icon to imports** (lucide-react)
3. **Import toast:** `import { toast } from "sonner";`

4. **Add Avatar component import:**
   ```typescript
   import { Avatar, AvatarImage, AvatarFallback } from "@/components/ui/avatar";
   ```

5. **Add getInitials utility import:**
   ```typescript
   import { cn, getInitials } from "@/lib/utils";
   ```

**Usage in table (will be applied in Task 4):**
- Email: `<CopyButton text={talent.email} label="Email" />`
- Phone: `<CopyButton text={talent.phone} label="Téléphone" />`

**Avatar pattern (from Clients.tsx Grid view lines 732-737):**
```typescript
<Avatar className="h-12 w-12">
  <AvatarImage src={talent.imageUrl ?? undefined} />
  <AvatarFallback className="text-sm font-semibold">
    {getInitials(talent.name)}
  </AvatarFallback>
</Avatar>
```

**Note:** Don't modify table rendering yet - just add components. Task 4 will integrate them.
  </action>
  <verify>
1. CopyButton defined as standalone function
2. Avatar imports successful
3. getInitials utility available
4. toast imported from sonner
5. TypeScript 0 errors
  </verify>
  <done>
- CopyButton component functional
- Avatar component imported
- getInitials utility available
- Ready for use in view implementations
  </done>
</task>

</tasks>

<verification>
**UI functionality checks:**

1. **ViewMode toggle:**
   - Click each button (Table/Grid/Kanban)
   - Verify localStorage updates (`talentsViewMode` key)
   - Refresh page - mode persists

2. **Stats cards:**
   - All 4 cards display correct data
   - VIP card shows Star icon
   - Date formats correctly (French locale)
   - Responsive layout (check mobile, tablet, desktop)

3. **Components ready:**
   - CopyButton function defined
   - Avatar imports successful
   - No console errors

**TypeScript checks:**
```bash
pnpm --filter client check
```

**Build test:**
```bash
pnpm --filter client build
```
</verification>

<success_criteria>
- [ ] ViewMode state with 3 modes defined
- [ ] Toggle buttons render and function correctly
- [ ] localStorage persistence working
- [ ] 4 stats cards display with correct data
- [ ] CopyButton component defined and ready
- [ ] Avatar component imported
- [ ] getInitials utility available
- [ ] TypeScript 0 errors
- [ ] Client builds successfully
</success_criteria>

<output>
After completion, create `.planning/phases/28-harmonisation-ui-talents/28-02-SUMMARY.md`
</output>
