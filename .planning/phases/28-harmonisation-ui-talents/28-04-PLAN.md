---
phase: 28-harmonisation-ui-talents
plan: 04
type: execute
wave: 4
depends_on: [28-03]
files_modified:
  - packages/client/src/pages/TalentDetail.tsx
  - packages/client/src/components/TalentDetailTabs.tsx (new file)
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Talent detail page displays in tabbed interface like ClientDetail"
    - "View mode shows organized sections with visual hierarchy"
    - "Edit mode uses same component, not separate form"
    - "Stats cards display key metrics (sessions, last activity, etc.)"
  artifacts:
    - path: "packages/client/src/components/TalentDetailTabs.tsx"
      provides: "Tabbed detail interface for talents"
      min_lines: 400
      exports: ["TalentDetailTabs"]
    - path: "packages/client/src/pages/TalentDetail.tsx"
      provides: "Talent detail page using tabs pattern"
      min_lines: 200
      contains: "TalentDetailTabs"
  key_links:
    - from: "TalentDetail.tsx"
      to: "TalentDetailTabs component"
      via: "import and render with props"
      pattern: "import.*TalentDetailTabs"
    - from: "TalentDetailTabs"
      to: "trpc.musicians queries"
      via: "useQuery for related data"
      pattern: "trpc\\.musicians\\."
---

<objective>
Harmonize TalentDetail page with ClientDetail pattern using tabbed interface, organized sections, and consistent visual hierarchy.

Purpose: Complete Phase 28 harmonization by modernizing talent detail page to match Phases 22-26 client improvements
Output: TalentDetailTabs component and refactored TalentDetail page
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/28-harmonisation-ui-talents/28-CONTEXT.md
@.planning/phases/28-harmonisation-ui-talents/28-01-SUMMARY.md
@.planning/phases/28-harmonisation-ui-talents/28-02-SUMMARY.md
@.planning/phases/28-harmonisation-ui-talents/28-03-SUMMARY.md

# Reference implementations (CLIENT patterns)
@packages/client/src/components/ClientDetailTabs.tsx (reference pattern)
@packages/client/src/pages/ClientDetail.tsx (main page structure)

# Current talent implementation
@packages/client/src/pages/TalentDetail.tsx (current state - needs harmonization)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TalentDetailTabs component</name>
  <files>packages/client/src/components/TalentDetailTabs.tsx</files>
  <action>
**Pattern reference:** ClientDetailTabs.tsx structure (tabs, view/edit modes, organized sections)

**Create new file with tabbed interface:**

1. **Component structure (adapt from ClientDetailTabs):**
   ```typescript
   import { useState } from "react";
   import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
   import { Card, CardContent } from "@/components/ui/card";
   import { Separator } from "@/components/ui/separator";
   import { Button } from "@/components/ui/button";
   import {
     Info,
     Calendar,
     Music,
     DollarSign,
     Mail,
     Phone,
     Globe,
     MapPin,
   } from "lucide-react";

   interface TalentDetailTabsProps {
     talentId: number;
     activeTab: string;
     onTabChange: (tab: string) => void;
     talent: any;
     isEditing: boolean;
     formData: any;
     setFormData: (data: any) => void;
     handleUpdateField: (updates: any) => void;
   }

   export function TalentDetailTabs({
     talentId,
     activeTab,
     onTabChange,
     talent,
     isEditing,
     formData,
     setFormData,
     handleUpdateField,
   }: TalentDetailTabsProps) {
     // Component implementation
   }
   ```

2. **Tab structure (4 tabs matching client pattern):**
   - **Informations** - Basic info, contact, music profile (view/edit modes)
   - **Sessions** - Sessions where talent participated
   - **Projets** - Projects involving this talent
   - **Finances** - Invoices related to talent

3. **Informations tab - View mode sections:**
   - **Section 1: Identité** (name, stageName, talentType badge)
   - **Section 2: Contact** (email, phone, website with icons)
   - **Section 3: Profil Musical** (instruments, genres, bio)
   - **Section 4: Plateformes Streaming** (Spotify, Apple Music, etc. if available)

4. **View mode layout pattern (from ClientDetailTabs lines 150-400):**
   ```typescript
   {!isEditing && (
     <div className="space-y-4">
       {/* Section: Identité */}
       <div>
         <h3 className="text-sm font-semibold mb-2 flex items-center gap-2">
           <User className="h-4 w-4 text-primary" />
           Identité
         </h3>
         <div className="grid gap-2">
           <div className="grid grid-cols-3">
             <span className="text-sm text-muted-foreground">Nom complet</span>
             <span className="col-span-2 text-sm">{talent.name}</span>
           </div>
           {talent.stageName && (
             <div className="grid grid-cols-3">
               <span className="text-sm text-muted-foreground">Nom de scène</span>
               <span className="col-span-2 text-sm">{talent.stageName}</span>
             </div>
           )}
           <div className="grid grid-cols-3">
             <span className="text-sm text-muted-foreground">Type</span>
             <Badge variant="outline">{TALENT_TYPE_LABELS[talent.talentType]}</Badge>
           </div>
         </div>
       </div>
       <Separator />

       {/* Section: Contact */}
       <div>
         <h3 className="text-sm font-semibold mb-2 flex items-center gap-2">
           <Mail className="h-4 w-4 text-primary" />
           Contact
         </h3>
         <div className="grid gap-2">
           {talent.email && (
             <div className="grid grid-cols-3">
               <span className="text-sm text-muted-foreground">Email</span>
               <a href={`mailto:${talent.email}`} className="col-span-2 text-sm hover:underline">
                 {talent.email}
               </a>
             </div>
           )}
           {talent.phone && (
             <div className="grid grid-cols-3">
               <span className="text-sm text-muted-foreground">Téléphone</span>
               <a href={`tel:${talent.phone}`} className="col-span-2 text-sm hover:underline">
                 {talent.phone}
               </a>
             </div>
           )}
           {talent.website && (
             <div className="grid grid-cols-3">
               <span className="text-sm text-muted-foreground">Site web</span>
               <a href={talent.website} target="_blank" rel="noopener" className="col-span-2 text-sm hover:underline">
                 {talent.website}
               </a>
             </div>
           )}
         </div>
       </div>
       <Separator />

       {/* Section: Profil Musical */}
       <div>
         <h3 className="text-sm font-semibold mb-2 flex items-center gap-2">
           <Music className="h-4 w-4 text-primary" />
           Profil Musical
         </h3>
         <div className="grid gap-2">
           {talent.instruments && (
             <div className="grid grid-cols-3">
               <span className="text-sm text-muted-foreground">Instruments</span>
               <span className="col-span-2 text-sm">
                 {(() => {
                   try {
                     const parsed = JSON.parse(talent.instruments);
                     return Array.isArray(parsed) ? parsed.join(", ") : talent.instruments;
                   } catch { return talent.instruments; }
                 })()}
               </span>
             </div>
           )}
           {talent.genres && (
             <div className="grid grid-cols-3">
               <span className="text-sm text-muted-foreground">Genres</span>
               <span className="col-span-2 text-sm">
                 {(() => {
                   try {
                     const parsed = JSON.parse(talent.genres);
                     return Array.isArray(parsed) ? parsed.join(", ") : talent.genres;
                   } catch { return talent.genres; }
                 })()}
               </span>
             </div>
           )}
           {talent.bio && (
             <div className="grid grid-cols-3">
               <span className="text-sm text-muted-foreground">Biographie</span>
               <span className="col-span-2 text-sm whitespace-pre-line">{talent.bio}</span>
             </div>
           )}
         </div>
       </div>
     </div>
   )}
   ```

5. **Edit mode - Import TalentEditForm (to be created in 28-05):**
   ```typescript
   {isEditing && (
     <TalentEditForm
       formData={formData}
       setFormData={setFormData}
     />
   )}
   ```

6. **Sessions/Projets/Finances tabs - Placeholder for now:**
   ```typescript
   <TabsContent value="sessions">
     <Card>
       <CardContent className="pt-6">
         <p className="text-sm text-muted-foreground">
           Sessions impliquant ce talent à venir dans une future phase.
         </p>
       </CardContent>
     </Card>
   </TabsContent>
   ```

**Key differences from ClientDetailTabs:**
- No company members section (talents are individuals)
- Music profile section (instruments, genres, bio)
- Simpler structure (talents don't have addresses, custom fields, etc.)
- No avatar/logo upload in view mode (keep simple)

**Why new component:** Separation of concerns, reusability, matches client pattern consistency
  </action>
  <verify>
1. Component exports TalentDetailTabs
2. TypeScript 0 errors on component definition
3. Tabs structure includes 4 tabs (Informations, Sessions, Projets, Finances)
4. View mode sections organized with Separator components
5. JSON parsing for instruments/genres works correctly
  </verify>
  <done>
- TalentDetailTabs.tsx created with 4-tab structure
- View mode displays organized sections (Identité, Contact, Profil Musical)
- Edit mode conditional on TalentEditForm (placeholder import for 28-05)
- Sessions/Projets/Finances tabs with placeholders
- TypeScript compiles without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Refactor TalentDetail.tsx to use TalentDetailTabs</name>
  <files>packages/client/src/pages/TalentDetail.tsx</files>
  <action>
**Pattern reference:** ClientDetail.tsx (lines 1-150) - main page structure with tabs integration

**Refactor steps:**

1. **Import TalentDetailTabs:**
   ```typescript
   import { TalentDetailTabs } from "@/components/TalentDetailTabs";
   ```

2. **Add activeTab state (like ClientDetail line 42):**
   ```typescript
   const [activeTab, setActiveTab] = useState("informations");
   ```

3. **Keep existing state and mutations** (isEditing, formData, updateMutation, deleteMutation)

4. **Simplify page layout (remove inline form, use tabs):**
   ```typescript
   return (
     <div className="container pt-2 pb-4 px-2">
       <div className="space-y-2">
         {/* Header */}
         <div className="flex items-center justify-between">
           <div className="flex items-center gap-4">
             <Link to="/talents">
               <Button variant="ghost" size="icon">
                 <ArrowLeft className="h-5 w-5" />
               </Button>
             </Link>
             <div>
               <h1 className="text-3xl font-bold flex items-center gap-2">
                 <Music className="h-8 w-8 text-primary" />
                 {talent?.name || "Talent"}
               </h1>
               {talent?.stageName && (
                 <p className="text-muted-foreground">{talent.stageName}</p>
               )}
             </div>
           </div>

           {/* Action buttons */}
           <div className="flex gap-2">
             {!isEditing && (
               <>
                 <Button onClick={() => setIsEditing(true)}>
                   <Edit className="h-4 w-4 mr-2" />
                   Modifier
                 </Button>
                 <Button variant="destructive" onClick={() => setShowDeleteDialog(true)}>
                   <Trash2 className="h-4 w-4" />
                 </Button>
               </>
             )}
             {isEditing && (
               <>
                 <Button onClick={handleSave} disabled={updateMutation.isPending}>
                   <Save className="h-4 w-4 mr-2" />
                   Enregistrer
                 </Button>
                 <Button variant="outline" onClick={() => setIsEditing(false)}>
                   <X className="h-4 w-4 mr-2" />
                   Annuler
                 </Button>
               </>
             )}
           </div>
         </div>

         {/* Tabs Component */}
         <TalentDetailTabs
           talentId={Number(id)}
           activeTab={activeTab}
           onTabChange={setActiveTab}
           talent={talent}
           isEditing={isEditing}
           formData={formData}
           setFormData={setFormData}
           handleUpdateField={handleUpdateField}
         />

         {/* Delete Dialog (keep existing) */}
         <Dialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>
           {/* Existing delete dialog content */}
         </Dialog>
       </div>
     </div>
   );
   ```

5. **Add handleUpdateField helper (like ClientDetail):**
   ```typescript
   const handleUpdateField = (updates: any) => {
     setFormData((prev: any) => ({ ...prev, ...updates }));
   };
   ```

6. **Add handleSave function:**
   ```typescript
   const handleSave = () => {
     updateMutation.mutate({
       id: Number(id),
       ...formData,
     });
   };
   ```

7. **Remove inline form sections** (all the Card/CardContent edit UI that's currently in TalentDetail.tsx lines 100-300+)

**Result:** TalentDetail.tsx becomes ~150-200 lines (down from ~400+), all UI logic moves to TalentDetailTabs
  </action>
  <verify>
1. Navigate to /talents/:id - page loads with tabs
2. View mode displays organized sections
3. Click "Modifier" - isEditing state changes (edit mode ready for 28-05)
4. Click "Annuler" - returns to view mode
5. Delete dialog still functional
6. TypeScript 0 errors
  </verify>
  <done>
- TalentDetail.tsx refactored to use TalentDetailTabs
- Page structure simplified (~200 lines from ~400+)
- Header with edit/save/cancel buttons
- Active tab state management
- handleUpdateField and handleSave functions added
- Delete dialog preserved
- TypeScript compiles successfully
  </done>
</task>

<task type="auto">
  <name>Task 3: Build and verify harmonization</name>
  <files>packages/client/src/pages/TalentDetail.tsx, packages/client/src/components/TalentDetailTabs.tsx</files>
  <action>
**Verification steps:**

1. **TypeScript check:**
   ```bash
   pnpm --filter client check
   ```

2. **Build test:**
   ```bash
   pnpm --filter client build
   ```

3. **Visual comparison checklist:**
   - TalentDetail page structure matches ClientDetail (header, tabs, actions)
   - View mode sections use same visual hierarchy (icons, labels, grid layout)
   - Edit button behavior consistent (toggle to edit mode)
   - Tab navigation works (4 tabs: Informations, Sessions, Projets, Finances)

4. **Document completion in commit:**
   ```bash
   git add packages/client/src/components/TalentDetailTabs.tsx packages/client/src/pages/TalentDetail.tsx
   git commit -m "feat(28-04): harmonize TalentDetail with ClientDetail pattern

Phase 28 Gap Closure Plan 04: TalentDetail Harmonization
- Created TalentDetailTabs component (4 tabs: Informations, Sessions, Projets, Finances)
- Refactored TalentDetail.tsx to use tabs pattern (~200 lines from ~400+)
- View mode: organized sections (Identité, Contact, Profil Musical)
- Edit mode: ready for TalentEditForm integration (28-05)
- Sessions/Projets/Finances tabs: placeholders for future phases
- Harmonization complete: matches ClientDetail UX patterns

Gap addressed: TalentDetail page modernized with accordion-based detail view
Pattern reference: Phases 22-26 client improvements (tabs, sections, visual hierarchy)

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>"
   ```

**Success indicators:**
- ✓ Build successful (zero errors)
- ✓ TypeScript passes
- ✓ Page renders with tabs
- ✓ View/edit toggle works
- ✓ Visual hierarchy matches clients
  </action>
  <verify>
1. TypeScript check passes (0 errors)
2. Build completes successfully
3. No console errors when visiting /talents/:id
4. Tab navigation functional
5. View mode displays all sections correctly
6. Git commit created with descriptive message
  </verify>
  <done>
- TypeScript 0 errors confirmed
- Production build successful
- TalentDetail harmonized with ClientDetail patterns
- Visual hierarchy consistent (icons, sections, separators)
- Gap closure plan 28-04 complete
- Ready for 28-05 (TalentEditForm)
  </done>
</task>

</tasks>

<verification>
**Harmonization checks:**

1. **Visual consistency:**
   - TalentDetail uses same tab structure as ClientDetail
   - Section headers with icons match client patterns
   - Grid layout (grid-cols-3) for label/value pairs
   - Separator components between sections

2. **Functional parity:**
   - Edit/Save/Cancel button workflow
   - Tab navigation (activeTab state)
   - Delete confirmation dialog
   - Form data mutations

3. **Code quality:**
   - Component separation (page vs tabs)
   - TypeScript strict compliance
   - Reusable patterns from client implementation

**Gap closure verification:**
- [x] TalentDetail page structure modernized
- [x] Tabbed interface implemented
- [x] View mode organized sections
- [x] Edit mode integration ready (28-05)
- [x] Visual hierarchy matches ClientDetail
</verification>

<success_criteria>
- [ ] TalentDetailTabs component created with 4 tabs
- [ ] View mode displays organized sections (Identité, Contact, Profil Musical)
- [ ] TalentDetail.tsx refactored to use tabs (~200 lines)
- [ ] Edit/Save/Cancel button workflow functional
- [ ] Delete dialog preserved and working
- [ ] TypeScript 0 errors
- [ ] Client builds successfully
- [ ] Visual hierarchy matches ClientDetail patterns
- [ ] Gap addressed: Detail page harmonized with Phases 22-26 patterns
</success_criteria>

<output>
After completion, create `.planning/phases/28-harmonisation-ui-talents/28-04-SUMMARY.md`
</output>
