---
phase: 28-harmonisation-ui-talents
plan: 03
type: execute
wave: 3
depends_on: [28-02]
files_modified:
  - packages/client/src/pages/Talents.tsx
autonomous: true

must_haves:
  truths:
    - "Table view shows all talents in sortable columns with copy buttons"
    - "Grid view displays cards with avatars and compact stats"
    - "Kanban view shows talents by type (Musician/Actor) with full details"
    - "All views use same data source and filtering logic"
    - "Conditional rendering based on viewMode state"
  artifacts:
    - path: "packages/client/src/pages/Talents.tsx"
      provides: "3 complete view implementations"
      min_lines: 1200
      contains: "{viewMode === 'table' &&", "{viewMode === 'grid' &&", "{viewMode === 'kanban' &&"
  key_links:
    - from: "Talents.tsx viewMode state"
      to: "Table/Grid/Kanban rendering blocks"
      via: "conditional ternary expressions"
      pattern: "viewMode === '(table|grid|kanban)'"
---

<objective>
Implement 3 complete view modes (Table, Grid, Kanban) for Talents page matching exact patterns from Clients.tsx.

Purpose: Provide flexible viewing options for different workflows (scanning, visual browsing, workflow management)
Output: Talents.tsx with 3 fully functional view implementations
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/28-harmonisation-ui-talents/28-CONTEXT.md
@.planning/phases/28-harmonisation-ui-talents/28-01-SUMMARY.md
@.planning/phases/28-harmonisation-ui-talents/28-02-SUMMARY.md

# Reference implementations
@packages/client/src/pages/Clients.tsx (lines 522-1276) - Complete view implementations

# Current state
@packages/client/src/pages/Talents.tsx (has ViewMode state from 28-02)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement Table view with sortable columns and copy buttons</name>
  <files>packages/client/src/pages/Talents.tsx</files>
  <action>
**Pattern reference:** Clients.tsx lines 522-721 (Table view)

**Adapt table schema for musicians:**
- Client → Talent (name, stageName)
- Type → Talent Type (musician/actor badge)
- Contact → Email/Phone (with copy buttons)
- Sessions → Sessions count (sortable)
- Last Session → Date (sortable)

**Implementation steps:**

1. **Wrap existing table in conditional:** `{viewMode === 'table' && (<div className="rounded-md border">...</div>)}`

2. **Add sorting functionality to handleSort:**
   ```typescript
   const handleSort = (field: SortField) => {
     if (sortField === field) {
       setSortOrder(sortOrder === 'asc' ? 'desc' : 'asc');
     } else {
       setSortField(field);
       setSortOrder('asc');
     }
   };
   ```

3. **Update TableHeader with sortable columns:**
   ```typescript
   <TableHead
     className="cursor-pointer hover:bg-accent"
     onClick={() => handleSort('name')}
   >
     <div className="flex items-center justify-start gap-1 whitespace-nowrap">
       Nom
       {sortField === 'name' ? (
         sortOrder === 'asc' ? <ArrowUp className="h-3 w-3" /> : <ArrowDown className="h-3 w-3" />
       ) : (
         <ArrowUpDown className="h-3 w-3 opacity-30" />
       )}
     </div>
   </TableHead>
   ```

4. **Add columns:**
   - Nom (sortable) - name + stageName
   - Type de talent (sortable) - Badge with color per type
   - Instruments/Genres - Display JSON arrays
   - Contact - Email + Phone with CopyButton
   - Sessions (sortable) - Count from enriched data
   - Dernière session (sortable) - Date formatted French
   - Actions - Edit/View buttons

5. **Add talent type badge colors:**
   ```typescript
   const talentTypeBadgeVariant = (type: string) => {
     switch(type) {
       case 'musician': return 'default';
       case 'actor': return 'secondary';
       default: return 'outline';
     }
   };
   ```

6. **Add missing icons:** `ArrowUp, ArrowDown, ArrowUpDown` to imports
  </action>
  <verify>
1. Click column headers - sorting works (name, type, sessions, lastSession)
2. Copy email/phone - toast confirms "Email copié!" / "Téléphone copié!"
3. Type badges colored correctly (musician vs actor)
4. All columns display correct data
5. Edit/View buttons navigate correctly
  </verify>
  <done>
- Table view fully functional with 7 columns
- All 4 sortable columns working (name, talentType, sessions, lastSession)
- Copy buttons work for email + phone
- Type badges styled by talent type
- Actions column has Edit/View links
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement Grid view with avatar cards</name>
  <files>packages/client/src/pages/Talents.tsx</files>
  <action>
**Pattern reference:** Clients.tsx lines 724-892 (Grid view)

**Grid view characteristics:**
- 4-column layout on xl screens (xl:grid-cols-4)
- Prominent h-12 avatar (photo or initials)
- Compact contact info (phone + email with copy buttons)
- Stats badges (sessions count, VIP indicator if >10 sessions)
- Type badge below name

**Implementation (after Table view closing tag):**

```typescript
{/* Grid View */}
{viewMode === 'grid' && (
  <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
    {filteredTalents.map((talent) => (
      <Card key={talent.id} className="hover:shadow-md transition-shadow flex flex-col h-full">
        <CardHeader className="pb-3 pt-2 px-2">
          <div className="space-y-2">
            <div className="flex items-center gap-3">
              {/* Prominent avatar */}
              <Avatar className="h-12 w-12">
                <AvatarImage src={talent.imageUrl ?? undefined} />
                <AvatarFallback className="text-sm font-semibold">
                  {getInitials(talent.name)}
                </AvatarFallback>
              </Avatar>

              <div className="flex-1 min-w-0">
                <CardTitle className="text-base flex items-center gap-2">
                  <span className="truncate">{talent.name}</span>
                  {talent.sessionsCount > 10 && (
                    <Star className="h-4 w-4 text-yellow-500 fill-yellow-500 flex-shrink-0" />
                  )}
                </CardTitle>
                {talent.stageName && (
                  <CardDescription className="text-sm truncate">
                    {talent.stageName}
                  </CardDescription>
                )}
              </div>
            </div>

            {/* Type badge */}
            <div>
              <Badge variant="outline" className="text-xs w-fit">
                {TALENT_TYPE_LABELS[talent.talentType]}
              </Badge>
            </div>
          </div>
        </CardHeader>

        <CardContent className="flex flex-col flex-1 pb-2 px-2">
          <div className="flex-1 space-y-3">
            {/* Contact info */}
            {talent.phone && (
              <div className="flex items-center gap-2 text-sm text-muted-foreground">
                <Phone className="h-3 w-3 flex-shrink-0" />
                <a href={`tel:${talent.phone}`} className="hover:underline truncate">
                  {talent.phone}
                </a>
                <CopyButton text={talent.phone} label="Téléphone" />
              </div>
            )}
            {talent.email && (
              <div className="flex items-center gap-2 text-sm text-muted-foreground">
                <Mail className="h-3 w-3 flex-shrink-0" />
                <a href={`mailto:${talent.email}`} className="hover:underline truncate">
                  {talent.email}
                </a>
                <CopyButton text={talent.email} label="Email" />
              </div>
            )}

            {/* Stats badges */}
            <div className="flex gap-2 flex-wrap">
              <Badge variant="outline" className="text-xs">
                {talent.sessionsCount} sessions
              </Badge>
            </div>
          </div>

          {/* Action buttons */}
          <div className="flex gap-2 pt-4 mt-auto">
            <Button variant="ghost" size="sm" className="flex-1" asChild>
              <Link to={`/talents/${talent.id}?edit=true`}>
                <Pencil className="h-3 w-3 mr-1" /> Modifier
              </Link>
            </Button>
            <Button variant="ghost" size="sm" className="flex-1" asChild>
              <Link to={`/talents/${talent.id}`}>
                <Eye className="h-3 w-3 mr-1" /> Voir
              </Link>
            </Button>
          </div>
        </CardContent>
      </Card>
    ))}
  </div>
)}
```

**Note:** Import TALENT_TYPE_LABELS from @rsm/shared if not already imported
  </action>
  <verify>
1. Toggle to Grid view - cards display in responsive grid
2. Avatars show photos or initials fallback
3. VIP indicator (star) appears for talents with >10 sessions
4. Copy buttons work for email/phone
5. Type badge shows correct label (Musicien/Acteur)
6. Cards responsive (2 cols md, 3 lg, 4 xl)
  </verify>
  <done>
- Grid view displays cards with avatars
- 4-column layout on xl screens
- Contact info with copy buttons
- VIP indicator for high-volume performers
- Type badges styled correctly
- Responsive grid layout working
  </done>
</task>

<task type="auto">
  <name>Task 3: Implement Kanban view with type-based columns</name>
  <files>packages/client/src/pages/Talents.tsx</files>
  <action>
**Pattern reference:** Clients.tsx lines 894-1276 (Kanban view - 2 columns: Particuliers/Entreprises)

**Adapt to Musicians/Actors columns:**
- Column 1: Musicians (filter by talentType === 'musician')
- Column 2: Actors (filter by talentType === 'actor')

**Kanban characteristics:**
- 2 equal-width columns (md:grid-cols-2 lg:grid-cols-2)
- Compact h-8 avatar (secondary to content)
- Full contact display (phone, email, website)
- Extended workflow context (sessions, last session, instruments, genres)
- shadow-lg cards (emphasis on context-rich display)

**Implementation (after Grid view closing tag):**

```typescript
{/* Kanban View */}
{viewMode === 'kanban' && (
  <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-2">
    {/* Musicians Column */}
    <div className="space-y-4">
      <div className="flex items-center justify-between p-3 bg-muted rounded-lg">
        <h3 className="font-semibold flex items-center gap-2">
          <Music className="h-5 w-5 text-primary" />
          Musiciens
        </h3>
        <Badge variant="secondary">
          {filteredTalents.filter(t => t.talentType === 'musician').length}
        </Badge>
      </div>
      <div className="space-y-3">
        {filteredTalents
          .filter(t => t.talentType === 'musician')
          .map((talent) => (
            <Card key={talent.id} className="hover:shadow-lg transition-shadow">
              <CardHeader className="pb-2">
                <div className="flex items-start gap-3">
                  <Avatar className="h-8 w-8">
                    <AvatarImage src={talent.imageUrl ?? undefined} />
                    <AvatarFallback className="text-xs font-semibold">
                      {getInitials(talent.name)}
                    </AvatarFallback>
                  </Avatar>

                  <div className="flex-1 min-w-0">
                    <CardTitle className="text-sm flex items-center gap-2">
                      <span className="truncate">{talent.name}</span>
                      {talent.sessionsCount > 10 && (
                        <Star className="h-3 w-3 text-yellow-500 fill-yellow-500 flex-shrink-0" />
                      )}
                    </CardTitle>
                    {talent.stageName && (
                      <CardDescription className="text-xs truncate">
                        {talent.stageName}
                      </CardDescription>
                    )}
                  </div>
                </div>
              </CardHeader>

              <CardContent className="pt-2 pb-2 space-y-3">
                {/* Full contact section */}
                <div className="space-y-1 text-xs">
                  {talent.phone && (
                    <div className="flex items-center gap-2 text-muted-foreground">
                      <Phone className="h-3 w-3 flex-shrink-0" />
                      <a href={`tel:${talent.phone}`} className="hover:underline">
                        {talent.phone}
                      </a>
                      <CopyButton text={talent.phone} label="Téléphone" />
                    </div>
                  )}
                  {talent.email && (
                    <div className="flex items-center gap-2 text-muted-foreground">
                      <Mail className="h-3 w-3 flex-shrink-0" />
                      <a href={`mailto:${talent.email}`} className="hover:underline truncate">
                        {talent.email}
                      </a>
                      <CopyButton text={talent.email} label="Email" />
                    </div>
                  )}
                  {talent.website && (
                    <div className="flex items-center gap-2 text-muted-foreground">
                      <Globe className="h-3 w-3 flex-shrink-0" />
                      <a href={talent.website} target="_blank" rel="noopener" className="hover:underline truncate">
                        Site web
                      </a>
                    </div>
                  )}
                </div>

                {/* Instruments/Genres */}
                {(talent.instruments || talent.genres) && (
                  <div className="border-t pt-2 space-y-1 text-xs">
                    {talent.instruments && (
                      <div className="text-muted-foreground">
                        <strong>Instruments:</strong> {
                          (() => {
                            try {
                              const parsed = JSON.parse(talent.instruments);
                              return Array.isArray(parsed) ? parsed.join(", ") : talent.instruments;
                            } catch { return talent.instruments; }
                          })()
                        }
                      </div>
                    )}
                    {talent.genres && (
                      <div className="text-muted-foreground">
                        <strong>Genres:</strong> {
                          (() => {
                            try {
                              const parsed = JSON.parse(talent.genres);
                              return Array.isArray(parsed) ? parsed.join(", ") : talent.genres;
                            } catch { return talent.genres; }
                          })()
                        }
                      </div>
                    )}
                  </div>
                )}

                {/* Workflow indicators */}
                <div className="space-y-2 text-xs border-t pt-2">
                  <div className="flex justify-between items-center">
                    <span className="text-muted-foreground">Sessions:</span>
                    <span className="font-medium">{talent.sessionsCount}</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="text-muted-foreground">Dernière session:</span>
                    <span className="font-medium">
                      {talent.lastSessionAt ?
                        format(new Date(talent.lastSessionAt), "dd MMM yyyy", { locale: fr })
                        : "Jamais"
                      }
                    </span>
                  </div>
                </div>

                {/* Action buttons */}
                <div className="flex gap-2 pt-2">
                  <Button variant="ghost" size="sm" className="flex-1" asChild>
                    <Link to={`/talents/${talent.id}?edit=true`}>
                      <Pencil className="h-3 w-3 mr-1" /> Modifier
                    </Link>
                  </Button>
                  <Button variant="ghost" size="sm" className="flex-1" asChild>
                    <Link to={`/talents/${talent.id}`}>
                      <Eye className="h-3 w-3 mr-1" /> Voir détails
                    </Link>
                  </Button>
                </div>
              </CardContent>
            </Card>
          ))}
        {filteredTalents.filter(t => t.talentType === 'musician').length === 0 && (
          <p className="text-sm text-muted-foreground text-center py-8">
            Aucun musicien
          </p>
        )}
      </div>
    </div>

    {/* Actors Column - DUPLICATE above structure, replace 'musician' with 'actor' and Music icon with different icon */}
    <div className="space-y-4">
      <div className="flex items-center justify-between p-3 bg-muted rounded-lg">
        <h3 className="font-semibold flex items-center gap-2">
          <Users className="h-5 w-5 text-primary" />
          Acteurs
        </h3>
        <Badge variant="secondary">
          {filteredTalents.filter(t => t.talentType === 'actor').length}
        </Badge>
      </div>
      {/* ... same card structure, filter by talentType === 'actor' ... */}
    </div>
  </div>
)}
```

**Note:** Duplicate the card structure for Actors column, changing only the filter condition and column header
  </action>
  <verify>
1. Toggle to Kanban view - 2 columns display (Musicians/Actors)
2. Column counts accurate
3. Full contact info displayed (phone, email, website)
4. Instruments/Genres section shows parsed JSON arrays
5. Workflow indicators (sessions count, last session) accurate
6. Copy buttons work
7. Empty state shows when no talents in category
  </verify>
  <done>
- Kanban view with 2 type-based columns
- Musicians column filters talentType === 'musician'
- Actors column filters talentType === 'actor'
- Full contact display with copy buttons
- Instruments/Genres displayed from JSONB
- Workflow context (sessions, last session)
- Empty states for 0 talents per type
  </done>
</task>

</tasks>

<verification>
**View functionality checks:**

1. **Table view:**
   - All 7 columns display
   - Sorting works on 4 columns
   - Copy buttons functional
   - Type badges colored

2. **Grid view:**
   - Cards in responsive grid (2/3/4 cols)
   - Avatars show photos or initials
   - VIP stars for >10 sessions
   - Copy buttons work

3. **Kanban view:**
   - 2 columns (Musicians/Actors)
   - Full contact info displayed
   - Instruments/Genres parsed correctly
   - Workflow stats accurate

**Switch between views:**
- Click each toggle button
- Verify data persists across views
- Check localStorage updates

**TypeScript checks:**
```bash
pnpm --filter client check
```
</verification>

<success_criteria>
- [ ] Table view fully functional with 7 columns
- [ ] Grid view displays cards with avatars
- [ ] Kanban view shows 2 type-based columns
- [ ] All views use same filteredTalents data source
- [ ] Sorting works in Table view (4 columns)
- [ ] Copy buttons work in all 3 views
- [ ] Type badges display correctly
- [ ] VIP indicators show for >10 sessions
- [ ] Instruments/Genres parse JSONB correctly
- [ ] TypeScript 0 errors
- [ ] Client builds successfully
</success_criteria>

<output>
After completion, create `.planning/phases/28-harmonisation-ui-talents/28-03-SUMMARY.md`
</output>
