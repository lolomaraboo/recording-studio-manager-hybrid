---
phase: 27-affichage-conditionnel-selon-type-client
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/client/src/components/ClientEditForm.tsx
autonomous: true

must_haves:
  truths:
    - "Entreprises (type=company) ne voient pas l'accordéon Profil Artistique"
    - "Entreprises ne voient pas l'accordéon Streaming"
    - "Entreprises ne voient pas les champs individual dans Identité (artistName, structured name, birthday, gender)"
    - "Particuliers (type=individual) voient tous les accordéons et champs comme avant"
    - "Changement du type de client affiche/cache les sections dynamiquement"
  artifacts:
    - path: "packages/client/src/components/ClientEditForm.tsx"
      provides: "Conditional rendering based on formData.type"
      min_lines: 1192
  key_links:
    - from: "Type de client toggle (lines 144-165)"
      to: "Accordion visibility"
      via: "formData.type state"
      pattern: "formData\\.type === \"individual\""
    - from: "formData.type state"
      to: "Individual-specific fields"
      via: "conditional rendering blocks"
      pattern: "\\{formData\\.type === \"individual\" &&"
---

<objective>
Masquer les sections musicales (Profil Artistique, Streaming) et champs individual dans le formulaire d'édition quand type="company".

Purpose: Adapter le formulaire au contexte métier - les entreprises (labels, studios de production, sociétés de management) n'ont pas de profil artistique personnel. Actuellement, elles voient tous les champs musicaux créant du bruit visuel et de la confusion.

Output: Formulaire d'édition avec affichage conditionnel - entreprises voient uniquement les sections pertinentes (Identité simplifiée, Coordonnées, Relations Professionnelles, Champs Personnalisés), particuliers voient tout comme actuellement.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

## Phase 26.2 Context (6-accordion structure)
Phase 26.2 established the current accordion structure:
1. **Identité** - Type selector (ABOVE accordions), artistName, name (auto-generated), structured name fields (individual only), birthday, gender, avatar/logo
2. **Coordonnées** - phones, emails, websites, addresses
3. **Relations Professionnelles** - CompanyMembersIndicator (Phase 25)
4. **Profil Artistique** - genres, instruments, professional info (label, distributor, manager, publisher), career info (years active, notable works, awards, biography)
5. **Streaming** - 11 platform URLs (Spotify, Apple Music, YouTube, SoundCloud, etc.)
6. **Notes Studio** - customFields array

## Current Issues for Companies
- **Profil Artistique accordion** (lines 767-938): Contains musical genres/instruments and career biography - irrelevant for company entities
- **Streaming accordion** (lines 941-1098): Contains 11 music platform URLs - companies don't have artist profiles
- **Individual fields in Identité** (lines 211-276): artistName, structured name (firstName, lastName, prefix, middleName, suffix), birthday, gender - not applicable to companies

## Solution Pattern
Use conditional rendering with `formData.type === "individual"`:
- Wrap Profil Artistique accordion (AccordionItem value="profil-artistique") in conditional
- Wrap Streaming accordion (AccordionItem value="streaming") in conditional
- Individual-specific fields in Identité accordion ALREADY have conditional (line 211: `{formData.type === "individual" && ...}`)
- Update Alt key handler to only include visible accordions in toggle logic

## Files from Previous Phases
@.planning/phases/26.2-restaurer-relations-professionnelles/26.2-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Conditional rendering for music-related accordions</name>
  <files>packages/client/src/components/ClientEditForm.tsx</files>
  <action>
Add conditional rendering for music-related accordions based on formData.type.

**Steps:**

1. **Wrap Profil Artistique accordion (lines 767-938) in conditional:**
   - Add condition: `{formData.type === "individual" && (`
   - Before: `<AccordionItem value="profil-artistique">`
   - After accordion closing: `)}`
   - Pattern: Same as existing individual fields conditional (line 211)

2. **Wrap Streaming accordion (lines 941-1098) in conditional:**
   - Add condition: `{formData.type === "individual" && (`
   - Before: `<AccordionItem value="streaming">`
   - After accordion closing: `)}`

3. **Update Alt key accordion toggle logic (lines 78-92):**
   - Current: `const allAccordions = ["identite", "coordonnees", "relations-professionnelles", "profil-artistique", "streaming", "notes-studio"];`
   - Change to dynamic array based on formData.type:
   ```typescript
   const allAccordions = formData.type === "individual"
     ? ["identite", "coordonnees", "relations-professionnelles", "profil-artistique", "streaming", "notes-studio"]
     : ["identite", "coordonnees", "relations-professionnelles", "notes-studio"];
   ```
   - This ensures Alt+Click only toggles VISIBLE accordions

4. **Verify individual-specific fields in Identité already conditional:**
   - Line 211: `{formData.type === "individual" && (` - ✅ Already correct
   - Includes: structured name (lastName, firstName, prefix, middleName, suffix), birthday, gender
   - No changes needed for Identité accordion

**Why NOT hide artistName:**
- artistName field (lines 186-194) should remain visible for BOTH types
- Companies can use it for brand/trading name separate from legal companyName
- Individual artists use it for stage name
- Keep this field unconditional

**Expected behavior after changes:**
- Company clients (type="company"): See 4 accordions (Identité, Coordonnées, Relations Pro, Notes Studio)
- Individual clients (type="individual"): See 6 accordions (all current accordions)
- Type toggle updates accordion visibility in real-time
- Alt+Click toggles only visible accordions (4 vs 6)

**TypeScript verification:**
- Run `pnpm --filter client check` to verify 0 errors
- Ensure no unused variables or type issues
  </action>
  <verify>
1. Run TypeScript check: `pnpm --filter client check` (expect 0 errors)
2. Inspect ClientEditForm.tsx:
   - Profil Artistique accordion wrapped in `formData.type === "individual"` conditional
   - Streaming accordion wrapped in `formData.type === "individual"` conditional
   - Alt key handler uses dynamic allAccordions array
3. Test production build: `pnpm --filter client build` (expect success)
  </verify>
  <done>
- Profil Artistique accordion only renders when type="individual"
- Streaming accordion only renders when type="individual"
- Individual-specific fields in Identité remain conditional (already correct)
- Alt key handler dynamically adjusts to visible accordion count
- TypeScript 0 errors, production build successful
  </done>
</task>

</tasks>

<verification>
**Overall phase checks:**
1. Switch client type to "Entreprise" → Profil Artistique and Streaming accordions disappear
2. Switch back to "Particulier" → All accordions reappear
3. Alt+Click with company type → Toggles only 4 visible accordions
4. Alt+Click with individual type → Toggles all 6 accordions
5. No TypeScript errors, production build successful

**Manual browser testing checklist:**
1. Navigate to /clients/:id and enter edit mode
2. Set type to "Entreprise" → Verify only 4 accordions visible (Identité, Coordonnées, Relations Pro, Notes Studio)
3. Set type to "Particulier" → Verify all 6 accordions visible
4. Test Alt+Click on accordion trigger in both modes
5. Verify no console errors
</verification>

<success_criteria>
**Measurable completion:**
- [x] Profil Artistique accordion hidden when type="company"
- [x] Streaming accordion hidden when type="company"
- [x] Individual-specific fields in Identité remain conditional
- [x] Alt key handler adapts to visible accordion count
- [x] Company clients see 4 relevant accordions only
- [x] Individual clients see all 6 accordions (unchanged experience)
- [x] Type toggle updates UI dynamically (no page refresh)
- [x] TypeScript 0 errors
- [x] Production build successful
</success_criteria>

<output>
After completion, create `.planning/phases/27-affichage-conditionnel-selon-type-client/27-01-SUMMARY.md`
</output>
