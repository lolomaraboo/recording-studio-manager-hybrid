---
phase: 27-affichage-conditionnel-selon-type-client
plan: 02
type: execute
wave: 2
depends_on: ["01"]
files_modified:
  - packages/client/src/components/ClientEditForm.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Entreprises (type=company) ne voient pas les champs birthday et gender dans Identité"
    - "Changement du type de client affiche/cache birthday et gender dynamiquement"
    - "Particuliers (type=individual) voient tous les champs comme avant"
  artifacts:
    - path: "packages/client/src/components/ClientEditForm.tsx"
      provides: "Conditional rendering for birthday and gender fields"
      contains: "formData.type === \"individual\" && ("
      min_lines: 1200
  key_links:
    - from: "formData.type state"
      to: "birthday and gender fields"
      via: "conditional rendering blocks"
      pattern: "\\{formData\\.type === [\"']individual[\"'] && \\("
---

<objective>
Fix incomplete conditional rendering in ClientEditForm by wrapping birthday and gender fields in type-specific conditionals.

Purpose: Complete the Phase 27 goal by hiding personal identity fields (birthday, gender) from company clients, matching the existing pattern used for structured name fields.

Output: Birthday and gender fields only visible for individual clients, companies see clean 4-field Identité section (Type, artistName, companyName, name).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/27-affichage-conditionnel-selon-type-client/27-01-SUMMARY.md
@.planning/phases/27-affichage-conditionnel-selon-type-client/27-VERIFICATION.md
</context>

<tasks>

<task type="auto">
  <name>Wrap birthday and gender fields in conditional rendering</name>
  <files>packages/client/src/components/ClientEditForm.tsx</files>
  <action>
Add conditional rendering to birthday and gender fields in Identité accordion.

**Current state (INCORRECT):**
- Lines 214-279: Structured name fields ARE conditional ✓
- Lines 281-291: Birthday field NOT conditional ✗
- Lines 293-308: Gender field NOT conditional ✗

**Fix pattern (match existing structured name pattern):**

Find the birthday field section (lines 281-291):
```typescript
{/* Birthday */}
<div>
  <label htmlFor="birthday" className="text-sm font-medium">Date de naissance</label>
  <input id="birthday" type="date" ... />
</div>
```

And gender field section (lines 293-308):
```typescript
{/* Gender */}
<div>
  <label htmlFor="gender" className="text-sm font-medium">Genre</label>
  <select id="gender" ...>
    <option value="">-</option>
    <option value="male">Homme</option>
    <option value="female">Femme</option>
    <option value="other">Autre</option>
    <option value="prefer_not_to_say">Préfère ne pas répondre</option>
  </select>
</div>
```

**Wrap both in conditional block:**
```typescript
{formData.type === "individual" && (
  <>
    {/* Birthday */}
    <div>
      <label htmlFor="birthday" className="text-sm font-medium">Date de naissance</label>
      <input
        id="birthday"
        type="date"
        name="birthday"
        value={formData.birthday || ""}
        onChange={handleInputChange}
        className="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
      />
    </div>

    {/* Gender */}
    <div>
      <label htmlFor="gender" className="text-sm font-medium">Genre</label>
      <select
        id="gender"
        name="gender"
        value={formData.gender || ""}
        onChange={handleInputChange}
        className="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
      >
        <option value="">-</option>
        <option value="male">Homme</option>
        <option value="female">Femme</option>
        <option value="other">Autre</option>
        <option value="prefer_not_to_say">Préfère ne pas répondre</option>
      </select>
    </div>
  </>
)}
```

**Result:**
- Company clients: See only Type, artistName, companyName, name (auto-generated) in Identité
- Individual clients: See all fields including structured name, birthday, gender (unchanged experience)
- Toggles dynamically when user changes Type de client dropdown
  </action>
  <verify>
TypeScript type checking:
```bash
cd /Users/marabook_m1/Documents/APP_HOME/CascadeProjects/windsurf-project/recording-studio-manager-hybrid
pnpm --filter client tsc --noEmit
```

Should output: "Found 0 errors"

Production build verification:
```bash
pnpm --filter client build
```

Should complete successfully with 0 errors.
  </verify>
  <done>
✓ Birthday field wrapped in formData.type === "individual" conditional
✓ Gender field wrapped in formData.type === "individual" conditional
✓ Both fields in same conditional block (single <>...</> wrapper)
✓ Indentation consistent with structured name pattern
✓ TypeScript passes with 0 errors
✓ Production build successful
  </done>
</task>

</tasks>

<verification>
**Code verification:**
```bash
# Verify conditional pattern exists for birthday/gender
grep -A 5 "formData.type === \"individual\" &&" packages/client/src/components/ClientEditForm.tsx | grep -E "(birthday|gender)"
```

Should show birthday and gender inside conditional block.

**Manual browser testing (recommended but optional):**
1. Navigate to http://localhost:5174/clients
2. Create or edit a company client (type="company")
3. Open Identité accordion in edit mode
4. Verify: Birthday and gender fields NOT visible
5. Change Type de client to "Particulier"
6. Verify: Birthday and gender fields NOW visible
7. Change back to "Entreprise"
8. Verify: Fields hide again
</verification>

<success_criteria>
- Birthday field only renders when formData.type === "individual"
- Gender field only renders when formData.type === "individual"
- Both fields wrapped in same conditional block
- Company clients see clean Identité with only 4 fields
- Individual clients see all identity fields (unchanged)
- TypeScript 0 errors
- Production build successful
</success_criteria>

<output>
After completion, create `.planning/phases/27-affichage-conditionnel-selon-type-client/27-02-SUMMARY.md`
</output>
