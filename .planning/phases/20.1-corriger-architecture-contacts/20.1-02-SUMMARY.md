---
phase: 20.1-corriger-architecture-contacts
plan: 02
subsystem: ui
tags: [react, trpc, kanban, contacts, many-to-many]

# Dependency graph
requires:
  - phase: 20.1-01
    provides: company_members table, getMembers endpoint, tenant_3 test data
provides:
  - Kanban view displays detailed member lists for companies
  - Primary contact indicated with star icon
  - Clickable member links to profiles
  - Conditional API loading (performance optimized)
affects: [future contact management features, member profile pages]

# Tech tracking
tech-stack:
  added: []
  patterns: [IIFE for conditional hook usage, conditional tRPC query loading]

key-files:
  created: []
  modified:
    - packages/client/src/pages/Clients.tsx

key-decisions:
  - "IIFE pattern for conditional hook usage in React"
  - "Conditional loading prevents unnecessary API calls (viewMode + type + count checks)"
  - "Truncate class prevents overflow with long names/roles"

patterns-established:
  - "Conditional tRPC hooks: enabled parameter based on multiple conditions (viewMode, clientType, contactsCount)"
  - "IIFE for rendering with hooks inside conditional JSX"

# Metrics
duration: 4min
completed: 2026-01-17
---

# Phase 20.1-02: Kanban Member Display Summary

**Kanban view now shows detailed company member lists with primary contact indication, roles, and clickable profile links**

## Performance

- **Duration:** 4 min (218 seconds)
- **Started:** 2026-01-17T07:56:23Z
- **Completed:** 2026-01-17T08:00:01Z
- **Tasks:** 1 (all implementation in single task)
- **Files modified:** 1

## Accomplishments

- Replaced simple "3 contacts" badge with detailed member list in Kanban view
- Primary contact identified with ⭐ yellow star icon
- All members clickable to their profile pages (`/clients/{id}`)
- Roles displayed when present (e.g., "Productrice", "Ingénieur du son")
- Conditional loading prevents API calls in Table/Grid views and for individual clients
- Comprehensive manual testing confirms all edge cases handled

## Task Commits

1. **Task 1: Implement Kanban member list display** - `59f496f` (feat)

**Plan metadata:** No separate metadata commit (single-task plan)

## Files Created/Modified

- `packages/client/src/pages/Clients.tsx` - Added getCompanyMembers hook helper, replaced contact badge with detailed member list in Kanban Entreprises column

## Decisions Made

**1. IIFE pattern for conditional hook usage**
- **Rationale:** React hooks can't be called conditionally, but we need to conditionally render based on hook data. IIFE allows hook call at top level while keeping rendering logic scoped.
- **Pattern:**
  ```tsx
  {(() => {
    const { data: members } = getCompanyMembers(clientId, enabled);
    if (!members) return null;
    return <MemberList />;
  })()}
  ```

**2. Multi-condition enabled flag**
- **Rationale:** Prevent unnecessary API calls by checking: `viewMode === 'kanban' && client.type === 'company' && contactsCount > 0`
- **Impact:** Only loads members when actually needed (3 API calls vs potentially dozens)

**3. Truncate class for overflow**
- **Rationale:** Long member names or roles could break card layout. `truncate` class ensures ellipsis on overflow.
- **Example:** "Alexandre Grand - Ingénieur du son principal et mixage" → "Alexandre Grand - Ingénie..."

**4. stopPropagation on member links**
- **Rationale:** Prevent card click events from interfering with member link navigation. User clicks member name → goes to profile, not card background behavior.

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None - implementation straightforward with clear plan specification.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

**Phase 20.1 COMPLETE ✅**

Both plans finished:
- ✅ 20.1-01: Backend architecture (company_members table, getMembers endpoint)
- ✅ 20.1-02: Frontend UI (Kanban member display)

**Complete many-to-many contact architecture:**
- Backend: Many-to-many company_members junction table
- Frontend: Table view (count badge), Grid view (count badge), Kanban view (detailed list)
- Copy buttons: All 3 views support email/phone copy-to-clipboard
- Test data: tenant_3 with 5 clients, 3 companies, 7 memberships

**Ready for:**
- Production deployment
- User testing with real data
- Future contact management features (edit members, add members, remove members)

**No blockers or concerns.**

---
*Phase: 20.1-corriger-architecture-contacts*
*Completed: 2026-01-17*
