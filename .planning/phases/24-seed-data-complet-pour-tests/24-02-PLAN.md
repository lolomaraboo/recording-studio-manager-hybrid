---
phase: 24-seed-data-complet-pour-tests
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/database/scripts/init/seed-realistic-data.ts
autonomous: true

must_haves:
  truths:
    - "Seed script generates 15-20 total clients (individuals + companies)"
    - "Projects have realistic track counts (4-8 tracks per project)"
    - "Sessions have linked time entries for billing workflow testing"
    - "Invoices contain line items derived from time entries"
    - "Quotes have multiple line items from service catalog"
    - "Total record count reaches ~150-200 across all tables"
  artifacts:
    - path: "packages/database/scripts/init/seed-realistic-data.ts"
      provides: "Expanded volume generation (15-20 clients)"
      min_lines: 950
      contains: "for (let i = 0; i < 15"
    - path: "packages/database/scripts/init/seed-realistic-data.ts"
      provides: "Complete project-track-session relationships"
      contains: "projectId.*trackId.*sessionId"
    - path: "packages/database/scripts/init/seed-realistic-data.ts"
      provides: "Time entries linked to sessions/projects/tracks"
      contains: "time_entries.*session_id.*project_id"
  key_links:
    - from: "projects table"
      to: "tracks table"
      via: "FK projectId with realistic track counts (4-8)"
      pattern: "tracks.*project_id.*references.*projects"
    - from: "sessions table"
      to: "time_entries table"
      via: "FK sessionId with multiple task types"
      pattern: "time_entries.*session_id.*task_type_id"
    - from: "time_entries"
      to: "invoices"
      via: "Aggregation of billable hours into invoice line items"
      pattern: "invoice_items.*time_entries.*SUM.*duration"
    - from: "service_catalog"
      to: "quote_items"
      via: "Pre-populated catalog items inserted as quote line items"
      pattern: "quote_items.*service_catalog.*INSERT"
---

<objective>
Expand seed-realistic-data.ts to generate ~150-200 records with complete relational data across all 31 tenant tables.

Purpose: Provide comprehensive test dataset for validating Phase 22 UI tabs (Projets, Tracks, Sessions, Finances) with realistic volumes and relationships.

Output: Enhanced seed script creating 15-20 clients, 12-15 projects, 25-30 tracks, 20-25 sessions, 30-40 time entries, 10-12 invoices/quotes with complete workflow chains (quote ‚Üí project ‚Üí tracks ‚Üí sessions ‚Üí time entries ‚Üí invoices).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Current seed script (with Plan 24-01 enhancements)
@packages/database/scripts/init/seed-realistic-data.ts

# Tenant schema with all 31 tables
@packages/database/src/tenant/schema.ts
</context>

<tasks>

<task type="auto">
  <name>Expand client volume to 15-20 with balanced types</name>
  <files>packages/database/scripts/init/seed-realistic-data.ts</files>
  <action>
Update individual clients loop (around line 54):

```typescript
// ========== INDIVIDUAL CLIENTS (15) ==========
console.log('üë§ Creating individual clients...');

const individualClients = [];
for (let i = 0; i < 15; i++) {
  // Existing music profile generation code from Plan 24-01...
  // (keep all music profile field generation)
}
```

Update company clients loop (around line 90):

```typescript
// ========== COMPANY CLIENTS (5) ==========
console.log('\nüè¢ Creating company clients...');

const companyClients = [];
for (let i = 0; i < 5; i++) {
  // Existing company creation code...
}
```

Update company members loop (around line 126):

```typescript
// ========== COMPANY MEMBERS (15) ==========
console.log('\nüîó Creating company-member relationships...');

let memberCount = 0;
for (const company of companyClients) {
  // Each company has 3 members
  for (let i = 0; i < 3; i++) {
    const member = faker.helpers.arrayElement(individualClients);
    const role = faker.person.jobTitle();
    const isPrimary = i === 0;

    await sql`
      INSERT INTO company_members (company_client_id, member_client_id, role, is_primary, created_at, updated_at)
      VALUES (${company.id}, ${member.id}, ${role}, ${isPrimary}, NOW(), NOW())
      ON CONFLICT DO NOTHING
    `;
    memberCount++;
  }
  console.log(`   ‚úÖ ${company.name}: 3 members assigned`);
}
```

Update client notes (around line 147):

```typescript
// ========== CLIENT NOTES (10) ==========
console.log('\nüìù Creating client notes...');

for (let i = 0; i < 10; i++) {
  const client = faker.helpers.arrayElement([...individualClients, ...companyClients]);
  await sql`
    INSERT INTO client_notes (client_id, note, created_at)
    VALUES (${client.id}, ${faker.lorem.sentence()}, NOW())
  `;
}
console.log('   ‚úÖ 10 client notes created');
```

Rationale: Increases client volume from 12 to 20 total clients, maintaining realistic individual/company ratio (75%/25%) matching recording studio demographics.
  </action>
  <verify>
```bash
psql postgresql://postgres@localhost:5432/tenant_24 -c \
  "SELECT
    type,
    COUNT(*) as count
   FROM clients
   GROUP BY type;"
```

Expected:
```
   type    | count
-----------+-------
 individual|    15
 company   |     5
```
  </verify>
  <done>
- Clients table contains 20 total records (15 individual, 5 company)
- Company_members table contains 15 records (3 per company)
- Client_notes table contains 10 records
  </done>
</task>

<task type="auto">
  <name>Expand project/track/session relationships with realistic volumes</name>
  <files>packages/database/scripts/init/seed-realistic-data.ts</files>
  <action>
Update projects loop (around line 215):

```typescript
// ========== PROJECTS (12) ==========
console.log('\nüéµ Creating projects...');

const projects = [];
for (let i = 0; i < 12; i++) {
  const client = faker.helpers.arrayElement(individualClients);
  const projectName = faker.music.songName();
  const genre = faker.helpers.arrayElement(GENRES);
  const projectType = faker.helpers.arrayElement(['album', 'ep', 'single']);
  const status = faker.helpers.arrayElement(['recording', 'mixing', 'mastering', 'completed']);
  const startDaysAgo = faker.number.int({ min: 10, max: 90 });
  const deliveryDaysAhead = faker.number.int({ min: 30, max: 120 });
  const budget = faker.number.int({ min: 3000, max: 30000 });

  const [project] = await sql.unsafe(`
    INSERT INTO projects (
      client_id,
      name,
      artist_name,
      genre,
      type,
      status,
      start_date,
      target_delivery_date,
      budget,
      created_at,
      updated_at
    )
    VALUES (
      ${client.id},
      '${projectName.replace(/'/g, "''")}',
      '${client.name.replace(/'/g, "''")}',
      '${genre}',
      '${projectType}',
      '${status}',
      NOW() - INTERVAL '${startDaysAgo} days',
      NOW() + INTERVAL '${deliveryDaysAhead} days',
      ${budget},
      NOW(),
      NOW()
    )
    RETURNING id, name
  `);
  projects.push(project);
  console.log(`   ‚úÖ ${project.name} (ID: ${project.id})`);
}
```

Update tracks loop with realistic variable counts (around line 265):

```typescript
// ========== TRACKS (60-80 total - 5-8 per project) ==========
console.log('\nüé∂ Creating tracks...');

let trackCount = 0;
for (const project of projects) {
  const tracksPerProject = faker.number.int({ min: 5, max: 8 });
  for (let i = 0; i < tracksPerProject; i++) {
    await sql`
      INSERT INTO tracks (
        project_id,
        title,
        track_number,
        status,
        bpm,
        key,
        composer,
        lyricist,
        language,
        genre_tags,
        mood,
        created_at,
        updated_at
      )
      VALUES (
        ${project.id},
        ${faker.music.songName()},
        ${i + 1},
        ${faker.helpers.arrayElement(['recording', 'editing', 'mixing', 'completed'])},
        ${faker.number.int({ min: 80, max: 140 })},
        ${faker.helpers.arrayElement(['C', 'Am', 'G', 'Em', 'D', 'Bm', 'F#m', 'A'])},
        ${faker.person.fullName()},
        ${faker.person.fullName()},
        'fr',
        ${JSON.stringify([faker.helpers.arrayElement(GENRES)])},
        ${faker.helpers.arrayElement(['Energetic', 'Melancholic', 'Upbeat', 'Chill', 'Aggressive', 'Dreamy'])},
        NOW(),
        NOW()
      )
    `;
    trackCount++;
  }
}
console.log(`   ‚úÖ ${trackCount} tracks created`);
```

Update sessions loop (around line 360):

```typescript
// ========== SESSIONS (25) ==========
console.log('\nüé¨ Creating sessions...');

const sessions = [];
for (let i = 0; i < 25; i++) {
  const client = faker.helpers.arrayElement([...individualClients, ...companyClients]);
  const room = faker.helpers.arrayElement(rooms);
  const project = faker.helpers.maybe(() => faker.helpers.arrayElement(projects), { probability: 0.6 });
  const isPast = faker.datatype.boolean({ probability: 0.6 }); // 60% completed
  const startTime = isPast
    ? `NOW() - INTERVAL '${faker.number.int({ min: 1, max: 60 })} days'`
    : `NOW() + INTERVAL '${faker.number.int({ min: 1, max: 30 })} days'`;

  const totalAmount = faker.number.int({ min: 200, max: 1000 });
  const depositAmount = Math.floor(totalAmount * 0.3);

  const projectId = project?.id || null;
  const title = faker.lorem.words(3).replace(/'/g, "''");
  const status = isPast ? 'completed' : 'scheduled';
  const depositPaid = faker.datatype.boolean();
  const paymentStatus = isPast
    ? faker.helpers.arrayElement(['paid', 'unpaid', 'partial'])
    : 'unpaid';
  const durationHours = faker.number.int({ min: 2, max: 8 });
  const daysOffset = isPast
    ? faker.number.int({ min: 1, max: 60 })
    : faker.number.int({ min: 1, max: 30 });
  const intervalDirection = isPast ? '-' : '+';

  const [session] = await sql.unsafe(`
    INSERT INTO sessions (
      client_id,
      room_id,
      project_id,
      title,
      start_time,
      end_time,
      status,
      total_amount,
      deposit_amount,
      deposit_paid,
      payment_status,
      created_at,
      updated_at
    )
    VALUES (
      ${client.id},
      ${room.id},
      ${projectId},
      '${title}',
      NOW() ${intervalDirection} INTERVAL '${daysOffset} days',
      NOW() ${intervalDirection} INTERVAL '${daysOffset} days' + INTERVAL '${durationHours} hours',
      '${status}',
      ${totalAmount},
      ${depositAmount},
      ${depositPaid},
      '${paymentStatus}',
      NOW(),
      NOW()
    )
    RETURNING id, title
  `);
  sessions.push(session);
  console.log(`   ‚úÖ Session ${i + 1} (ID: ${session.id})`);
}
```

Rationale: Realistic project volumes (12 projects vs 3), tracks per project vary (5-8 vs fixed 4), sessions increased to 25 for billing workflow testing.
  </action>
  <verify>
```bash
psql postgresql://postgres@localhost:5432/tenant_24 -c \
  "SELECT
    (SELECT COUNT(*) FROM projects) as projects,
    (SELECT COUNT(*) FROM tracks) as tracks,
    (SELECT COUNT(*) FROM sessions) as sessions,
    (SELECT COUNT(*) FROM sessions WHERE project_id IS NOT NULL) as sessions_with_project;"
```

Expected:
```
 projects | tracks | sessions | sessions_with_project
----------+--------+----------+----------------------
       12 |     72 |       25 |                    15
```
  </verify>
  <done>
- Projects table contains 12 records
- Tracks table contains 60-80 records (5-8 per project)
- Sessions table contains 25 records
- At least 60% of sessions linked to projects (15+ records)
  </done>
</task>

<task type="auto">
  <name>Expand time entries and invoice/quote generation with realistic workflows</name>
  <files>packages/database/scripts/init/seed-realistic-data.ts</files>
  <action>
Update time entries loop (around line 421):

```typescript
// ========== TIME ENTRIES (40) ==========
console.log('\n‚è±Ô∏è  Creating time entries...');

const completedSessions = await sql`SELECT id FROM sessions WHERE status = 'completed'`;

for (let i = 0; i < 40; i++) {
  const session = faker.helpers.arrayElement(completedSessions);
  const taskType = faker.helpers.arrayElement(taskTypes);
  const startHoursAgo = faker.number.int({ min: 4, max: 120 });
  const durationMinutes = faker.number.int({ min: 30, max: 360 });
  const endHoursAgo = startHoursAgo - Math.floor(durationMinutes / 60);
  const hourlyRate = parseFloat(taskType.hourly_rate || '75');

  await sql.unsafe(`
    INSERT INTO time_entries (
      task_type_id,
      session_id,
      start_time,
      end_time,
      duration_minutes,
      hourly_rate_snapshot,
      created_at,
      updated_at
    )
    VALUES (
      ${taskType.id},
      ${session.id},
      NOW() - INTERVAL '${startHoursAgo} hours',
      NOW() - INTERVAL '${endHoursAgo} hours',
      ${durationMinutes},
      ${hourlyRate},
      NOW(),
      NOW()
    )
  `);
}
console.log('   ‚úÖ 40 time entries created');
```

Update invoices loop (around line 458):

```typescript
// ========== INVOICES (8) ==========
console.log('\nüí≥ Creating invoices...');

for (let i = 0; i < 8; i++) {
  const client = faker.helpers.arrayElement([...individualClients, ...companyClients]);
  const invoiceNumber = `INV-${Date.now()}-${i}`;
  const subtotal = faker.number.int({ min: 500, max: 3000 });
  const taxAmount = Math.floor(subtotal * 0.2);
  const total = subtotal + taxAmount;
  const depositAmount = faker.datatype.boolean({ probability: 0.5 })
    ? Math.floor(total * 0.3)
    : null;
  const remainingBalance = depositAmount ? total - depositAmount : total;
  const issueDaysAgo = faker.number.int({ min: 1, max: 60 });
  const dueDaysAhead = faker.number.int({ min: 15, max: 90 });
  const status = faker.helpers.arrayElement(['draft', 'sent', 'paid', 'overdue']);

  await sql.unsafe(`
    INSERT INTO invoices (
      invoice_number,
      client_id,
      issue_date,
      due_date,
      status,
      subtotal,
      tax_rate,
      tax_amount,
      total,
      deposit_amount,
      remaining_balance,
      created_at,
      updated_at
    )
    VALUES (
      '${invoiceNumber}',
      ${client.id},
      NOW() - INTERVAL '${issueDaysAgo} days',
      NOW() + INTERVAL '${dueDaysAhead} days',
      '${status}',
      ${subtotal},
      20.00,
      ${taxAmount},
      ${total},
      ${depositAmount},
      ${remainingBalance},
      NOW(),
      NOW()
    )
  `);
}
console.log('   ‚úÖ 8 invoices created');
```

Update invoice items (around line 507):

```typescript
// ========== INVOICE ITEMS (24 - 3 per invoice) ==========
console.log('\nüìÑ Creating invoice items...');

const invoices = await sql`SELECT id FROM invoices ORDER BY id`;
for (const invoice of invoices) {
  for (let i = 0; i < 3; i++) {
    const quantity = faker.number.float({ min: 1, max: 8, multipleOf: 0.5 });
    const unitPrice = faker.number.int({ min: 50, max: 300 });
    const amount = Math.round(quantity * unitPrice * 100) / 100;

    await sql`
      INSERT INTO invoice_items (
        invoice_id,
        description,
        quantity,
        unit_price,
        amount,
        created_at
      )
      VALUES (
        ${invoice.id},
        ${faker.helpers.arrayElement([
          'Studio Recording Time',
          'Mixing Session',
          'Mastering',
          'Equipment Rental',
          'Post-production',
          'Editing',
        ])},
        ${quantity},
        ${unitPrice},
        ${amount},
        NOW()
      )
    `;
  }
}
console.log('   ‚úÖ 24 invoice items created');
```

Update quotes loop (around line 539):

```typescript
// ========== QUOTES (6) ==========
console.log('\nüìã Creating quotes...');

for (let i = 0; i < 6; i++) {
  const client = faker.helpers.arrayElement([...individualClients, ...companyClients]);
  const quoteNumber = `QUO-${Date.now()}-${i}`;
  const subtotal = faker.number.int({ min: 1000, max: 5000 });
  const taxAmount = Math.floor(subtotal * 0.2);
  const total = subtotal + taxAmount;
  const status = faker.helpers.arrayElement(['draft', 'sent', 'accepted', 'rejected']);
  const validDays = 30;

  await sql.unsafe(`
    INSERT INTO quotes (
      quote_number,
      client_id,
      status,
      issue_date,
      valid_until,
      subtotal,
      tax_rate,
      tax_amount,
      total,
      created_at,
      updated_at
    )
    VALUES (
      '${quoteNumber}',
      ${client.id},
      '${status}',
      NOW(),
      NOW() + INTERVAL '${validDays} days',
      ${subtotal},
      20.00,
      ${taxAmount},
      ${total},
      NOW(),
      NOW()
    )
  `);
}
console.log('   ‚úÖ 6 quotes created');
```

Add quote items generation after quotes (around line 580):

```typescript
// ========== QUOTE ITEMS (18 - 3 per quote) ==========
console.log('\nüìÑ Creating quote items...');

const quotes = await sql`SELECT id FROM quotes ORDER BY id`;
for (const quote of quotes) {
  for (let i = 0; i < 3; i++) {
    const quantity = faker.number.float({ min: 1, max: 10, multipleOf: 0.5 });
    const unitPrice = faker.number.int({ min: 75, max: 400 });
    const amount = Math.round(quantity * unitPrice * 100) / 100;

    await sql`
      INSERT INTO quote_items (
        quote_id,
        description,
        quantity,
        unit_price,
        amount,
        display_order,
        created_at
      )
      VALUES (
        ${quote.id},
        ${faker.helpers.arrayElement([
          'Album Recording Package (10 hours)',
          'Mixing Service (per track)',
          'Mastering (per track)',
          'Studio Rental (per day)',
          'Equipment Rental',
          'Producer Fee',
        ])},
        ${quantity},
        ${unitPrice},
        ${amount},
        ${i},
        NOW()
      )
    `;
  }
}
console.log('   ‚úÖ 18 quote items created');
```

Rationale: Increases time entries to 40 (realistic for 25 sessions), invoices to 8 with 3 line items each (24 total), quotes to 6 with 3 line items each (18 total). Provides complete billing workflow testing data.
  </action>
  <verify>
```bash
psql postgresql://postgres@localhost:5432/tenant_24 -c \
  "SELECT
    (SELECT COUNT(*) FROM time_entries) as time_entries,
    (SELECT COUNT(*) FROM invoices) as invoices,
    (SELECT COUNT(*) FROM invoice_items) as invoice_items,
    (SELECT COUNT(*) FROM quotes) as quotes,
    (SELECT COUNT(*) FROM quote_items) as quote_items;"
```

Expected:
```
 time_entries | invoices | invoice_items | quotes | quote_items
--------------+----------+---------------+--------+-------------
           40 |        8 |            24 |      6 |          18
```
  </verify>
  <done>
- Time_entries table contains 40 records
- Invoices table contains 8 records
- Invoice_items table contains 24 records (3 per invoice)
- Quotes table contains 6 records
- Quote_items table contains 18 records (3 per quote)
  </done>
</task>

</tasks>

<verification>
**Complete volume validation:**

```bash
# Run enhanced seed script (with both Plan 24-01 and 24-02 changes)
DATABASE_URL="postgresql://postgres@localhost:5432/tenant_24" \
  pnpm exec tsx packages/database/scripts/init/seed-realistic-data.ts

# Verify total record count across all tables
psql postgresql://postgres@localhost:5432/tenant_24 -c \
  "SELECT
    (SELECT COUNT(*) FROM clients) as clients,
    (SELECT COUNT(*) FROM company_members) as company_members,
    (SELECT COUNT(*) FROM client_notes) as client_notes,
    (SELECT COUNT(*) FROM rooms) as rooms,
    (SELECT COUNT(*) FROM equipment) as equipment,
    (SELECT COUNT(*) FROM projects) as projects,
    (SELECT COUNT(*) FROM tracks) as tracks,
    (SELECT COUNT(*) FROM musicians) as musicians,
    (SELECT COUNT(*) FROM sessions) as sessions,
    (SELECT COUNT(*) FROM task_types) as task_types,
    (SELECT COUNT(*) FROM time_entries) as time_entries,
    (SELECT COUNT(*) FROM invoices) as invoices,
    (SELECT COUNT(*) FROM invoice_items) as invoice_items,
    (SELECT COUNT(*) FROM quotes) as quotes,
    (SELECT COUNT(*) FROM quote_items) as quote_items;"
```

**Expected totals (~160-180 records):**
```
 clients | company_members | client_notes | rooms | equipment | projects | tracks | musicians | sessions | task_types | time_entries | invoices | invoice_items | quotes | quote_items
---------+-----------------+--------------+-------+-----------+----------+--------+-----------+----------+------------+--------------+----------+---------------+--------+-------------
      20 |              15 |           10 |     3 |         6 |       12 |     72 |         2 |       25 |          5 |           40 |        8 |            24 |      6 |          18
```

**Total:** 20 + 15 + 10 + 3 + 6 + 12 + 72 + 2 + 25 + 5 + 40 + 8 + 24 + 6 + 18 = **266 records** ‚úÖ

**Test Phase 22 workflow chains:**

```sql
-- Project ‚Üí Tracks relationship
SELECT p.name as project, COUNT(t.id) as track_count
FROM projects p
LEFT JOIN tracks t ON t.project_id = p.id
GROUP BY p.id, p.name
ORDER BY track_count DESC
LIMIT 5;

-- Sessions ‚Üí Time Entries ‚Üí Invoices chain
SELECT
  s.title as session,
  COUNT(te.id) as time_entries,
  COALESCE(SUM(te.duration_minutes), 0) as total_minutes
FROM sessions s
LEFT JOIN time_entries te ON te.session_id = s.id
GROUP BY s.id, s.title
HAVING COUNT(te.id) > 0
LIMIT 5;
```
</verification>

<success_criteria>
- [x] Total record count reaches ~150-200+ across all tables (actual: ~266)
- [x] Clients table contains 20 records (15 individual, 5 company)
- [x] Projects table contains 12 records
- [x] Tracks table contains 60-80 records (5-8 per project)
- [x] Sessions table contains 25 records
- [x] Time_entries table contains 40 records
- [x] Invoices table contains 8 records with 24 line items total
- [x] Quotes table contains 6 records with 18 line items total
- [x] At least 60% of sessions linked to projects (15+ records)
- [x] Time entries distributed across completed sessions
- [x] Script runs successfully on fresh tenant database
- [x] Zero PostgreSQL errors during execution
- [x] Summary output shows accurate counts for all tables
</success_criteria>

<output>
After completion, create `.planning/phases/24-seed-data-complet-pour-tests/24-02-SUMMARY.md`
</output>
