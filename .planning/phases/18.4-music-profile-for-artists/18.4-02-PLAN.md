---
phase: 18.4-music-profile-for-artists
plan: 02
type: execute
wave: 2
depends_on: ["18.4-01"]
files_modified:
  - packages/client/src/components/MusicProfileSection.tsx
  - packages/client/src/components/ui/multiple-selector.tsx
  - packages/client/src/pages/ClientDetail.tsx
  - packages/server/src/routers/clients.ts
autonomous: true

must_haves:
  truths:
    - "Users can select genres from preset list OR add custom genres"
    - "Users can add instruments with proficiency levels (beginner/intermediate/pro)"
    - "Streaming platform URLs are editable and validated"
    - "Industry information (label, manager) can be entered"
    - "Music profile displays in Client Detail page"
    - "Edit mode works correctly with save/cancel"
  artifacts:
    - path: "packages/client/src/components/MusicProfileSection.tsx"
      provides: "Music profile UI component"
      min_lines: 200
      exports: ["MusicProfileSection"]
    - path: "packages/client/src/components/ui/multiple-selector.tsx"
      provides: "Multi-select component with creatable option"
      exports: ["MultipleSelector"]
    - path: "packages/client/src/pages/ClientDetail.tsx"
      provides: "Integration of MusicProfileSection in tabs"
      contains: "MusicProfileSection"
  key_links:
    - from: "packages/client/src/components/MusicProfileSection.tsx"
      to: "packages/client/src/components/ui/multiple-selector.tsx"
      via: "import MultipleSelector"
      pattern: "import.*MultipleSelector"
    - from: "packages/client/src/pages/ClientDetail.tsx"
      to: "packages/client/src/components/MusicProfileSection.tsx"
      via: "import and render in Tabs"
      pattern: "<MusicProfileSection"
---

<objective>
Create comprehensive MusicProfileSection UI component with genre/instrument multi-selects, streaming platform URLs, and industry information.

Purpose: Provide visual interface for music profile fields added in Phase 18.4-01. Enable users to select genres, add instruments with proficiency, enter streaming URLs, and record industry info.

Output: New MusicProfileSection component integrated into ClientDetail page, multi-select components installed, edit/save functionality working.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18.4-music-profile-for-artists/18.4-RESEARCH.md
@.planning/phases/18.4-music-profile-for-artists/18.4-01-SUMMARY.md

# Reference: Existing enriched client UI pattern
@packages/client/src/components/EnrichedClientInfo.tsx

# Current ClientDetail structure
@packages/client/src/pages/ClientDetail.tsx

# shadcn UI components
@packages/client/src/components/ui/card.tsx
@packages/client/src/components/ui/input.tsx
@packages/client/src/components/ui/label.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install shadcn multi-select component</name>
  <files>packages/client/src/components/ui/multiple-selector.tsx</files>
  <action>
Install shadcn-ui-expansions Multiple Selector component for genre/instrument selection with creatable feature.

```bash
cd /Users/marabook_m1/Documents/APP_HOME/CascadeProjects/windsurf-project/recording-studio-manager-hybrid/packages/client

# Install Multiple Selector component
npx shadcn@latest add https://shadcnui-expansions.typeart.cc/docs/multiple-selector
```

**Component features needed:**
- `creatable` prop: Allow custom genre/instrument entries
- `defaultOptions` prop: Preset list of genres/instruments
- `value`/`onChange` for controlled component
- Type-safe with `Option[]` interface

**WHY this component:** Pre-built accessibility, keyboard navigation, search/filter, creatable entries. Avoids hand-rolling complex multi-select logic.

**Alternative considered:** `shadcn-multi-select-component` from GitHub, but shadcn-ui-expansions has better TypeScript types and creatable feature.

**IMPORTANT:** If installation fails with URL, try manual copy from component registry OR use npx shadcn@latest add command-palette (similar pattern).
  </action>
  <verify>
1. Check file exists: `ls packages/client/src/components/ui/multiple-selector.tsx`
2. Verify exports: `grep "export.*MultipleSelector" packages/client/src/components/ui/multiple-selector.tsx`
3. Check TypeScript compiles: `pnpm --filter client check`
4. Confirm Option interface exported: `grep "export.*Option" packages/client/src/components/ui/multiple-selector.tsx`
  </verify>
  <done>Multiple Selector component installed, TypeScript types available, ready for use in MusicProfileSection</done>
</task>

<task type="auto">
  <name>Task 2: Create MusicProfileSection component</name>
  <files>packages/client/src/components/MusicProfileSection.tsx</files>
  <action>
Create new file `packages/client/src/components/MusicProfileSection.tsx` following EnrichedClientInfo.tsx pattern (modular, read/edit modes, Card-based layout).

**Component structure:**

```typescript
import { useState } from "react";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { MultipleSelector, Option } from "@/components/ui/multiple-selector";
import { Music, Radio, Briefcase } from "lucide-react";

interface MusicProfileSectionProps {
  client: any; // Client type from schema
  isEditing: boolean;
  onUpdate: (data: Partial<any>) => void;
}

// Preset genre list (50 common genres)
const PRESET_GENRES: Option[] = [
  { label: "Rock", value: "Rock" },
  { label: "Pop", value: "Pop" },
  { label: "Jazz", value: "Jazz" },
  { label: "Blues", value: "Blues" },
  { label: "Electronic", value: "Electronic" },
  { label: "Hip-Hop", value: "Hip-Hop" },
  { label: "R&B", value: "R&B" },
  { label: "Country", value: "Country" },
  { label: "Classical", value: "Classical" },
  { label: "Metal", value: "Metal" },
  { label: "Folk", value: "Folk" },
  { label: "Reggae", value: "Reggae" },
  { label: "Soul", value: "Soul" },
  { label: "Funk", value: "Funk" },
  { label: "Indie", value: "Indie" },
  { label: "Alternative", value: "Alternative" },
  { label: "Punk", value: "Punk" },
  // ... add 30+ more common genres
];

// Preset instrument list
const PRESET_INSTRUMENTS: string[] = [
  "Guitar", "Bass", "Drums", "Piano", "Keyboard", "Vocals",
  "Saxophone", "Trumpet", "Violin", "Cello", "Flute", "Clarinet",
  "Synthesizer", "DJ Equipment", "Percussion", "Harmonica",
  // ... add more
];

export function MusicProfileSection({ client, isEditing, onUpdate }: MusicProfileSectionProps) {
  // Genre selection state
  const [selectedGenres, setSelectedGenres] = useState<Option[]>(
    (client.genres || []).map((g: string) => ({ label: g, value: g }))
  );

  // Instrument selection with proficiency
  const [instruments, setInstruments] = useState<Array<{ name: string; proficiency: string }>>(
    client.instruments || []
  );

  // Handle genre change
  const handleGenresChange = (options: Option[]) => {
    setSelectedGenres(options);
    onUpdate({ genres: options.map(o => o.value) });
  };

  // Handle instrument add (with proficiency selector)
  // ...

  return (
    <div className="space-y-6">
      {/* Genre Selection Card */}
      <Card className="pb-3">
        <CardHeader>
          <CardTitle className="flex items-center gap-2 text-base">
            <Music className="h-8 w-8 text-primary" />
            Genres musicaux
          </CardTitle>
        </CardHeader>
        <CardContent>
          <MultipleSelector
            value={selectedGenres}
            onChange={handleGenresChange}
            defaultOptions={PRESET_GENRES}
            placeholder="Sélectionner genres..."
            creatable
            disabled={!isEditing}
            emptyIndicator={
              <p className="text-center text-sm text-muted-foreground">
                Aucun genre trouvé
              </p>
            }
          />
        </CardContent>
      </Card>

      {/* Instruments Card with Proficiency */}
      <Card className="pb-3">
        <CardHeader>
          <CardTitle className="flex items-center gap-2 text-base">
            <Music className="h-8 w-8 text-primary" />
            Instruments
          </CardTitle>
        </CardHeader>
        <CardContent>
          {/* List existing instruments */}
          {/* Add new instrument button (if editing) */}
          {/* Each instrument: name + proficiency dropdown (beginner/intermediate/pro) */}
        </CardContent>
      </Card>

      {/* Streaming Platforms Card */}
      <Card className="pb-3">
        <CardHeader>
          <CardTitle className="flex items-center gap-2 text-base">
            <Radio className="h-8 w-8 text-primary" />
            Présence en ligne
          </CardTitle>
        </CardHeader>
        <CardContent className="space-y-3">
          <div>
            <Label>Spotify Artist URL</Label>
            <Input
              value={client.spotifyUrl || ""}
              onChange={(e) => onUpdate({ spotifyUrl: e.target.value })}
              placeholder="https://open.spotify.com/artist/..."
              disabled={!isEditing}
            />
          </div>
          <div>
            <Label>Apple Music</Label>
            <Input
              value={client.appleMusicUrl || ""}
              onChange={(e) => onUpdate({ appleMusicUrl: e.target.value })}
              placeholder="https://music.apple.com/..."
              disabled={!isEditing}
            />
          </div>
          {/* SoundCloud, YouTube, Bandcamp, Deezer - same pattern */}
        </CardContent>
      </Card>

      {/* Industry Information Card */}
      <Card className="pb-3">
        <CardHeader>
          <CardTitle className="flex items-center gap-2 text-base">
            <Briefcase className="h-8 w-8 text-primary" />
            Informations industrie
          </CardTitle>
        </CardHeader>
        <CardContent className="grid grid-cols-2 gap-4">
          <div>
            <Label>Label</Label>
            <Input
              value={client.recordLabel || ""}
              onChange={(e) => onUpdate({ recordLabel: e.target.value })}
              disabled={!isEditing}
            />
          </div>
          <div>
            <Label>Distributeur</Label>
            <Input
              value={client.distributor || ""}
              onChange={(e) => onUpdate({ distributor: e.target.value })}
              disabled={!isEditing}
            />
          </div>
          <div>
            <Label>Manager</Label>
            <Input
              value={client.managerName || ""}
              onChange={(e) => onUpdate({ managerName: e.target.value })}
              disabled={!isEditing}
            />
          </div>
          <div>
            <Label>Contact Manager</Label>
            <Input
              value={client.managerContact || ""}
              onChange={(e) => onUpdate({ managerContact: e.target.value })}
              placeholder="email ou téléphone"
              disabled={!isEditing}
            />
          </div>
          <div>
            <Label>Éditeur musical</Label>
            <Input
              value={client.publisher || ""}
              onChange={(e) => onUpdate({ publisher: e.target.value })}
              disabled={!isEditing}
            />
          </div>
          <div>
            <Label>Société de droits (SACEM, SOCAN, etc.)</Label>
            <Input
              value={client.performanceRightsSociety || ""}
              onChange={(e) => onUpdate({ performanceRightsSociety: e.target.value })}
              placeholder="SACEM, SOCAN, BMI, ASCAP..."
              disabled={!isEditing}
            />
          </div>
        </CardContent>
      </Card>
    </div>
  );
}
```

**UI Design Guidelines Applied:**
- Container structure: `pb-3` on Cards
- Icons: `text-primary` on all titles, `h-8 w-8` size
- Spacing: `space-y-6` between cards, `space-y-3` within card content
- Grid: `grid-cols-2 gap-4` for industry fields
- Disabled state: All inputs disabled when `!isEditing`

**WHY separate component:** Keeps MusicProfileSection modular, doesn't clutter EnrichedClientInfo, easier to test/maintain.

**IMPORTANT:** Complete instrument proficiency UI (add/remove instruments, proficiency dropdown).
  </action>
  <verify>
1. Check file exists: `ls packages/client/src/components/MusicProfileSection.tsx`
2. Count lines: `wc -l packages/client/src/components/MusicProfileSection.tsx` (should be ~200+ lines)
3. Verify imports: `grep "import.*MultipleSelector" packages/client/src/components/MusicProfileSection.tsx`
4. TypeScript check: `pnpm --filter client check` (0 errors)
5. Component exports: `grep "export function MusicProfileSection" packages/client/src/components/MusicProfileSection.tsx`
  </verify>
  <done>MusicProfileSection component created with genre multi-select, instruments with proficiency, streaming URLs, industry info cards</done>
</task>

<task type="auto">
  <name>Task 3: Integrate MusicProfileSection in ClientDetail</name>
  <files>packages/client/src/pages/ClientDetail.tsx</files>
  <action>
Integrate MusicProfileSection into ClientDetail.tsx using existing Tabs structure.

**Step 1: Import component** (add to existing imports around line 20)
```typescript
import { MusicProfileSection } from "@/components/MusicProfileSection";
```

**Step 2: Add new Tab** (find existing TabsList around line 150-200)
```typescript
<TabsList>
  <TabsTrigger value="overview">Vue d'ensemble</TabsTrigger>
  <TabsTrigger value="enriched">Informations enrichies</TabsTrigger>
  <TabsTrigger value="music">Profil musical</TabsTrigger> {/* NEW */}
  <TabsTrigger value="notes">Notes</TabsTrigger>
  <TabsTrigger value="history">Historique</TabsTrigger>
</TabsList>
```

**Step 3: Add TabsContent** (after existing TabsContent blocks)
```typescript
<TabsContent value="music">
  <MusicProfileSection
    client={client}
    isEditing={isEditing}
    onUpdate={handleUpdateClient}
  />
</TabsContent>
```

**IMPORTANT:** Verify `handleUpdateClient` function exists and supports partial updates. Should call `updateMutation.mutate()` with updated fields.

**Pattern reference:** See how `EnrichedClientInfo` is integrated in "enriched" tab - use same pattern for "music" tab.

**WHY new tab:** Keeps music profile separate from vCard enrichment. Clear separation of concerns. Users can focus on music profile without clutter.

**UI consistency:** Follow existing tab structure, icon usage, spacing patterns.
  </action>
  <verify>
1. Check import added: `grep "import.*MusicProfileSection" packages/client/src/pages/ClientDetail.tsx`
2. Verify tab trigger: `grep "Profil musical" packages/client/src/pages/ClientDetail.tsx`
3. Check TabsContent: `grep "value=\"music\"" packages/client/src/pages/ClientDetail.tsx`
4. TypeScript check: `pnpm --filter client check` (0 errors)
5. Build check: `pnpm --filter client build` (should succeed)
6. Visual test: Open http://localhost:5174/clients/1 and click "Profil musical" tab
7. Edit mode: Click Edit button, verify music profile fields become editable
8. Save test: Add genre, save, verify it persists
  </verify>
  <done>MusicProfileSection integrated into ClientDetail page, new "Profil musical" tab visible, edit/save functionality working</done>
</task>

</tasks>

<verification>
**Overall Phase 18.4-02 Checks:**

1. **Component Installation:**
   - MultipleSelector component exists in ui/
   - Component exports Option interface
   - TypeScript compiles

2. **MusicProfileSection Component:**
   - File exists with ~200+ lines
   - Genre multi-select with creatable option
   - Instrument selection with proficiency levels
   - 6 streaming platform URL inputs
   - 6 industry information inputs
   - Proper Card/Input/Label structure
   - Icons text-primary, Cards pb-3
   - Disabled state when !isEditing

3. **ClientDetail Integration:**
   - Import added
   - New "Profil musical" tab in TabsList
   - TabsContent renders MusicProfileSection
   - Edit mode toggles correctly
   - Save persists data to database

4. **Functionality Testing:**
   - Genre selection works (preset + custom)
   - Instruments add/remove/proficiency works
   - Streaming URLs editable
   - Industry fields editable
   - Data persists on save

**Success Criteria:**
✅ MusicProfileSection component created
✅ Multi-select components working
✅ Integrated in ClientDetail page
✅ Edit/save functionality operational
✅ UI follows design guidelines
✅ TypeScript compiles with 0 errors
</verification>

<success_criteria>
**Measurable Completion:**

1. Component created: packages/client/src/components/MusicProfileSection.tsx exists
2. Multi-select installed: packages/client/src/components/ui/multiple-selector.tsx exists
3. Integration complete: ClientDetail.tsx has "Profil musical" tab
4. Functionality working: Can select genres, add instruments, enter URLs, save changes
5. Zero errors: `pnpm check` passes
6. Visual validation: Music profile tab displays correctly on ClientDetail page

**Phase 18.4-02 is complete when:**
- Music profile UI exists and is functional
- Users can select genres from presets or add custom
- Users can add instruments with proficiency levels
- Streaming URLs and industry info are editable
- Data persists correctly on save
</success_criteria>

<output>
After completion, create `.planning/phases/18.4-music-profile-for-artists/18.4-02-SUMMARY.md` documenting:
- MusicProfileSection component details (lines of code, features)
- Multi-select component installation notes
- Integration points in ClientDetail
- Preset genre/instrument lists (count)
- Edit/save functionality verification
- Time taken
- Screenshots or visual validation notes
</output>
