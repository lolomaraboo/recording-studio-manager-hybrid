---
phase: 11.5-catalogue-services
plan: 02
type: execute
---

<objective>
Build dedicated Service Catalog management page with table view, create/edit modal, delete confirmation, and search/filter UI.

Purpose: Enable studio managers to create and maintain a centralized catalog of pre-defined services (studio time, post-production, equipment rental) for quick quote creation.
Output: /services page with full CRUD interface, category filtering, and search functionality.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11.5-catalogue-services/11.5-CONTEXT.md
@.planning/phases/11.5-catalogue-services/11.5-01-SUMMARY.md

**Codebase UI patterns:**
@packages/client/src/pages/Clients.tsx # Table view with search/filter, create modal pattern
@packages/client/src/pages/Rooms.tsx # CRUD page structure, edit/delete icons
@packages/client/src/pages/Equipment.tsx # Category-based filtering pattern

**UI harmonization (from Phase 3.14):**
- Container: `pt-2 pb-4 px-2`
- Page title icons: `text-primary h-8 w-8`
- Card headers: `pb-3`, card titles: `text-base`
- Empty states: `py-6` container, `h-8` icons

**Service catalog UI requirements from CONTEXT.md:**
- Table with all columns visible: Nom | Catégorie | Prix | TVA | Qté défaut | Actions
- Buttons: "Nouveau service" (primary), Edit icon, Delete icon
- Filters: Category dropdown (all/Studio/Post-prod/Location/Autre)
- Search: Real-time fuzzy search in name/description
- Modal form: Name, description (optional), category, unitPrice, taxRate, defaultQuantity
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Services page with table view and filters</name>
  <files>packages/client/src/pages/Services.tsx (new)</files>
  <action>
Create Services.tsx following Clients.tsx pattern with service-specific columns:

**Key components:**
- Page header with breadcrumb (ArrowLeft to Dashboard), title "Services", "Nouveau service" button
- Search input (real-time debounced search in name/description)
- Category filter dropdown (All, Studio, Post-production, Location matériel, Autre)
- Table with columns: Nom, Catégorie, Prix unitaire, TVA, Qté défaut, Actions (Edit/Delete icons)
- Empty state when no services (plus icon, "Aucun service", "Créez votre premier service...")
- Pagination if needed (reuse pattern from Clients.tsx)

**State management:**
- useState for search query, category filter, create/edit modal open state
- trpc.serviceCatalog.list.useQuery with search/category params
- Real-time search: useEffect with 300ms debounce (like global search)

**Styling (UI harmonization):**
- Container: `className="pt-2 pb-4 px-2"`
- Title icon (Package): `className="h-8 w-8 text-primary"`
- Card: `<Card className="pb-3">`
- Table: shadcn/ui Table component
- Price/TVA display: Format with 2 decimals, € symbol

Use Package icon from lucide-react for services (catalog metaphor).
  </action>
  <verify>
- Page renders without errors: Visit http://localhost:5174/services
- Search input filters services in real-time (fuzzy match name/description)
- Category filter shows correct services per category
- Table displays all columns with proper formatting
- Empty state shows when no services exist
- "Nouveau service" button visible and clickable
  </verify>
  <done>Services page displays service catalog in table format with working search and category filters</done>
</task>

<task type="auto">
  <name>Task 2: Create service create/edit modal with form validation</name>
  <files>packages/client/src/pages/Services.tsx</files>
  <action>
Add create/edit modal to Services.tsx (pattern from CreateClient modal):

**Modal structure:**
- Dialog component (shadcn/ui)
- Title: "Nouveau service" (create) or "Modifier le service" (edit)
- Form fields:
  1. Nom* (Input, required, maxLength 255)
  2. Description (Textarea, optional, 3 rows)
  3. Catégorie* (Select: Studio, Post-production, Location matériel, Autre)
  4. Prix unitaire* (Input type="number", step="0.01", min="0", suffix "€")
  5. TVA* (Select: 20%, 10%, 5.5%, 5%, 2.1%, 0% (exempt))
  6. Quantité par défaut* (Input type="number", step="0.01", min="0.01", default="1.00")
- Footer: Cancel button, Save button (primary)

**Form state:**
- useState for form fields (name, description, category, unitPrice, taxRate, defaultQuantity)
- Pre-fill form when editing (modal receives service object)
- Clear form when modal closes

**Validation:**
- Client-side: Required fields, positive numbers, 2 decimal precision
- Display error messages below fields (red text)
- Disable Save button while submitting

**Mutations:**
- trpc.serviceCatalog.create.useMutation (optimistic update, invalidate list query)
- trpc.serviceCatalog.update.useMutation (optimistic update, invalidate list query)
- Toast notifications: success/error

**UX improvements:**
- Auto-focus on name field when modal opens
- Press Enter in name field = move to next field (not submit)
- Press Escape = close modal
- Click outside = close modal (with unsaved changes warning if dirty)
  </action>
  <verify>
- "Nouveau service" button opens modal with empty form
- All form fields render correctly with proper input types
- Category and TVA dropdowns populate with correct options
- Save button creates new service and closes modal
- Edit icon opens modal pre-filled with service data
- Update saves changes and refreshes table
- Form validation shows errors for invalid inputs
- Toast notifications appear on success/error
  </verify>
  <done>Create/Edit modal functional with full form validation, optimistic updates, and proper UX</done>
</task>

<task type="auto">
  <name>Task 3: Add delete confirmation and register route</name>
  <files>packages/client/src/pages/Services.tsx, packages/client/src/App.tsx</files>
  <action>
**Delete confirmation (in Services.tsx):**
- Add AlertDialog component (shadcn/ui) for delete confirmation
- Trigger: Click trash icon in table row
- Dialog content: "Êtes-vous sûr de vouloir supprimer ce service ?" + service name
- Warning: "Cette action est irréversible. Les devis existants utilisant ce service ne seront pas affectés."
- Buttons: Annuler (secondary), Supprimer (destructive variant)
- Mutation: trpc.serviceCatalog.delete.useMutation with optimistic update
- Toast on success: "Service supprimé"

**Route registration (in App.tsx):**
Add route after /quotes routes (around line with QuoteDetail):
```tsx
<Route path="/services" element={<Services />} />
```

Add import at top:
```tsx
import Services from "@/pages/Services";
```

**Sidebar integration:**
Add link in src/components/Sidebar.tsx (CONTACTS section):
```tsx
<SidebarLink to="/services" icon={Package}>
  Services
</SidebarLink>
```
Add Package import from lucide-react.

Position: After /clients link, before /talents (logical grouping: Clients → Services → Talents)
  </action>
  <verify>
- Delete icon in table triggers confirmation dialog
- Dialog shows service name being deleted
- Confirm deletion removes service from table
- Toast notification appears on successful delete
- /services route accessible via browser URL
- Services link appears in sidebar CONTACTS section
- Clicking sidebar link navigates to Services page
- Active state highlights when on /services route
  </verify>
  <done>Delete confirmation dialog working, route registered, sidebar navigation integrated</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Services page accessible at http://localhost:5174/services
- [ ] Table displays services with all columns formatted correctly
- [ ] Search filters services in real-time
- [ ] Category filter shows correct subset
- [ ] Create modal saves new services successfully
- [ ] Edit modal updates existing services
- [ ] Delete confirmation removes services
- [ ] Sidebar link navigates to Services page
- [ ] No TypeScript errors: `pnpm --filter client tsc --noEmit`
</verification>

<success_criteria>
- Services management page fully functional
- CRUD operations work end-to-end (Create, Read, Update, Delete)
- Search and category filters perform correctly
- UI follows Phase 3.14 harmonization guidelines
- Sidebar navigation integrated in CONTACTS section
- Toast notifications provide clear feedback
- Form validation prevents invalid data entry
</success_criteria>

<output>
After completion, create `.planning/phases/11.5-catalogue-services/11.5-02-SUMMARY.md`:

# Phase 11.5 Plan 02: Service Catalog Management Page Summary

**Dedicated Services page with full CRUD interface complete**

## Accomplishments

- Created /services page with table view of catalog items
- Implemented real-time search (fuzzy match name/description)
- Added category filter dropdown (4 categories)
- Built create/edit modal with 6-field form and validation
- Integrated delete confirmation dialog with safety warning
- Added Services link to sidebar (CONTACTS section, Package icon)
- Applied UI harmonization patterns from Phase 3.14

## Files Created/Modified

- `packages/client/src/pages/Services.tsx` - New page (450-500 lines)
- `packages/client/src/App.tsx` - Added /services route
- `packages/client/src/components/Sidebar.tsx` - Added Services navigation link

## Decisions Made

- Positioned Services in CONTACTS section (logical grouping: Clients → Services → Talents)
- TVA dropdown includes 6 common rates: 20%, 10%, 5.5%, 5%, 2.1%, 0% (covers EU standard + reduced + exempt)
- Delete warning mentions "Les devis existants ne seront pas affectés" (clarifies impact)
- Package icon chosen for Services (catalog/inventory metaphor)
- Default quantity pre-filled to 1.00 (most common case)

## Issues Encountered

None - standard CRUD page following established patterns

## Next Step

Ready for 11.5-03-PLAN.md: Quote Builder Integration (autocomplete + catalog modal)
</output>
