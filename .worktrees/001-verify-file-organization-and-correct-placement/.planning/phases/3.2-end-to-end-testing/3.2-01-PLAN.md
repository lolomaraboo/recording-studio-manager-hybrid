# Phase 3.2-01: Exhaustive E2E Test Suite - Test Everything

<objective>
Create comprehensive E2E test suite that tests EVERY page, EVERY button, EVERY form, EVERY interaction in the entire application before marketing launch.

**User requirement:** "il faut qu on teste toutes les clics possibles. tout le site"

**Scope:**
- **53 pages total** (44 staff portal + 5 client portal + 4 auth)
- Every navigation link and button
- Every form submission (create, update, delete)
- Every modal and dialog
- Every tab and accordion
- All CRUD operations for all entities
- Client portal complete workflow
- Payment flows (Stripe)
- File uploads (audio, images)
- Search, filters, sorting
- Settings and preferences
- Analytics and reports

**Current state:**
- 13 scattered test files (partial coverage)
- Missing: 80%+ of pages untested
- No systematic coverage tracking

**Target:**
- 100% page coverage
- 100% clickable element coverage
- Organized test structure
- All tests passing on production
</objective>

<execution_context>
@.planning/PROJECT.md - All features documented in DEEP_ANALYSIS_3_VERSIONS.md
@.planning/STATE.md - Production operational
@packages/client/src/App.tsx - All 53 routes defined

**Application structure (from App.tsx):**

**Staff Portal (44 routes):**
- Dashboard (1 page)
- Sessions (3 pages: list, create, detail)
- Clients (3 pages: list, create, detail)
- Invoices (3 pages: list, create, detail)
- Rooms (3 pages: list, create, detail)
- Equipment (3 pages: list, create, detail)
- Projects (3 pages: list, create, detail)
- Tracks (3 pages: list, create, detail)
- Talents (3 pages: list, create, detail)
- Quotes (3 pages: list, create, detail)
- Contracts (3 pages: list, create, detail)
- Expenses (3 pages: list, create, detail)
- Calendar (1 page)
- Audio Files (1 page)
- Financial Reports (1 page)
- Reports (1 page)
- Analytics (1 page)
- Chat (1 page - AI chatbot)
- Notifications (1 page)
- Shares (1 page)
- Settings (1 page)
- Team (1 page)

**Client Portal (5 routes):**
- Client Dashboard (1 page)
- Bookings (2 pages: list, detail)
- Profile (1 page)
- Client Login (1 page - separate auth)

**Auth (4 routes):**
- Staff Login (1 page)
- Staff Register (1 page)
- Client Login (1 page)
- Magic Link Verify (1 page)

**Entities to test (CRUD operations):**
1. Sessions
2. Clients
3. Invoices
4. Rooms
5. Equipment
6. Projects
7. Tracks
8. Talents
9. Quotes
10. Contracts
11. Expenses

**Features discovered (from STATE.md):**
- AI Chatbot (37 actions, SSE streaming)
- Audio System (Cloudinary upload, 4 versions, custom player)
- Client Portal (10 features)
- Command Palette (Cmd+K)
- Global Search
- Dark/Light Theme
- Notification Center
- Stripe Subscriptions (3 tiers + AI packs)
</execution_context>

<context>
**Testing strategy:**

**Phase 1: Page Accessibility** - Can we navigate to every page?
- Test all navigation links
- Verify page loads without errors
- Check for 404/500 errors
- Verify protected routes require auth

**Phase 2: CRUD Operations** - Can we create/read/update/delete every entity?
- 11 entities × 4 operations = 44 test scenarios
- Form validation testing
- Success/error message verification
- Database persistence verification

**Phase 3: User Interactions** - Can we click everything?
- All buttons (primary, secondary, danger)
- All modals and dialogs
- All tabs and accordions
- All dropdowns and selects
- All checkboxes and radios
- All search and filter inputs

**Phase 4: Workflows** - Do complete user journeys work?
- Signup → First project → First track
- Booking flow (client books session)
- Payment flow (upgrade subscription)
- Invoice flow (create → send → mark paid)
- Project workflow (create → add tracks → share)

**Phase 5: Special Features** - Do advanced features work?
- AI Chatbot (send message, receive response)
- Audio Player (upload, play, download)
- Command Palette (Cmd+K, search, navigate)
- Global Search (find entities)
- Theme Toggle (dark/light switch)
- Notifications (SSE stream, mark read)
</context>

<tasks>

## Task 1: Create comprehensive page navigation tests
**Objective:** Test that every single page is accessible and loads correctly

**Test file:** `e2e/navigation/all-pages.spec.ts`

**Structure:**
```typescript
test.describe('Page Navigation - Staff Portal', () => {
  test.beforeEach(async ({ page }) => {
    // Login as staff user
    await loginAsStaff(page);
  });

  // Dashboard
  test('Dashboard page loads', async ({ page }) => {
    await page.goto('/');
    await expect(page.locator('h1')).toContainText('Dashboard');
    await page.screenshot({ path: 'screenshots/dashboard.png' });
  });

  // Sessions (3 pages)
  test('Sessions list page loads', async ({ page }) => {
    await page.goto('/sessions');
    await expect(page.locator('h1')).toContainText('Sessions');
  });

  test('Sessions create page loads', async ({ page }) => {
    await page.goto('/sessions/new');
    await expect(page.locator('h1')).toContainText('New Session');
  });

  test('Sessions detail page loads', async ({ page }) => {
    // Create session first, then visit detail
  });

  // ... Repeat for all 44 staff portal pages
});

test.describe('Page Navigation - Client Portal', () => {
  test.beforeEach(async ({ page }) => {
    // Login as client user
    await loginAsClient(page);
  });

  // Test all 5 client portal pages
});

test.describe('Page Navigation - Auth Pages', () => {
  // Test 4 auth pages (no login needed)
});
```

**Coverage target:** 53 pages × 1 test = 53 tests

**Actions:**
1. Create `e2e/navigation/all-pages.spec.ts` with 53 tests
2. Use helper functions for login (staff vs client)
3. Take screenshot of each page
4. Verify page title/heading
5. Check for console errors
6. Run and capture results

**Output:**
- `e2e/navigation/all-pages.spec.ts` (53 tests)
- `screenshots/` directory with 53 screenshots

**Verify:**
- [ ] All 53 pages accessible
- [ ] No 404 or 500 errors
- [ ] All pages have correct headings
- [ ] No console errors on any page

---

## Task 2: Create CRUD operation tests for all entities
**Objective:** Test Create, Read, Update, Delete for all 11 entities

**Test files:**
- `e2e/crud/sessions.spec.ts`
- `e2e/crud/clients.spec.ts`
- `e2e/crud/invoices.spec.ts`
- `e2e/crud/rooms.spec.ts`
- `e2e/crud/equipment.spec.ts`
- `e2e/crud/projects.spec.ts`
- `e2e/crud/tracks.spec.ts`
- `e2e/crud/talents.spec.ts`
- `e2e/crud/quotes.spec.ts`
- `e2e/crud/contracts.spec.ts`
- `e2e/crud/expenses.spec.ts`

**Structure (example for Sessions):**
```typescript
test.describe('CRUD: Sessions', () => {
  let sessionId: string;

  test('CREATE: Can create new session', async ({ page }) => {
    await page.goto('/sessions/new');

    // Fill all form fields
    await page.fill('#client', 'Test Client');
    await page.fill('#room', 'Studio A');
    await page.fill('#date', '2025-01-15');
    await page.fill('#time', '14:00');
    await page.fill('#duration', '2');

    // Submit
    await page.click('button[type="submit"]');

    // Verify success
    await expect(page.locator('.toast')).toContainText('Session created');

    // Capture ID from URL
    sessionId = page.url().match(/\/sessions\/(\d+)/)?.[1];
  });

  test('READ: Can view session list', async ({ page }) => {
    await page.goto('/sessions');

    // Verify list shows items
    const rows = page.locator('table tbody tr');
    await expect(rows).toHaveCount(await rows.count());
  });

  test('READ: Can view session detail', async ({ page }) => {
    await page.goto(`/sessions/${sessionId}`);

    // Verify details displayed
    await expect(page.locator('h1')).toContainText('Session');
  });

  test('UPDATE: Can edit session', async ({ page }) => {
    await page.goto(`/sessions/${sessionId}`);

    // Click edit button
    await page.click('button:has-text("Edit")');

    // Change field
    await page.fill('#duration', '3');
    await page.click('button:has-text("Save")');

    // Verify success
    await expect(page.locator('.toast')).toContainText('updated');
  });

  test('DELETE: Can delete session', async ({ page }) => {
    await page.goto(`/sessions/${sessionId}`);

    // Click delete button
    await page.click('button:has-text("Delete")');

    // Confirm dialog
    await page.click('button:has-text("Confirm")');

    // Verify redirect to list
    await expect(page).toHaveURL('/sessions');
    await expect(page.locator('.toast')).toContainText('deleted');
  });
});
```

**Coverage target:** 11 entities × 4 operations = 44 tests

**Actions:**
1. Create 11 test files (one per entity)
2. Each file has 4 tests (CRUD)
3. Test sequences: Create first, then Read/Update/Delete use created entity
4. Verify form validation (required fields, formats)
5. Verify success/error messages
6. Run all tests and verify database changes

**Output:**
- 11 test files in `e2e/crud/`
- 44 total tests

**Verify:**
- [ ] All 11 entities can be created
- [ ] All entities can be viewed (list and detail)
- [ ] All entities can be updated
- [ ] All entities can be deleted
- [ ] Form validation works for all entities

---

## Task 3: Create interaction tests for all UI elements
**Objective:** Test every clickable element, every modal, every dropdown

**Test files:**
- `e2e/interactions/buttons.spec.ts` - All button clicks
- `e2e/interactions/modals.spec.ts` - All modal opens/closes
- `e2e/interactions/forms.spec.ts` - All form inputs
- `e2e/interactions/navigation.spec.ts` - All nav links
- `e2e/interactions/search-filters.spec.ts` - All search/filter inputs
- `e2e/interactions/tabs-accordions.spec.ts` - All tabs and accordions

**Example: Modals test**
```typescript
test.describe('Modals and Dialogs', () => {
  test('Create Project modal opens and closes', async ({ page }) => {
    await page.goto('/projects');

    // Open modal
    await page.click('button:has-text("Nouveau Projet")');
    await expect(page.locator('.modal')).toBeVisible();

    // Close with X button
    await page.click('.modal button[aria-label="Close"]');
    await expect(page.locator('.modal')).not.toBeVisible();

    // Open again
    await page.click('button:has-text("Nouveau Projet")');

    // Close with Escape key
    await page.keyboard.press('Escape');
    await expect(page.locator('.modal')).not.toBeVisible();

    // Open and close with Cancel button
    await page.click('button:has-text("Nouveau Projet")');
    await page.click('button:has-text("Cancel")');
    await expect(page.locator('.modal')).not.toBeVisible();
  });

  // Repeat for all modals:
  // - Create Track modal
  // - Create Client modal
  // - Create Invoice modal
  // - Delete confirmation dialogs
  // - Settings modals
  // - etc.
});
```

**Example: Tabs test**
```typescript
test.describe('Tabs and Accordions', () => {
  test('Project Detail tabs switch correctly', async ({ page }) => {
    await page.goto('/projects/1');

    // Verify Overview tab active by default
    await expect(page.locator('[role="tab"][aria-selected="true"]')).toContainText('Overview');

    // Click Tracks tab
    await page.click('[role="tab"]:has-text("Tracks")');
    await expect(page.locator('[role="tabpanel"]')).toContainText('Track');

    // Click Files tab
    await page.click('[role="tab"]:has-text("Files")');
    await expect(page.locator('[role="tabpanel"]')).toContainText('Audio');

    // Click Activity tab
    await page.click('[role="tab"]:has-text("Activity")');
    await expect(page.locator('[role="tabpanel"]')).toContainText('Activity');
  });

  // Repeat for all pages with tabs:
  // - Client Detail (Overview, Bookings, Invoices, Projects)
  // - Track Detail (Info, Versions, Activity)
  // - Settings (General, Subscription, Notifications, etc.)
});
```

**Coverage target:** ~200 interaction tests

**Actions:**
1. Audit all pages for interactive elements
2. Create test for each element type
3. Verify state changes (visible/hidden, enabled/disabled)
4. Test keyboard navigation (Tab, Enter, Escape)
5. Test accessibility (aria-labels, roles)

**Output:**
- 6 test files in `e2e/interactions/`
- ~200 total tests

**Verify:**
- [ ] All buttons clickable and functional
- [ ] All modals open/close correctly
- [ ] All forms accept input and validate
- [ ] All navigation links work
- [ ] All search/filter inputs work
- [ ] All tabs and accordions switch correctly

---

## Task 4: Create complete user workflow tests
**Objective:** Test end-to-end user journeys for critical business flows

**Test file:** `e2e/workflows/complete-journeys.spec.ts`

**Workflows to test:**

### Workflow 1: New Studio Onboarding
```typescript
test('Complete onboarding: Signup → First Client → First Session → First Invoice', async ({ page }) => {
  const timestamp = Date.now();

  // 1. Signup
  await page.goto('/register');
  await page.fill('#email', `studio-${timestamp}@example.com`);
  await page.fill('#password', 'StrongPass123!');
  await page.fill('#studioName', `Studio ${timestamp}`);
  await page.click('button[type="submit"]');

  // 2. Login (if signup doesn't auto-login)
  if (page.url().includes('/login')) {
    await page.fill('#email', `studio-${timestamp}@example.com`);
    await page.fill('#password', 'StrongPass123!');
    await page.click('button[type="submit"]');
  }

  // 3. Create first client
  await page.goto('/clients/new');
  await page.fill('#name', 'First Client');
  await page.fill('#email', `client-${timestamp}@example.com`);
  await page.click('button[type="submit"]');

  // 4. Create first room
  await page.goto('/rooms/new');
  await page.fill('#name', 'Studio A');
  await page.fill('#hourlyRate', '50');
  await page.click('button[type="submit"]');

  // 5. Book first session
  await page.goto('/sessions/new');
  await page.selectOption('#client', { label: 'First Client' });
  await page.selectOption('#room', { label: 'Studio A' });
  await page.fill('#date', '2025-01-20');
  await page.fill('#time', '14:00');
  await page.fill('#duration', '2');
  await page.click('button[type="submit"]');

  // 6. Create invoice for session
  await page.goto('/invoices/new');
  await page.selectOption('#client', { label: 'First Client' });
  await page.click('button:has-text("Add Session")');
  await page.check('input[type="checkbox"]:near(:text("First Client"))');
  await page.click('button:has-text("Add Selected")');
  await page.click('button[type="submit"]');

  // Verify invoice created
  await expect(page.locator('.toast')).toContainText('Invoice created');

  // Take final screenshot
  await page.screenshot({ path: 'screenshots/workflow-onboarding-complete.png', fullPage: true });
});
```

### Workflow 2: Client Books Session via Client Portal
```typescript
test('Client Portal: Client books session → Studio approves → Client receives confirmation', async ({ page, context }) => {
  // Setup: Studio creates client account first
  const clientEmail = `client-booking-${Date.now()}@example.com`;

  // Studio side: Create client
  await loginAsStaff(page);
  await page.goto('/clients/new');
  await page.fill('#email', clientEmail);
  await page.fill('#name', 'Booking Test Client');
  await page.click('button[type="submit"]');

  // Client side: Login to client portal
  await page.goto('/client-portal/login');
  await page.fill('#email', clientEmail);
  await page.fill('#password', 'ClientPass123!');
  await page.click('button[type="submit"]');

  // Browse available sessions
  await page.goto('/client-portal/bookings');
  await page.click('button:has-text("Book Session")');

  // Fill booking form
  await page.selectOption('#room', 'Studio A');
  await page.fill('#date', '2025-02-01');
  await page.fill('#time', '10:00');
  await page.fill('#duration', '3');
  await page.fill('#notes', 'Need recording for album');
  await page.click('button[type="submit"]');

  // Verify confirmation
  await expect(page.locator('.toast')).toContainText('Booking request sent');

  // Studio side: Approve booking
  await loginAsStaff(page);
  await page.goto('/sessions');
  await page.click('button:has-text("Pending")'); // Filter pending
  await page.click('button:has-text("Approve"):first');

  // Verify approved
  await expect(page.locator('.toast')).toContainText('Booking approved');
});
```

### Workflow 3: Project Creation → Track Upload → Share with Client
```typescript
test('Complete project workflow: Create project → Upload tracks → Share with client', async ({ page }) => {
  // 1. Create project
  await page.goto('/projects/new');
  await page.selectOption('#client', 'Test Client');
  await page.fill('#name', 'Album Recording');
  await page.fill('#genre', 'Rock');
  await page.fill('#budget', '10000');
  await page.click('button[type="submit"]');

  const projectUrl = page.url();

  // 2. Add track
  await page.click('button:has-text("Tracks")');
  await page.click('button:has-text("Ajouter Track")');
  await page.fill('#track-title', 'Track One');
  await page.fill('#track-bpm', '120');
  await page.fill('#track-key', 'C');
  await page.click('button[type="submit"]');

  // 3. Upload audio file
  await page.click('text=Track One');
  await page.click('button:has-text("Upload Audio")');

  // Simulate file upload (use test audio file)
  const fileInput = page.locator('input[type="file"]');
  await fileInput.setInputFiles('test-fixtures/test-audio.mp3');

  await page.click('button:has-text("Upload")');
  await expect(page.locator('.toast')).toContainText('uploaded');

  // 4. Share project with client
  await page.goto(projectUrl);
  await page.click('button:has-text("Share")');
  await page.check('input[type="checkbox"]:near(:text("Client Access"))');
  await page.click('button:has-text("Save Sharing Settings")');

  await expect(page.locator('.toast')).toContainText('Sharing updated');
});
```

### Workflow 4: Stripe Subscription Upgrade
```typescript
test('Payment: Upgrade from Free to Pro subscription', async ({ page }) => {
  await loginAsStaff(page);

  // 1. Navigate to settings
  await page.goto('/settings');
  await page.click('button:has-text("Subscription")');

  // 2. Verify current plan (Free)
  await expect(page.locator('.current-plan')).toContainText('Free');

  // 3. Click upgrade
  await page.click('button:has-text("Upgrade to Pro")');

  // 4. Stripe checkout opens (in new context/tab)
  const [checkoutPage] = await Promise.all([
    page.waitForEvent('popup'),
    page.click('button:has-text("Continue to Payment")')
  ]);

  // 5. Fill Stripe test card
  await checkoutPage.fill('input[name="cardNumber"]', '4242 4242 4242 4242');
  await checkoutPage.fill('input[name="cardExpiry"]', '12/30');
  await checkoutPage.fill('input[name="cardCvc"]', '123');
  await checkoutPage.fill('input[name="billingName"]', 'Test User');

  // 6. Submit payment
  await checkoutPage.click('button[type="submit"]');

  // 7. Wait for redirect back to app
  await page.waitForURL(/.*success.*/);

  // 8. Verify subscription updated
  await page.goto('/settings');
  await expect(page.locator('.current-plan')).toContainText('Pro');
  await expect(page.locator('.plan-limits')).toContainText('Unlimited sessions');
});
```

### Workflow 5: Invoice Creation → Email → Payment
```typescript
test('Complete invoice workflow: Create → Send email → Mark paid', async ({ page }) => {
  // 1. Create invoice
  await page.goto('/invoices/new');
  await page.selectOption('#client', 'Test Client');
  await page.fill('#description', 'Recording session 2025-01-15');
  await page.fill('#amount', '200');
  await page.click('button[type="submit"]');

  const invoiceUrl = page.url();
  const invoiceId = invoiceUrl.match(/\/invoices\/(\d+)/)?.[1];

  // 2. Send email to client
  await page.click('button:has-text("Send Email")');
  await expect(page.locator('.toast')).toContainText('Email sent');

  // 3. Mark as paid
  await page.click('button:has-text("Mark Paid")');
  await page.selectOption('#paymentMethod', 'Credit Card');
  await page.fill('#paymentDate', '2025-01-16');
  await page.click('button:has-text("Confirm Payment")');

  // 4. Verify status updated
  await expect(page.locator('.invoice-status')).toContainText('Paid');

  // 5. Verify in financial reports
  await page.goto('/financial-reports');
  await expect(page.locator(`tr:has-text("Invoice ${invoiceId}")`)).toBeVisible();
});
```

**Coverage target:** 5 major workflows

**Output:**
- `e2e/workflows/complete-journeys.spec.ts` (5 tests)

**Verify:**
- [ ] New studio onboarding works end-to-end
- [ ] Client booking flow works
- [ ] Project creation + track upload + sharing works
- [ ] Subscription upgrade works
- [ ] Invoice workflow works

---

## Task 5: Create feature-specific tests
**Objective:** Test advanced features (AI, audio, search, etc.)

**Test files:**
- `e2e/features/ai-chatbot.spec.ts`
- `e2e/features/audio-player.spec.ts`
- `e2e/features/command-palette.spec.ts`
- `e2e/features/global-search.spec.ts`
- `e2e/features/theme-toggle.spec.ts`
- `e2e/features/notifications.spec.ts`

**Example: AI Chatbot**
```typescript
test.describe('AI Chatbot', () => {
  test('Can send message and receive response', async ({ page }) => {
    await page.goto('/chat');

    // Type message
    await page.fill('#chat-input', 'Show me my revenue this month');
    await page.click('button:has-text("Send")');

    // Wait for AI response (SSE stream)
    await page.waitForSelector('.ai-response', { timeout: 10000 });

    // Verify response contains data
    const response = await page.locator('.ai-response').textContent();
    expect(response).toBeTruthy();
    expect(response).toContain('€'); // Should show revenue
  });

  test('AI chatbot handles follow-up questions', async ({ page }) => {
    await page.goto('/chat');

    // First question
    await page.fill('#chat-input', 'How many clients do I have?');
    await page.click('button:has-text("Send")');
    await page.waitForSelector('.ai-response:nth-of-type(1)');

    // Follow-up question
    await page.fill('#chat-input', 'Show me their names');
    await page.click('button:has-text("Send")');
    await page.waitForSelector('.ai-response:nth-of-type(2)');

    // Verify context maintained
    const response2 = await page.locator('.ai-response:nth-of-type(2)').textContent();
    expect(response2).toMatch(/client|name/i);
  });

  test('AI chatbot can create entities via commands', async ({ page }) => {
    await page.goto('/chat');

    // Ask to create session
    await page.fill('#chat-input', 'Create a session for tomorrow at 2pm with John Doe in Studio A');
    await page.click('button:has-text("Send")');

    // Wait for response
    await page.waitForSelector('.ai-response');

    // Verify session created
    await page.goto('/sessions');
    await expect(page.locator('table')).toContainText('John Doe');
    await expect(page.locator('table')).toContainText('2:00 PM');
  });
});
```

**Example: Audio Player**
```typescript
test.describe('Audio Player', () => {
  test('Can upload audio file', async ({ page }) => {
    await page.goto('/tracks/1');

    await page.click('button:has-text("Upload Audio")');

    const fileInput = page.locator('input[type="file"]');
    await fileInput.setInputFiles('test-fixtures/test-audio.mp3');

    await page.click('button:has-text("Upload")');

    // Wait for Cloudinary upload
    await expect(page.locator('.toast')).toContainText('uploaded', { timeout: 30000 });
  });

  test('Can play audio file', async ({ page }) => {
    await page.goto('/tracks/1');

    // Click play button
    await page.click('button[aria-label="Play"]');

    // Verify audio element playing
    const audio = page.locator('audio');
    const isPaused = await audio.evaluate((el: HTMLAudioElement) => el.paused);
    expect(isPaused).toBe(false);
  });

  test('Can switch between audio versions', async ({ page }) => {
    await page.goto('/tracks/1');

    // Verify versions dropdown exists
    await expect(page.locator('select#version')).toBeVisible();

    // Switch to Rough version
    await page.selectOption('select#version', 'rough');
    await page.waitForTimeout(1000);

    // Verify audio source changed
    const audioSrc = await page.locator('audio').getAttribute('src');
    expect(audioSrc).toContain('rough');
  });

  test('Can download audio file', async ({ page }) => {
    await page.goto('/tracks/1');

    // Click download button
    const [download] = await Promise.all([
      page.waitForEvent('download'),
      page.click('button:has-text("Download")')
    ]);

    // Verify download started
    expect(download.suggestedFilename()).toMatch(/\.mp3$/);
  });
});
```

**Example: Command Palette**
```typescript
test.describe('Command Palette (Cmd+K)', () => {
  test('Opens with Cmd+K shortcut', async ({ page }) => {
    await page.goto('/');

    // Press Cmd+K (Meta+K on Mac, Ctrl+K on Windows)
    await page.keyboard.press('Meta+K');

    // Verify palette opens
    await expect(page.locator('[role="dialog"]:has-text("Command Palette")')).toBeVisible();
  });

  test('Can search and navigate to pages', async ({ page }) => {
    await page.goto('/');
    await page.keyboard.press('Meta+K');

    // Type search query
    await page.fill('input[placeholder*="search" i]', 'clients');

    // Verify results shown
    await expect(page.locator('[role="option"]:has-text("Clients")')).toBeVisible();

    // Select result
    await page.click('[role="option"]:has-text("Clients")');

    // Verify navigation
    await expect(page).toHaveURL('/clients');
  });

  test('Can execute quick actions', async ({ page }) => {
    await page.goto('/');
    await page.keyboard.press('Meta+K');

    // Search for action
    await page.fill('input[placeholder*="search" i]', 'new session');

    // Execute action
    await page.click('[role="option"]:has-text("Create New Session")');

    // Verify modal opens
    await expect(page.locator('.modal:has-text("New Session")')).toBeVisible();
  });
});
```

**Example: Global Search**
```typescript
test.describe('Global Search', () => {
  test('Can search across all entities', async ({ page }) => {
    await page.goto('/');

    // Click search input in header
    await page.click('input[placeholder*="Search" i]');

    // Type search query
    await page.fill('input[placeholder*="Search" i]', 'test client');

    // Wait for results
    await page.waitForSelector('.search-results');

    // Verify results from multiple entity types
    await expect(page.locator('.search-results')).toContainText('Clients');
    await expect(page.locator('.search-results')).toContainText('Projects');
    await expect(page.locator('.search-results')).toContainText('Sessions');
  });

  test('Search filters by entity type', async ({ page }) => {
    await page.goto('/');
    await page.click('input[placeholder*="Search" i]');
    await page.fill('input[placeholder*="Search" i]', 'test');

    // Click filter for Clients only
    await page.click('button:has-text("Clients")');

    // Verify only client results shown
    await expect(page.locator('.search-results')).toContainText('Clients');
    await expect(page.locator('.search-results')).not.toContainText('Projects');
  });
});
```

**Coverage target:** 6 feature test files, ~30 tests

**Output:**
- 6 test files in `e2e/features/`
- ~30 total tests

**Verify:**
- [ ] AI chatbot sends/receives messages
- [ ] Audio player uploads, plays, downloads files
- [ ] Command palette opens and executes actions
- [ ] Global search finds entities across types
- [ ] Theme toggle switches dark/light
- [ ] Notifications stream and mark read

---

## Task 6: Organize existing tests into new structure
**Objective:** Move 13 scattered test files into organized `e2e/` directory

**Actions:**

1. **Create directory structure:**
```
e2e/
├── navigation/
│   └── all-pages.spec.ts (NEW from Task 1)
├── crud/
│   ├── sessions.spec.ts (NEW from Task 2)
│   ├── clients.spec.ts
│   ├── ... (11 files total)
├── interactions/
│   ├── buttons.spec.ts (NEW from Task 3)
│   ├── modals.spec.ts
│   ├── ... (6 files total)
├── workflows/
│   └── complete-journeys.spec.ts (NEW from Task 4)
├── features/
│   ├── ai-chatbot.spec.ts (MERGE: chatbot-test + new-studio-chatbot-test)
│   ├── audio-player.spec.ts (NEW from Task 5)
│   ├── ... (6 files total)
├── auth/
│   ├── signup.spec.ts (MERGE: test-signup-validation + test-debug-register)
│   ├── login.spec.ts (MERGE: test-auth-login + test-auth-final)
│   └── session-cookies.spec.ts (MOVE: test-auth-verification)
├── infrastructure/
│   ├── cors-https.spec.ts (MOVE: test-cors-https)
│   ├── multitenant.spec.ts (MOVE: test-multitenant-subdomain)
│   └── homepage.spec.ts (MOVE: test-homepage-check)
└── helpers/
    ├── login.ts (shared login functions)
    ├── fixtures.ts (test data)
    └── screenshots.ts (screenshot helpers)
```

2. **Consolidate duplicate tests:**
- Merge 3 auth tests → 2 organized auth tests
- Merge 2 chatbot tests → 1 comprehensive chatbot test
- Extract common login logic to `helpers/login.ts`

3. **Delete old files:**
```bash
rm test-*.spec.ts
rm packages/client/e2e/*.spec.ts
```

4. **Update playwright.config.ts:**
```typescript
export default defineConfig({
  testDir: './e2e',
  // ... other config
});
```

**Output:**
- Organized `e2e/` directory with ~40 test files
- Deleted 13 old test files
- Shared helpers in `e2e/helpers/`

**Verify:**
- [ ] No test files in root directory
- [ ] All tests in organized `e2e/` structure
- [ ] No duplicate test coverage
- [ ] Shared helpers extracted

---

## Task 7: Execute full test suite and document results
**Objective:** Run all tests on production and create comprehensive test report

**Actions:**

1. **Run full test suite:**
```bash
npx playwright test --config=playwright.config.ts --reporter=html
```

2. **Generate coverage report:**
```bash
npx playwright test --coverage
```

3. **Create test execution report:**

File: `.planning/phases/3.2-end-to-end-testing/TEST-EXECUTION-REPORT.md`

```markdown
# E2E Test Execution Report

**Date:** 2025-12-26
**Environment:** Production (https://recording-studio-manager.com)
**Total Tests:** 400+
**Pass Rate:** XX%

## Summary by Category

| Category | Tests | Passed | Failed | Duration |
|----------|-------|--------|--------|----------|
| Navigation (53 pages) | 53 | XX | XX | XXs |
| CRUD Operations (11 entities) | 44 | XX | XX | XXs |
| Interactions | 200 | XX | XX | XXs |
| Workflows | 5 | XX | XX | XXs |
| Features | 30 | XX | XX | XXs |
| Auth | 10 | XX | XX | XXs |
| Infrastructure | 5 | XX | XX | XXs |

## Coverage Analysis

**Page Coverage:**
- ✅ 53/53 pages accessible (100%)

**Entity CRUD Coverage:**
- ✅ Sessions: Create/Read/Update/Delete
- ✅ Clients: Create/Read/Update/Delete
- ✅ ... (all 11 entities)

**Feature Coverage:**
- ✅ AI Chatbot: 5/5 tests passing
- ✅ Audio Player: 4/4 tests passing
- ✅ Command Palette: 3/3 tests passing
- ✅ Global Search: 4/4 tests passing
- ✅ Theme Toggle: 2/2 tests passing
- ✅ Notifications: 3/3 tests passing

**Workflow Coverage:**
- ✅ New studio onboarding: Complete
- ✅ Client booking: Complete
- ✅ Project + track upload: Complete
- ✅ Subscription upgrade: Complete
- ✅ Invoice workflow: Complete

## Failed Tests

[List any failed tests with root cause and fix plan]

## Screenshots

All 53 pages screenshotted:
- `screenshots/dashboard.png`
- `screenshots/sessions.png`
- ... (all pages)

## Performance Metrics

- Average page load time: XXXms
- Average API response time: XXXms
- Slowest page: XXX (XXXms)

## Recommendations

[Any issues found, improvements needed]
```

4. **Create test inventory:**

File: `.planning/phases/3.2-end-to-end-testing/TEST-INVENTORY.md`

```markdown
# E2E Test Inventory

Complete list of all E2E tests organized by category.

## Navigation Tests (53)

### Staff Portal (44)
1. Dashboard page loads
2. Sessions list page loads
3. Sessions create page loads
... (all 44 pages)

### Client Portal (5)
45. Client Dashboard loads
... (all 5 pages)

### Auth Pages (4)
50. Staff Login page loads
... (all 4 pages)

## CRUD Tests (44)

### Sessions (4)
54. CREATE: Can create new session
55. READ: Can view session list
56. READ: Can view session detail
57. UPDATE: Can edit session
58. DELETE: Can delete session

... (repeat for all 11 entities)

## Interaction Tests (200)

### Buttons
98. All primary buttons clickable
99. All secondary buttons clickable
... (all button tests)

### Modals
150. Create Project modal opens/closes
... (all modal tests)

... (all interaction categories)

## Workflow Tests (5)

298. New studio onboarding complete
299. Client booking complete
300. Project workflow complete
301. Subscription upgrade complete
302. Invoice workflow complete

## Feature Tests (30)

### AI Chatbot (5)
303. Can send message and receive response
304. Handles follow-up questions
305. Can create entities via commands
306. Maintains conversation context
307. Handles errors gracefully

... (all feature tests)

**TOTAL: 400+ tests**
```

**Output:**
- HTML test report from Playwright
- TEST-EXECUTION-REPORT.md
- TEST-INVENTORY.md
- Coverage metrics

**Verify:**
- [ ] All tests executed on production
- [ ] Pass rate documented
- [ ] Failed tests analyzed
- [ ] Coverage metrics captured
- [ ] Screenshots saved for all pages

</tasks>

<verification>
After completing all tasks, verify:

1. **Complete coverage:**
   - [ ] All 53 pages tested and accessible
   - [ ] All 11 entities have CRUD tests
   - [ ] All interactive elements tested
   - [ ] All 5 critical workflows tested
   - [ ] All 6 advanced features tested

2. **Test organization:**
   - [ ] All tests in `e2e/` directory (no scattered files)
   - [ ] Clear categorization (navigation, crud, interactions, workflows, features, auth, infrastructure)
   - [ ] No duplicate tests
   - [ ] Shared helpers extracted

3. **Test execution:**
   - [ ] All tests passing on production (or failures documented)
   - [ ] Test execution report complete
   - [ ] Test inventory document complete
   - [ ] Screenshots captured for all pages

4. **Production quality:**
   - [ ] No console errors on any page
   - [ ] No 404/500 errors
   - [ ] All forms functional
   - [ ] All workflows complete successfully
   - [ ] Ready for Phase 4 (Marketing Foundation)

**Success criteria:**
- ✅ 100% page coverage (53/53 pages tested)
- ✅ 100% entity coverage (11/11 entities with CRUD tests)
- ✅ 100% critical flow coverage (5/5 workflows tested)
- ✅ All tests organized in clean `e2e/` structure
- ✅ Test execution report shows pass rate >95%
- ✅ Production validated and ready for marketing
</verification>

<success_criteria>
- [ ] 400+ E2E tests created covering entire application
- [ ] All 53 pages accessible and functional
- [ ] All 11 entities have Create/Read/Update/Delete tests
- [ ] All 200+ UI interactions tested (buttons, modals, forms, tabs)
- [ ] All 5 critical workflows tested end-to-end
- [ ] All 6 advanced features tested (AI, audio, search, etc.)
- [ ] All tests organized in `e2e/` directory structure
- [ ] 13 old scattered test files deleted
- [ ] TEST-EXECUTION-REPORT.md shows >95% pass rate
- [ ] TEST-INVENTORY.md lists all 400+ tests
- [ ] Screenshots captured for all 53 pages
- [ ] Production environment fully validated
- [ ] Ready to proceed to Phase 4 (Marketing Foundation)
</success_criteria>

<output>
**New test structure:**
```
e2e/
├── navigation/all-pages.spec.ts (53 tests)
├── crud/
│   ├── sessions.spec.ts (4 tests)
│   ├── clients.spec.ts (4 tests)
│   ├── ... (11 files, 44 tests total)
├── interactions/
│   ├── buttons.spec.ts (~50 tests)
│   ├── modals.spec.ts (~40 tests)
│   ├── ... (6 files, 200 tests total)
├── workflows/complete-journeys.spec.ts (5 tests)
├── features/
│   ├── ai-chatbot.spec.ts (5 tests)
│   ├── audio-player.spec.ts (4 tests)
│   ├── ... (6 files, 30 tests total)
├── auth/ (3 files, 10 tests)
├── infrastructure/ (3 files, 5 tests)
└── helpers/
    ├── login.ts
    ├── fixtures.ts
    └── screenshots.ts
```

**Documentation:**
- `.planning/phases/3.2-end-to-end-testing/TEST-INVENTORY.md` (lists all 400+ tests)
- `.planning/phases/3.2-end-to-end-testing/TEST-EXECUTION-REPORT.md` (results)
- `screenshots/` directory with 53 page screenshots

**Deleted:**
- 13 scattered test files from root and packages/client/e2e/

**Total tests:** 400+ (exact count after implementation)
- 53 navigation tests
- 44 CRUD tests
- 200 interaction tests
- 5 workflow tests
- 30 feature tests
- 10 auth tests
- 5 infrastructure tests
- ~50 additional edge case tests

**Commands:**
```bash
# Run full suite
npx playwright test

# Run specific category
npx playwright test e2e/navigation/
npx playwright test e2e/crud/
npx playwright test e2e/workflows/

# Run with UI
npx playwright test --ui

# Generate HTML report
npx playwright test --reporter=html
```
</output>

---

## Checkpoints

### verify: Task 1-3 complete (Foundation)
**Check:** Navigation tests (53), CRUD tests (44), Interaction tests (200) all created and passing
**Action:** Review test files, run tests, verify coverage
**If blocked:** Cannot proceed to workflows without basic page/CRUD coverage

### verify: Task 4-5 complete (Advanced)
**Check:** Workflow tests (5), Feature tests (30) all created and passing
**Action:** Run workflow tests, verify all complete end-to-end
**If blocked:** Cannot validate production quality without workflow tests

### verify: Task 6-7 complete (Organization & Reporting)
**Check:** All tests organized, old files deleted, reports generated
**Action:** Review e2e/ structure, read TEST-EXECUTION-REPORT.md
**If blocked:** Phase 3.2 incomplete without comprehensive reporting

---

## Estimation

**Scope:** 400+ tests covering entire application

**Context usage:** ~70-80% (very large plan)

**Recommendation:** Execute in single session with subagent for test creation

**Success indicator:** TEST-EXECUTION-REPORT.md shows >95% pass rate, all 53 pages validated
