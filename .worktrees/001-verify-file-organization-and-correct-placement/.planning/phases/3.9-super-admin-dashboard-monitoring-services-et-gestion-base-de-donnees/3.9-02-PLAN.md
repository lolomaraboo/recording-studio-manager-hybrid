---
phase: 3.9-super-admin-dashboard-monitoring-services-et-gestion-base-de-donnees
plan: 02
type: execute
---

<objective>
Build frontend super admin dashboard UI - service monitoring, database management, and system logs viewer.

Purpose: Provide visual interface for production system administration without terminal access, enabling quick troubleshooting and user management.
Output: SuperAdmin React page with Docker container monitoring, organization/user management, tenant stats, and log viewer.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/3.9-super-admin-dashboard-monitoring-services-et-gestion-base-de-donnees/3.9-01-SUMMARY.md

**Prior decisions affecting this phase:**
- shadcn/ui component library (Phase 1-4) - Use Card, Table, Badge for consistent UI
- Dark/Light theme support (Phase 3.4) - Ensure dashboard respects theme
- Existing admin page patterns (Dashboard.tsx, Clients.tsx) - Follow established layout

**Backend endpoints available (from 3.9-01):**
- `superadmin.listContainers` - Docker containers with status
- `superadmin.getContainerLogs` - Container logs (tail 100)
- `superadmin.getSystemMetrics` - CPU/memory/disk usage
- `superadmin.listOrganizations` - All orgs with stats
- `superadmin.listUsers` - All users with details
- `superadmin.getTenantStats` - Tenant DB sizes
- `superadmin.aggregateHealth` - Health check aggregation

**Relevant source files:**
@packages/client/src/pages/Dashboard.tsx
@packages/client/src/pages/Clients.tsx
@packages/client/src/components/ui/card.tsx
@packages/client/src/components/ui/table.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: SuperAdmin page layout and routing</name>
  <files>packages/client/src/pages/SuperAdmin.tsx, packages/client/src/App.tsx</files>
  <action>
    1. Create SuperAdmin.tsx page at packages/client/src/pages/SuperAdmin.tsx
    2. Layout: Tabs component with 3 tabs (Services, Database, Logs)
    3. Add route in App.tsx: `/superadmin` (protected route, check if user is superadmin)
    4. Add superadmin check in frontend: Compare logged-in user email to VITE_SUPERADMIN_EMAIL env var
    5. If not superadmin, redirect to /dashboard with toast error "Access denied - Superadmin only"
    6. Page header: "Super Admin Dashboard" with breadcrumb back to Dashboard
    7. Use existing shadcn/ui Tabs component for tab navigation

    **What to avoid:** Don't rely only on frontend check - backend middleware is primary security.
    **Why:** Frontend check = UX convenience only. Backend middleware = actual security enforcement.
  </action>
  <verify>
    - packages/client/src/pages/SuperAdmin.tsx exists with 3 tabs
    - Route `/superadmin` added to App.tsx
    - Access check redirects non-superadmin users
    - `pnpm --filter @rsm/client build` succeeds
  </verify>
  <done>
    - SuperAdmin page created with tab layout
    - Route protected with access check
    - Breadcrumb navigation to Dashboard
    - Build succeeds without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Services monitoring tab UI</name>
  <files>packages/client/src/pages/SuperAdmin.tsx</files>
  <action>
    1. Services tab content:
       - Section 1: Docker Containers table (Name, Status, Uptime, Image)
         - Use trpc.superadmin.listContainers.useQuery()
         - Status badge: green for "running", red for "stopped", yellow for "restarting"
         - Auto-refresh every 30 seconds
       - Section 2: System Metrics cards (CPU, Memory, Disk)
         - Use trpc.superadmin.getSystemMetrics.useQuery()
         - Display as 3 Cards with progress bars
         - Color coding: green <70%, yellow 70-90%, red >90%
       - Section 3: Health Status
         - Use trpc.superadmin.aggregateHealth.useQuery()
         - Show all health checks with status indicators
    2. Use shadcn/ui components: Card, Table, Badge, Progress
    3. Loading states with Skeleton components
    4. Error handling with toast notifications

    **What to avoid:** Don't poll too frequently (every 30s is enough, not 1s).
    **Why:** Excessive polling = unnecessary server load. 30s = balance between freshness and efficiency.
  </action>
  <verify>
    - Services tab renders Docker containers table
    - System metrics cards show CPU/memory/disk usage
    - Health status section displays all checks
    - Auto-refresh works (30 second interval)
    - `pnpm --filter @rsm/client build` succeeds
  </verify>
  <done>
    - Services tab UI complete with 3 sections
    - Auto-refresh configured (30s interval)
    - Loading and error states handled
    - Build succeeds without errors
  </done>
</task>

<task type="auto">
  <name>Task 3: Database management and Logs tabs UI</name>
  <files>packages/client/src/pages/SuperAdmin.tsx</files>
  <action>
    1. Database tab content:
       - Section 1: Organizations table (Name, Users, Tenant DB, Subscription, Created)
         - Use trpc.superadmin.listOrganizations.useQuery()
         - Pagination controls (50 per page from backend)
         - Search filter by organization name (client-side)
       - Section 2: Users table (Email, Organization, Last Login, Created)
         - Use trpc.superadmin.listUsers.useQuery()
         - Pagination controls (50 per page)
         - Search filter by email (client-side)
       - Section 3: Tenant Stats cards
         - Use trpc.superadmin.getTenantStats.useQuery()
         - Display total tenants, total DB size, average size per tenant
    2. Logs tab content:
       - Container selector dropdown (select from listContainers)
       - Logs viewer textarea (read-only, monospace font)
         - Use trpc.superadmin.getContainerLogs.useQuery({ containerId })
         - Last 100 lines displayed
         - Refresh button to reload logs
         - Auto-scroll to bottom on load
    3. Use shadcn/ui components: Table, Card, Select, Input, Button
    4. All queries with loading/error states

    **What to avoid:** Don't load all logs automatically - only load when container selected.
    **Why:** Large log files = performance issue. Load on-demand = better UX.
  </action>
  <verify>
    - Database tab shows organizations and users tables with pagination
    - Tenant stats cards display aggregated data
    - Logs tab has container selector and log viewer
    - Search filters work for organizations and users
    - `pnpm --filter @rsm/client build` succeeds
  </verify>
  <done>
    - Database tab complete with org/user management
    - Logs tab complete with container log viewer
    - Pagination and search implemented
    - Build succeeds without errors
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Super Admin Dashboard at /superadmin with 3 tabs (Services, Database, Logs)</what-built>
  <how-to-verify>
    1. Set environment variable: `export VITE_SUPERADMIN_EMAIL=your-email@example.com`
    2. Rebuild client: `pnpm --filter @rsm/client build`
    3. Deploy to production (rsync + docker restart)
    4. Navigate to: https://recording-studio-manager.com/superadmin
    5. **Services Tab:**
       - Verify Docker containers table shows rsm-client, rsm-server, rsm-postgres, rsm-redis, qdrant
       - Check status badges are correct (all should be green "running")
       - Verify system metrics cards show CPU/Memory/Disk usage
       - Confirm health status shows all checks passing
    6. **Database Tab:**
       - Verify organizations table lists all organizations with correct stats
       - Verify users table lists all users
       - Test pagination controls (next/prev page)
       - Test search filters (type organization name or email)
       - Check tenant stats cards show total tenants and DB sizes
    7. **Logs Tab:**
       - Select rsm-server from container dropdown
       - Verify logs display in monospace textarea
       - Click refresh button, verify logs update
       - Check auto-scroll to bottom works
    8. **Access Control:**
       - Logout and login with non-superadmin user
       - Try to access /superadmin
       - Verify redirect to dashboard with "Access denied" error toast
  </how-to-verify>
  <resume-signal>Type "approved" if dashboard works correctly, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pnpm --filter @rsm/client build` succeeds without errors
- [ ] SuperAdmin page accessible at /superadmin for superadmin users
- [ ] Non-superadmin users redirected with error message
- [ ] All 3 tabs render correctly (Services, Database, Logs)
- [ ] Docker containers, system metrics, and health status display correctly
- [ ] Organizations and users tables show correct data with pagination
- [ ] Container logs viewer works with container selection
- [ ] No TypeScript errors or warnings introduced
</verification>

<success_criteria>

- All 4 tasks completed (3 auto + 1 checkpoint)
- SuperAdmin page created with 3 functional tabs
- Services tab monitors Docker containers and system health
- Database tab manages organizations and users with pagination
- Logs tab displays container logs on-demand
- Access control prevents non-superadmin access
- Build succeeds without errors
- Human verification confirms dashboard works in production
- Phase 3.9 complete - ready for Phase 4 (Marketing Foundation)
</success_criteria>

<output>
After completion, create `.planning/phases/3.9-super-admin-dashboard-monitoring-services-et-gestion-base-de-donnees/3.9-02-SUMMARY.md`:

# Phase 3.9 Plan 2: Frontend Dashboard UI Summary

**Super Admin Dashboard UI complete - full production system visibility without SSH**

## Accomplishments

- Created SuperAdmin.tsx page with 3-tab layout (Services, Database, Logs)
- Implemented Services tab with Docker monitoring, system metrics, health checks
- Implemented Database tab with organization/user management and tenant stats
- Implemented Logs tab with container selector and log viewer
- Added access control with VITE_SUPERADMIN_EMAIL environment variable
- Auto-refresh for Services tab (30 second interval)
- Pagination and search for Database tab tables
- Loading and error states for all queries

## Files Created/Modified

- `packages/client/src/pages/SuperAdmin.tsx` - Super Admin Dashboard page (NEW)
- `packages/client/src/App.tsx` - Added /superadmin route with protection

## Decisions Made

- 3-tab layout for logical feature grouping (Services, Database, Logs)
- Auto-refresh 30 seconds for Services tab (balance freshness vs server load)
- On-demand log loading (only when container selected, not all at once)
- Client-side search filters for quick filtering without server round-trips
- Frontend access check for UX (backend middleware is primary security)

## Issues Encountered

None

## Next Phase Readiness

**Phase 3.9 COMPLETE** - Super Admin Dashboard fully functional

Production administration now possible without SSH:
- ✅ Monitor Docker containers and system health
- ✅ View all organizations and users
- ✅ Check tenant database stats
- ✅ View container logs for debugging
- ✅ Access restricted to superadmin email only

Ready for Phase 4: Marketing Foundation (landing page, pricing, demo)
</output>
