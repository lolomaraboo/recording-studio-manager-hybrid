---
phase: 02-complete-phase-5
plan: 01
type: execute
---

<objective>
Complete Phase 5 (Projects Management) by implementing the missing Item 11: E2E tests for complete projects workflow.

Purpose: Validate that the Projects Management feature works end-to-end in production. This is the final 8% needed to reach 100% completion of Phase 5, which is a critical business differentiator vs competitors.
Output: Playwright E2E test covering full projects flow (create project → add track → upload versions → view metadata), validated passing in production.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**From STATE.md - Phase 1 established stable production:**
- Production deployed at recording-studio-manager.com with HTTPS
- CORS fixed, authentication working, monitoring active
- All health endpoints operational
- Test account validation working (tenant auto-provisioning)

**From TODO_MASTER - Phase 5 Status:**
- 11/12 items complete (92%)
- Missing: Item 11 "Tests E2E projects flow" (estimated 1h)
- All functionality already implemented:
  - Migration `tracks` table with 34 fields ✅
  - tRPC routers for projects & tracks ✅
  - UI pages: ProjectsList, ProjectDetail, TrackDetail ✅
  - Forms: CreateProject, CreateTrack ✅
  - Upload versioning + preview ✅
  - Audio player with versions ✅

**Existing test patterns:**
@test-production-dashboard.spec.ts

**Projects flow to test:**
1. Signup → Dashboard (reuse existing auth pattern)
2. Navigate to Projects page (/projects)
3. Create new project (modal form)
4. Navigate to project detail
5. Add track to project (modal form with 17 Phase 5 fields)
6. Upload audio version (demo/rough/final/master)
7. View track detail (/projects/:id/tracks/:trackId)
8. Verify metadata displays
9. Verify audio player works
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create E2E test for complete projects workflow</name>
  <files>test-projects-e2e.spec.ts</files>
  <action>
Create Playwright E2E test following existing pattern from test-production-dashboard.spec.ts.

**Test flow:**
1. Register new account with timestamp email (reuse pattern from test-production-dashboard.spec.ts)
2. Wait for dashboard redirect (validate tenant provisioning works)
3. Navigate to Projects page - click sidebar link or visit /projects
4. Click "Create Project" button, fill modal form:
   - Project name: "Album {timestamp}"
   - Client: Select first from dropdown (or create if needed)
   - Genre: "Rock"
   - Status: "in_progress"
   - Start date: today
   - Budget: €5000
   - Submit form
5. Wait for project to appear in list, click to view detail
6. In project detail, click "Add Track" button, fill modal form:
   - Title: "Track One"
   - Track number: 1
   - BPM: 120
   - Key: "C"
   - Composer: "Test Composer"
   - Duration: 180
   - Status: "recording"
   - Submit form
7. Wait for track to appear in tracks list
8. Click on track to view TrackDetail page
9. Verify Track Info Card displays:
   - Title, track number, BPM, key, composer
   - Audio player (may be empty if no file uploaded yet)
10. In Versioning Card, upload demo version:
    - Click upload button for "Demo"
    - Select test audio file (need small .mp3 file, or skip upload and just verify UI)
    - Wait for upload success toast
11. Verify uploaded file shows in Versioning Card
12. Take screenshots at key steps for visual verification
13. Assert success: project created, track added, detail page renders

**What to avoid:**
- Don't test every single field - focus on happy path
- Don't test file upload if no test audio file available (just verify UI renders)
- Don't test error cases in this E2E (Phase 5 Item 11 is happy path validation)

**Test structure:**
- Use test.describe() for organization
- Add console.log() for debugging like existing tests
- Take screenshots in .playwright-mcp/ directory
- Use proper waits (waitForSelector, waitForTimeout) for async operations
- Test against production URL: http://recording-studio-manager.com (or https://)
  </action>
  <verify>
1. Run: npx playwright test test-projects-e2e.spec.ts --headed
2. Test should pass without errors
3. Screenshots should show: dashboard, projects list, project detail, track detail
4. Console output should show all steps completing
  </verify>
  <done>
- Test file created and runs successfully
- All test steps complete without errors
- Screenshots captured show functional UI
- Console logs confirm each step
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>E2E test for complete projects workflow (signup → dashboard → create project → add track → view detail)</what-built>
  <how-to-verify>
1. Run the test in headed mode to watch it execute:
   ```bash
   npx playwright test test-projects-e2e.spec.ts --headed
   ```

2. Observe the browser automation:
   - Registration form fills and submits
   - Dashboard loads after signup
   - Navigation to Projects page
   - Project creation modal appears and submits
   - Project appears in list
   - Track creation modal appears and submits
   - Track detail page loads with metadata

3. Check test output in terminal:
   - All assertions pass (green checkmarks)
   - No errors or timeouts
   - Console logs show each step completing

4. Review screenshots in .playwright-mcp/ directory:
   - projects-list.png - shows projects page
   - project-detail.png - shows project with tracks
   - track-detail.png - shows track metadata and player

5. Verify in production manually if needed:
   - Visit https://recording-studio-manager.com
   - Login with test account created by test
   - Confirm project and track exist in database
  </how-to-verify>
  <resume-signal>Type "approved" if test passes and screenshots look correct, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] Test runs successfully without errors
- [ ] All test steps complete (signup → dashboard → project → track → detail)
- [ ] Screenshots captured show functional UI
- [ ] Manual verification in production confirms data persisted
- [ ] Phase 5 can be marked as 100% complete (12/12 items)
</verification>

<success_criteria>
- All tasks completed
- E2E test passes consistently
- Projects workflow validated end-to-end
- Phase 5 Item 11 complete
- Phase 5 status updated to 100% (12/12 items)
- Ready to proceed to Phase 3 (Billing Infrastructure)
</success_criteria>

<output>
After completion, create `.planning/phases/02-complete-phase-5/02-01-SUMMARY.md`:

# Phase 2 Plan 1: E2E Projects Testing Summary

**E2E test validates complete projects workflow from signup to track detail**

## Accomplishments

- Created comprehensive E2E test for projects flow
- Validated all Phase 5 functionality in production
- Captured screenshots of key UI states
- Confirmed tenant provisioning, project creation, track management all working

## Files Created/Modified

- `test-projects-e2e.spec.ts` - Complete E2E test covering signup → dashboard → projects → tracks → detail

## Decisions Made

[Record any decisions made during implementation, or "None"]

## Issues Encountered

[Record any problems and resolutions, or "None"]

## Next Step

Phase 2 complete. Phase 5 now at 100% (12/12 items). Ready for Phase 3 (Billing Infrastructure).
</output>
